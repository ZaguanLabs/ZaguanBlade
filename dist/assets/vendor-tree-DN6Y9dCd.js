import{r as T}from"./vendor-react-ChGcVdpA.js";var J=Object.defineProperty,Q=Object.defineProperties,X=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable,j=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O=(e,t)=>{for(var n in t||(t={}))Y.call(t,n)&&j(e,n,t[n]);if(N)for(var n of N(t))ee.call(t,n)&&j(e,n,t[n]);return e},te=(e,t)=>Q(e,X(t)),ne=Object.defineProperty,ae=Object.defineProperties,re=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,le=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable,W=(e,t,n)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))le.call(t,n)&&W(e,n,t[n]);if(z)for(var n of z(t))se.call(t,n)&&W(e,n,t[n]);return e},E=(e,t)=>ae(e,re(t)),D=(e,t,n)=>new Promise((a,r)=>{var l=o=>{try{d(n.next(o))}catch(g){r(g)}},s=o=>{try{d(n.throw(o))}catch(g){r(g)}},d=o=>o.done?a(o.value):Promise.resolve(o.value).then(l,s);d((n=n.apply(e,t)).next())}),oe=(e,t)=>{let n,a=null;return(...r)=>{const l=e(...r);return n?(a&&a.length===l.length&&!a.some((d,o)=>d!==l[o])||(n=t(...l),a=l),n):(n=t(...l),a=l,n)}};function de(e,t){return typeof e=="function"?e(t):e}function C(e,t){return n=>{t.setState(a=>E(p({},a),{[e]:de(n,a[e])}))}}var B=(e,t=100,n=1e3)=>new Promise(a=>{let r;const l=setInterval(()=>{e()&&(a(),clearInterval(l),clearTimeout(r))},t);r=setTimeout(()=>{clearInterval(l),a()},n)}),q="Headless Tree: ",K=e=>Error(q+e),ce=e=>console.warn(q+e),ie={key:"tree",getInitialState:e=>p({expandedItems:[],focusedItem:null},e),getDefaultConfig:(e,t)=>p({setExpandedItems:C("expandedItems",t),setFocusedItem:C("focusedItem",t)},e),stateHandlerNames:{expandedItems:"setExpandedItems",focusedItem:"setFocusedItem"},treeInstance:{getItemsMeta:({tree:e})=>{const{rootItemId:t}=e.getConfig(),{expandedItems:n}=e.getState(),a=[],r=new Set(n),l=(o,g,f,m,b)=>{var v;if(g.includes(o)){ce(`Circular reference for ${g.join(".")}`);return}if(a.push({itemId:o,level:f,index:a.length,parentId:g.at(-1),setSize:m,posInSet:b}),r.has(o)){const y=(v=e.retrieveChildrenIds(o))!=null?v:[];let F=0;for(const w of y)l(w,g.concat(o),f+1,y.length,F++)}},s=e.retrieveChildrenIds(t);let d=0;for(const o of s)l(o,[t],0,s.length,d++);return a},getFocusedItem:({tree:e})=>{var t;const n=e.getState().focusedItem;return(t=n!==null?e.getItemInstance(n):null)!=null?t:e.getItems()[0]},getRootItem:({tree:e})=>{const{rootItemId:t}=e.getConfig();return e.getItemInstance(t)},focusNextItem:({tree:e})=>{var t;const n=e.getFocusedItem().getItemMeta();if(!n)return;const a=Math.min(n.index+1,e.getItems().length-1);(t=e.getItems()[a])==null||t.setFocused()},focusPreviousItem:({tree:e})=>{var t;const n=e.getFocusedItem().getItemMeta();if(!n)return;const a=Math.max(n.index-1,0);(t=e.getItems()[a])==null||t.setFocused()},updateDomFocus:({tree:e})=>{setTimeout(()=>D(null,null,function*(){var t,n,a,r,l;const s=e.getFocusedItem();(n=(t=e.getConfig()).scrollToItem)==null||n.call(t,s),yield B(()=>s.getElement()!==null,20,500);const d=s.getElement();if(!d){(a=e.getItems()[0])==null||a.setFocused(),(l=(r=e.getItems()[0])==null?void 0:r.getElement())==null||l.focus();return}d.focus()}))},getContainerProps:({prev:e,tree:t},n)=>E(p({},e?.()),{role:"tree","aria-label":n??"",ref:t.registerElement}),isSearchOpen:()=>!1},itemInstance:{scrollTo:(e,t)=>D(null,[e,t],function*({tree:n,item:a},r){var l,s,d;(s=(l=n.getConfig()).scrollToItem)==null||s.call(l,a),yield B(()=>a.getElement()!==null,20),(d=a.getElement())==null||d.scrollIntoView(r)}),getId:({itemId:e})=>e,getKey:({itemId:e})=>e,getProps:({item:e,prev:t})=>{const n=e.getItemMeta();return E(p({},t?.()),{ref:e.registerElement,role:"treeitem","aria-setsize":n.setSize,"aria-posinset":n.posInSet+1,"aria-selected":"false","aria-label":e.getItemName(),"aria-level":n.level+1,"aria-expanded":e.isFolder()?e.isExpanded():void 0,tabIndex:e.isFocused()?0:-1,onClick:a=>{e.setFocused(),e.primaryAction(),!(a.ctrlKey||a.shiftKey||a.metaKey)&&e.isFolder()&&(e.isExpanded()?e.collapse():e.expand())}})},expand:({tree:e,item:t,itemId:n})=>{var a;t.isFolder()&&((a=e.getState().loadingItemChildrens)!=null&&a.includes(n)||(e.applySubStateUpdate("expandedItems",r=>[...r,n]),e.rebuildTree()))},collapse:({tree:e,item:t,itemId:n})=>{t.isFolder()&&(e.applySubStateUpdate("expandedItems",a=>a.filter(r=>r!==n)),e.rebuildTree())},getItemData:({tree:e,itemId:t})=>e.retrieveItemData(t),equals:({item:e},t)=>e.getId()===t?.getId(),isExpanded:({tree:e,itemId:t})=>e.getState().expandedItems.includes(t),isDescendentOf:({item:e},t)=>{const n=e.getParent();return!!(n?.getId()===t||n?.isDescendentOf(t))},isFocused:({tree:e,item:t,itemId:n})=>e.getState().focusedItem===n||e.getState().focusedItem===null&&t.getItemMeta().index===0,isFolder:({tree:e,item:t,itemId:n})=>n===e.getConfig().rootItemId||e.getConfig().isItemFolder(t),getItemName:({tree:e,item:t})=>e.getConfig().getItemName(t),setFocused:({tree:e,itemId:t})=>{e.applySubStateUpdate("focusedItem",t)},primaryAction:({tree:e,item:t})=>{var n,a;return(a=(n=e.getConfig()).onPrimaryAction)==null?void 0:a.call(n,t)},getParent:({tree:e,item:t})=>t.getItemMeta().parentId?e.getItemInstance(t.getItemMeta().parentId):void 0,getIndexInParent:({item:e})=>e.getItemMeta().posInSet,getChildren:({tree:e,itemId:t})=>e.retrieveChildrenIds(t).map(n=>e.getItemInstance(n)),getTree:({tree:e})=>e,getItemAbove:({tree:e,item:t})=>e.getItems()[t.getItemMeta().index-1],getItemBelow:({tree:e,item:t})=>e.getItems()[t.getItemMeta().index+1]},hotkeys:{focusNextItem:{hotkey:"ArrowDown",canRepeat:!0,preventDefault:!0,isEnabled:e=>{var t,n;return!((n=(t=e.isSearchOpen)==null?void 0:t.call(e))!=null&&n)&&!e.getState().dnd},handler:(e,t)=>{t.focusNextItem(),t.updateDomFocus()}},focusPreviousItem:{hotkey:"ArrowUp",canRepeat:!0,preventDefault:!0,isEnabled:e=>{var t,n;return!((n=(t=e.isSearchOpen)==null?void 0:t.call(e))!=null&&n)&&!e.getState().dnd},handler:(e,t)=>{t.focusPreviousItem(),t.updateDomFocus()}},expandOrDown:{hotkey:"ArrowRight",canRepeat:!0,handler:(e,t)=>{const n=t.getFocusedItem();n.isExpanded()||!n.isFolder()?(t.focusNextItem(),t.updateDomFocus()):n.expand()}},collapseOrUp:{hotkey:"ArrowLeft",canRepeat:!0,handler:(e,t)=>{var n;const a=t.getFocusedItem();(!a.isExpanded()||!a.isFolder())&&a.getItemMeta().level!==0?((n=a.getParent())==null||n.setFocused(),t.updateDomFocus()):a.collapse()}},focusFirstItem:{hotkey:"Home",handler:(e,t)=>{var n;(n=t.getItems()[0])==null||n.setFocused(),t.updateDomFocus()}},focusLastItem:{hotkey:"End",handler:(e,t)=>{var n;(n=t.getItems()[t.getItems().length-1])==null||n.setFocused(),t.updateDomFocus()}}}},ue=(e,t,n)=>{const a={};return[a,()=>{const l=n(a);e:for(let s=0;s<e.length;s++){const d=e[s][t];if(!d)continue e;t:for(const[o,g]of Object.entries(d)){if(!g)continue t;const f=a[o];a[o]=(...m)=>g(E(p({},l),{prev:f}),...m)}}}]},ge=e=>{var t;const n=e?.map(a=>a.key);for(const a of e??[]){const r=(t=a.deps)==null?void 0:t.find(l=>!n?.includes(l));if(r)throw K(`${a.key} needs ${r}`)}},fe=(e,t)=>{const n=e.length;for(let a=0;a<n;a++)for(let r=a+1;r<n;r++)t(e[r],e[a])<0&&([e[a],e[r]]=[e[r],e[a]]);return e},me=e=>(t,n)=>{var a,r;return n.key&&((a=t.overwrites)!=null&&a.includes(n.key))?1:t.key&&((r=n.overwrites)!=null&&r.includes(t.key))?-1:e.indexOf(t)-e.indexOf(n)},Ie=(e=[])=>fe(e,me(e)),pe=e=>{var t,n,a,r;const l=(t=e.instanceBuilder)!=null?t:ue,s=[ie,...Ie(e.features)];ge(s);const d=[...s],[o,g]=l(d,"treeInstance",c=>({tree:c}));let f=s.reduce((c,i)=>{var u,I;return(I=(u=i.getInitialState)==null?void 0:u.call(i,c,o))!=null?I:c},(a=(n=e.initialState)!=null?n:e.state)!=null?a:{}),m=s.reduce((c,i)=>{var u,I;return(I=(u=i.getDefaultConfig)==null?void 0:u.call(i,c,o))!=null?I:c},e);const b=s.reduce((c,i)=>p(p({},c),i.stateHandlerNames),{});let v;const y={current:{}};let F=!1;const w={};let M=[];const k={},A={};let x={};const $={},L=()=>{M=[],x={};const[c,i]=l(d,"itemInstance",u=>({item:u,tree:o,itemId:m.rootItemId}));i(),w[m.rootItemId]=c,x[m.rootItemId]={itemId:m.rootItemId,index:-1,parentId:null,level:-1,posInSet:0,setSize:1};for(const u of o.getItemsMeta())if(x[u.itemId]=u,w[u.itemId])M.push(w[u.itemId]);else{const[I,h]=l(d,"itemInstance",S=>({item:S,tree:o,itemId:u.itemId}));h(),w[u.itemId]=I,M.push(I)}F=!1},P=c=>{for(const i of s)c(i)},Z={key:"main",treeInstance:{getState:()=>f,setState:({},c)=>{var i;(i=m.setState)==null||i.call(m,f)},setMounted:({},c)=>{var i;const u=y.current;u.isMounted=c,c&&((i=u.waitingForMount)==null||i.forEach(I=>I()),u.waitingForMount=[])},applySubStateUpdate:({},c,i)=>{var u;const I=()=>{f[c]=typeof i=="function"?i(f[c]):i;const S=m[b[c]];S?.(f[c])},h=y.current;h.isMounted?I():((u=h.waitingForMount)!=null||(h.waitingForMount=[]),h.waitingForMount.push(I))},rebuildTree:()=>{var c,i;const u=y.current;u.isMounted?(L(),(c=m.setState)==null||c.call(m,f)):((i=u.waitingForMount)!=null||(u.waitingForMount=[]),u.waitingForMount.push(()=>{var I;L(),(I=m.setState)==null||I.call(m,f)}))},scheduleRebuildTree:()=>{F=!0},getConfig:()=>m,setConfig:(c,i)=>{var u,I,h;const S=typeof i=="function"?i(m):i,G=((u=S.state)==null?void 0:u.expandedItems)&&((I=S.state)==null?void 0:I.expandedItems)!==f.expandedItems;m=S,S.state&&(f=p(p({},f),S.state)),G&&(L(),(h=m.setState)==null||h.call(m,f))},getItemInstance:({},c)=>{const i=w[c];if(!i){const[u,I]=l(d,"itemInstance",h=>({item:h,tree:o,itemId:c}));return I(),u}return i},getItems:()=>(F&&L(),M),registerElement:({},c)=>{v!==c&&(v&&!c?P(i=>{var u;return(u=i.onTreeUnmount)==null?void 0:u.call(i,o,v)}):!v&&c&&P(i=>{var u;return(u=i.onTreeMount)==null?void 0:u.call(i,o,c)}),v=c)},getElement:()=>v,getDataRef:()=>y,getHotkeyPresets:()=>$},itemInstance:{registerElement:({itemId:c,item:i},u)=>{if(k[c]===u)return;const I=k[c];I&&!u?P(h=>{var S;return(S=h.onItemUnmount)==null?void 0:S.call(h,i,I,o)}):!I&&u&&P(h=>{var S;return(S=h.onItemMount)==null?void 0:S.call(h,i,u,o)}),k[c]=u},getElement:({itemId:c})=>k[c],getDataRef:({itemId:c})=>{var i;return(i=A[c])!=null?i:A[c]={current:{}}},getItemMeta:({itemId:c})=>{var i;return(i=x[c])!=null?i:{itemId:c,parentId:null,level:-1,index:-1,posInSet:0,setSize:1}}}};d.unshift(Z);for(const c of d)Object.assign($,(r=c.hotkeys)!=null?r:{});return g(),o},De={key:"selection",getInitialState:e=>p({selectedItems:[]},e),getDefaultConfig:(e,t)=>p({setSelectedItems:C("selectedItems",t)},e),stateHandlerNames:{selectedItems:"setSelectedItems"},treeInstance:{setSelectedItems:({tree:e},t)=>{e.applySubStateUpdate("selectedItems",t)},getSelectedItems:({tree:e})=>e.getState().selectedItems.map(e.getItemInstance)},itemInstance:{select:({tree:e,itemId:t})=>{const{selectedItems:n}=e.getState();e.setSelectedItems(n.includes(t)?n:[...n,t])},deselect:({tree:e,itemId:t})=>{const{selectedItems:n}=e.getState();e.setSelectedItems(n.filter(a=>a!==t))},isSelected:({tree:e,itemId:t})=>{const{selectedItems:n}=e.getState();return n.includes(t)},selectUpTo:({tree:e,item:t,itemId:n},a)=>{const r=t.getItemMeta().index,l=e.getDataRef();if(!l.current.selectUpToAnchorId){l.current.selectUpToAnchorId=n,e.setSelectedItems([n]);return}const d=e.getItemInstance(l.current.selectUpToAnchorId).getItemMeta().index,[o,g]=r<d?[r,d]:[d,r],f=e.getItems().slice(o,g+1).map(v=>v.getItemMeta().itemId);if(!a){e.setSelectedItems(f);return}const{selectedItems:m}=e.getState(),b=[...new Set([...m,...f])];e.setSelectedItems(b)},toggleSelect:({item:e})=>{e.isSelected()?e.deselect():e.select()},getProps:({tree:e,item:t,itemId:n,prev:a})=>E(p({},a?.()),{"aria-selected":t.isSelected()?"true":"false",onClick:r=>{var l,s;r.shiftKey?t.selectUpTo(r.ctrlKey||r.metaKey):r.ctrlKey||r.metaKey?t.toggleSelect():e.setSelectedItems([n]),r.shiftKey||(e.getDataRef().current.selectUpToAnchorId=n),(s=(l=a?.())==null?void 0:l.onClick)==null||s.call(l,r)}})},hotkeys:{toggleSelectedItem:{hotkey:"Control+Space",preventDefault:!0,handler:(e,t)=>{t.getFocusedItem().toggleSelect()}},selectUpwards:{hotkey:"Shift+ArrowUp",handler:(e,t)=>{const n=t.getFocusedItem(),a=n.getItemAbove();a&&(n.isSelected()&&a.isSelected()?n.deselect():a.select(),a.setFocused(),t.updateDomFocus())}},selectDownwards:{hotkey:"Shift+ArrowDown",handler:(e,t)=>{const n=t.getFocusedItem(),a=n.getItemBelow();a&&(n.isSelected()&&a.isSelected()?n.deselect():a.select(),a.setFocused(),t.updateDomFocus())}},selectAll:{hotkey:"Control+KeyA",preventDefault:!0,handler:(e,t)=>{t.setSelectedItems(t.getItems().map(n=>n.getId()))}}}},V={letter:/^Key[A-Z]$/,letterornumber:/^(Key[A-Z]|Digit[0-9])$/,plus:/^(NumpadAdd|Plus)$/,minus:/^(NumpadSubtract|Minus)$/,control:/^(ControlLeft|ControlRight)$/,shift:/^(ShiftLeft|ShiftRight)$/,metaorcontrol:/^(MetaLeft|MetaRight|ControlLeft|ControlRight)$/,enter:/^(Enter|NumpadEnter)$/},he=(e,t,n)=>{const a=n.hotkey.toLowerCase().split("+"),r=a.every(d=>{if(d in V)return[...e].some(g=>V[d].test(g));const o=[...e].map(g=>g.toLowerCase());return!!(o.includes(d.toLowerCase())||o.includes(`key${d.toLowerCase()}`))}),l=!n.isEnabled||n.isEnabled(t),s=e.size===a.length;return r&&l&&s},ve=(e,t,n,a)=>{var r;return(r=Object.entries(p(p({},n),a)).find(([,l])=>he(e,t,l)))==null?void 0:r[0]},Ce={key:"hotkeys-core",onTreeMount:(e,t)=>{const n=e.getDataRef(),a=s=>{var d,o;const{ignoreHotkeysOnInputs:g,onTreeHotkey:f,hotkeys:m}=e.getConfig();if(s.target instanceof HTMLInputElement&&g)return;(o=(d=n.current).pressedKeys)!=null||(d.pressedKeys=new Set);const b=!n.current.pressedKeys.has(s.code);n.current.pressedKeys.add(s.code);const v=ve(n.current.pressedKeys,e,e.getHotkeyPresets(),m);if(s.target instanceof HTMLInputElement&&n.current.pressedKeys.delete(s.code),!v)return;const y=p(p({},e.getHotkeyPresets()[v]),m?.[v]);y&&(!y.allowWhenInputFocused&&s.target instanceof HTMLInputElement||!y.canRepeat&&!b||(y.preventDefault&&s.preventDefault(),y.handler(s,e),f?.(v,s)))},r=s=>{var d,o;(o=(d=n.current).pressedKeys)!=null||(d.pressedKeys=new Set),n.current.pressedKeys.delete(s.code)},l=()=>{n.current.pressedKeys=new Set};t.addEventListener("keydown",a),document.addEventListener("keyup",r),window.addEventListener("focus",l),n.current.keydownHandler=a,n.current.keyupHandler=r,n.current.resetHandler=l},onTreeUnmount:(e,t)=>{const n=e.getDataRef();n.current.keyupHandler&&(document.removeEventListener("keyup",n.current.keyupHandler),delete n.current.keyupHandler),n.current.keydownHandler&&(t.removeEventListener("keydown",n.current.keydownHandler),delete n.current.keydownHandler),n.current.resetHandler&&(window.removeEventListener("focus",n.current.resetHandler),delete n.current.resetHandler)}},_=e=>{var t,n,a,r,l,s,d,o;const g=e.getDataRef();return(n=(t=g.current).itemData)!=null||(t.itemData={}),(r=(a=g.current).childrenIds)!=null||(a.childrenIds={}),(s=(l=g.current).loadingDataSubs)!=null||(l.loadingDataSubs={}),(o=(d=g.current).loadingChildrenSubs)!=null||(d.loadingChildrenSubs={}),g},R=(e,t)=>D(null,null,function*(){var n,a;const r=e.getConfig(),l=_(e);if(e.getState().loadingItemData.includes(t))return new Promise(d=>{var o,g;(g=(o=l.current.loadingDataSubs)[t])!=null||(o[t]=[]),l.current.loadingDataSubs[t].push(()=>{d(l.current.itemData[t])})});l.current.itemData[t]||e.applySubStateUpdate("loadingItemData",d=>[...d,t]);const s=yield r.dataLoader.getItem(t);return l.current.itemData[t]=s,(n=r.onLoadedItem)==null||n.call(r,t,s),e.applySubStateUpdate("loadingItemData",d=>d.filter(o=>o!==t)),(a=l.current.loadingDataSubs[t])==null||a.forEach(d=>d()),s}),H=(e,t)=>D(null,null,function*(){var n,a,r;const l=e.getConfig(),s=_(e);let d;if(e.getState().loadingItemChildrens.includes(t))return new Promise(o=>{var g,f;(f=(g=s.current.loadingChildrenSubs)[t])!=null||(g[t]=[]),s.current.loadingChildrenSubs[t].push(()=>{o(s.current.childrenIds[t])})});if(s.current.childrenIds[t]||e.applySubStateUpdate("loadingItemChildrens",o=>[...o,t]),"getChildrenWithData"in l.dataLoader){const o=yield l.dataLoader.getChildrenWithData(t);d=o.map(g=>g.id),s.current.childrenIds[t]=d,o.forEach(({id:g,data:f})=>{var m;s.current.itemData[g]=f,(m=l.onLoadedItem)==null||m.call(l,g,f)}),(n=l.onLoadedChildren)==null||n.call(l,t,d),e.rebuildTree(),e.applySubStateUpdate("loadingItemData",g=>g.filter(f=>!d.includes(f)))}else d=yield l.dataLoader.getChildren(t),s.current.childrenIds[t]=d,(a=l.onLoadedChildren)==null||a.call(l,t,d),e.rebuildTree();return e.applySubStateUpdate("loadingItemChildrens",o=>o.filter(g=>g!==t)),(r=s.current.loadingChildrenSubs[t])==null||r.forEach(o=>o()),d}),be={key:"async-data-loader",getInitialState:e=>p({loadingItemData:[],loadingItemChildrens:[]},e),getDefaultConfig:(e,t)=>p({setLoadingItemData:C("loadingItemData",t),setLoadingItemChildrens:C("loadingItemChildrens",t)},e),stateHandlerNames:{loadingItemData:"setLoadingItemData",loadingItemChildrens:"setLoadingItemChildrens"},treeInstance:{waitForItemDataLoaded:({tree:e},t)=>e.loadItemData(t),waitForItemChildrenLoaded:({tree:e},t)=>e.loadChildrenIds(t),loadItemData:(e,t)=>D(null,[e,t],function*({tree:n},a){var r;return(r=_(n).current.itemData[a])!=null?r:yield R(n,a)}),loadChildrenIds:(e,t)=>D(null,[e,t],function*({tree:n},a){var r;return(r=_(n).current.childrenIds[a])!=null?r:yield H(n,a)}),retrieveItemData:({tree:e},t,n=!1)=>{var a,r;const l=e.getConfig(),s=_(e);return s.current.itemData[t]?s.current.itemData[t]:(!e.getState().loadingItemData.includes(t)&&!n&&setTimeout(()=>R(e,t)),(r=(a=l.createLoadingItemData)==null?void 0:a.call(l))!=null?r:null)},retrieveChildrenIds:({tree:e},t,n=!1)=>{const a=_(e);return a.current.childrenIds[t]?a.current.childrenIds[t]:e.getState().loadingItemChildrens.includes(t)||n?[]:(setTimeout(()=>H(e,t)),[])}},itemInstance:{isLoading:({tree:e,item:t})=>e.getState().loadingItemData.includes(t.getItemMeta().itemId)||e.getState().loadingItemChildrens.includes(t.getItemMeta().itemId),invalidateItemData:(e,t)=>D(null,[e,t],function*({tree:n,itemId:a},r){var l;r||(l=_(n).current.itemData)==null||delete l[a],yield R(n,a)}),invalidateChildrenIds:(e,t)=>D(null,[e,t],function*({tree:n,itemId:a},r){var l;r||(l=_(n).current.childrenIds)==null||delete l[a],yield H(n,a)}),updateCachedChildrenIds:({tree:e,itemId:t},n,a)=>{_(e).current.childrenIds[t]=n,a||e.rebuildTree()},updateCachedData:({tree:e,itemId:t},n,a)=>{_(e).current.itemData[t]=n,a||e.rebuildTree()},hasLoadedData:({tree:e,itemId:t})=>e.getDataRef().current.itemData[t]!==void 0}},Se="sync dataLoader returned undefined",ye="sync dataLoader returned promise",U=e=>{if(!e)throw K(Se);if(typeof e=="object"&&"then"in e)throw K(ye);return e},we={key:"sync-data-loader",getInitialState:e=>p({loadingItemData:[],loadingItemChildrens:[]},e),getDefaultConfig:(e,t)=>p({setLoadingItemData:C("loadingItemData",t),setLoadingItemChildrens:C("loadingItemChildrens",t)},e),stateHandlerNames:{loadingItemData:"setLoadingItemData",loadingItemChildrens:"setLoadingItemChildrens"},treeInstance:{waitForItemDataLoaded:()=>D(null,null,function*(){}),waitForItemChildrenLoaded:()=>D(null,null,function*(){}),retrieveItemData:({tree:e},t)=>U(e.getConfig().dataLoader.getItem(t)),retrieveChildrenIds:({tree:e},t)=>{const{dataLoader:n}=e.getConfig();return"getChildren"in n?U(n.getChildren(t)):U(n.getChildrenWithData(t)).map(a=>a.data)},loadItemData:({tree:e},t)=>e.retrieveItemData(t),loadChildrenIds:({tree:e},t)=>e.retrieveChildrenIds(t)},itemInstance:{isLoading:()=>!1,hasLoadedData:()=>!0}},Fe={key:"search",getInitialState:e=>p({search:null},e),getDefaultConfig:(e,t)=>p({setSearch:C("search",t),isSearchMatchingItem:(n,a)=>n.length>0&&a.getItemName().toLowerCase().includes(n.toLowerCase())},e),stateHandlerNames:{search:"setSearch"},treeInstance:{setSearch:({tree:e},t)=>{var n;e.applySubStateUpdate("search",t),(n=e.getItems().find(a=>{var r,l;return(l=(r=e.getConfig()).isSearchMatchingItem)==null?void 0:l.call(r,e.getSearchValue(),a)}))==null||n.setFocused()},openSearch:({tree:e},t="")=>{var n,a;e.setSearch(t),(a=(n=e.getConfig()).onOpenSearch)==null||a.call(n),setTimeout(()=>{var r;(r=e.getDataRef().current.searchInput)==null||r.focus()})},closeSearch:({tree:e})=>{var t,n;e.setSearch(null),(n=(t=e.getConfig()).onCloseSearch)==null||n.call(t),e.updateDomFocus()},isSearchOpen:({tree:e})=>e.getState().search!==null,getSearchValue:({tree:e})=>e.getState().search||"",registerSearchInputElement:({tree:e},t)=>{const n=e.getDataRef();n.current.searchInput=t,t&&n.current.keydownHandler&&t.addEventListener("keydown",n.current.keydownHandler)},getSearchInputElement:({tree:e})=>{var t;return(t=e.getDataRef().current.searchInput)!=null?t:null},getSearchInputElementProps:({tree:e})=>({value:e.getSearchValue(),onChange:t=>e.setSearch(t.target.value),onBlur:()=>e.closeSearch(),ref:e.registerSearchInputElement}),getSearchMatchingItems:oe(({tree:e})=>[e.getSearchValue(),e.getItems(),e.getConfig().isSearchMatchingItem],(e,t,n)=>t.filter(a=>e&&n?.(e,a)))},itemInstance:{isMatchingSearch:({tree:e,item:t})=>e.getSearchMatchingItems().some(n=>n.getId()===t.getId())},hotkeys:{openSearch:{hotkey:"LetterOrNumber",preventDefault:!0,isEnabled:e=>!e.isSearchOpen(),handler:(e,t)=>{e.stopPropagation(),t.openSearch(e.key)}},closeSearch:{hotkey:"Escape",allowWhenInputFocused:!0,isEnabled:e=>e.isSearchOpen(),handler:(e,t)=>{t.closeSearch()}},submitSearch:{hotkey:"Enter",allowWhenInputFocused:!0,isEnabled:e=>e.isSearchOpen(),handler:(e,t)=>{t.closeSearch(),t.setSelectedItems([t.getFocusedItem().getId()])}},nextSearchItem:{hotkey:"ArrowDown",allowWhenInputFocused:!0,canRepeat:!0,isEnabled:e=>e.isSearchOpen(),handler:(e,t)=>{const n=t.getSearchMatchingItems().find(a=>a.getItemMeta().index>t.getFocusedItem().getItemMeta().index);n?.setFocused(),n?.scrollTo({block:"nearest",inline:"nearest"})}},previousSearchItem:{hotkey:"ArrowUp",allowWhenInputFocused:!0,canRepeat:!0,isEnabled:e=>e.isSearchOpen(),handler:(e,t)=>{const n=[...t.getSearchMatchingItems()].reverse().find(a=>a.getItemMeta().index<t.getFocusedItem().getItemMeta().index);n?.setFocused(),n?.scrollTo({block:"nearest",inline:"nearest"})}}}},Ee=e=>{const[t]=T.useState(()=>({current:pe(e)})),[n,a]=T.useState(()=>t.current.getState());return T.useEffect(()=>(t.current.setMounted(!0),t.current.rebuildTree(),()=>{t.current.setMounted(!1)}),[t]),t.current.setConfig(r=>te(O(O({},r),e),{state:O(O({},n),e.state),setState:l=>{var s;a(l),(s=e.setState)==null||s.call(e,l)}})),t.current};export{be as a,De as b,Fe as c,Ce as h,we as s,Ee as u};
