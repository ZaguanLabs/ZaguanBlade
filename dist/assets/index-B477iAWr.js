const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CeDnaWDR.js","assets/vendor-react-ChGcVdpA.js","assets/vendor-markdown-B0Br48F1.js","assets/vendor-xterm-CT6HrMBF.js","assets/vendor-xterm-DDGTF8rc.css","assets/vendor-tree-DN6Y9dCd.js","assets/vendor-codemirror-DXi3JwrT.js","assets/vendor-syntax-CX0aKcwo.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,Z as gt,C as Se,a as Qe,L as et,T as ue,b as bt,c as me,d as be,F as Le,X as fe,P as yt,U as vt,B as wt,e as jt,u as ze,S as Nt,f as _t,g as Pe,h as ye,i as Ct,k as Et,l as kt,R as pe,m as St,n as Me,o as _e,p as Te,_ as Ie,q as Lt,s as Be,t as Dt,v as Rt,w as At,x as zt,y as Tt,z as Ue,N as It,A as Ot,D as $t,E as Ft,G as Pt,H as Mt,I as Bt}from"./vendor-react-ChGcVdpA.js";import{M as he,r as Ut}from"./vendor-markdown-B0Br48F1.js";import{D as tt,o as Wt,L as Vt}from"./vendor-xterm-CT6HrMBF.js";import{u as Ht,s as qt,a as Kt,b as Gt,h as Xt,c as Yt}from"./vendor-tree-DN6Y9dCd.js";import{S as H,a as ve,E as ie,D as V,W as Jt,C as Zt,b as Qt,l as en,h as tn,f as nn,c as sn,d as rn,e as on,g as an,i as ln,j as cn,s as dn,o as un,k as pn,m as fn,n as hn,p as xn,q as mn,r as gn,t as bn,u as We,v as yn}from"./vendor-codemirror-DXi3JwrT.js";import{h as vn,v as wn}from"./vendor-syntax-CX0aKcwo.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();function nt(t,n=!1){return window.__TAURI_INTERNALS__.transformCallback(t,n)}async function q(t,n={},s){return window.__TAURI_INTERNALS__.invoke(t,n,s)}const jn=Object.freeze(Object.defineProperty({__proto__:null,invoke:q,transformCallback:nt},Symbol.toStringTag,{value:"Module"}));var De;(function(t){t.WINDOW_RESIZED="tauri://resize",t.WINDOW_MOVED="tauri://move",t.WINDOW_CLOSE_REQUESTED="tauri://close-requested",t.WINDOW_DESTROYED="tauri://destroyed",t.WINDOW_FOCUS="tauri://focus",t.WINDOW_BLUR="tauri://blur",t.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",t.WINDOW_THEME_CHANGED="tauri://theme-changed",t.WINDOW_CREATED="tauri://window-created",t.WEBVIEW_CREATED="tauri://webview-created",t.DRAG_ENTER="tauri://drag-enter",t.DRAG_OVER="tauri://drag-over",t.DRAG_DROP="tauri://drag-drop",t.DRAG_LEAVE="tauri://drag-leave"})(De||(De={}));async function st(t,n){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(t,n),await q("plugin:event|unlisten",{event:t,eventId:n})}async function O(t,n,s){var r;const o=typeof s?.target=="string"?{kind:"AnyLabel",label:s.target}:(r=s?.target)!==null&&r!==void 0?r:{kind:"Any"};return q("plugin:event|listen",{event:t,target:o,handler:nt(n)}).then(i=>async()=>st(t,i))}async function Nn(t,n,s){return O(t,r=>{st(t,r.id),n(r)},s)}async function rt(t,n){await q("plugin:event|emit",{event:t,payload:n})}async function _n(t,n,s){await q("plugin:event|emit_to",{target:typeof t=="string"?{kind:"AnyLabel",label:t}:t,event:n,payload:s})}const Cn=Object.freeze(Object.defineProperty({__proto__:null,get TauriEvent(){return De},emit:rt,emitTo:_n,listen:O,once:Nn},Symbol.toStringTag,{value:"Module"})),B=[];for(let t=0;t<256;++t)B.push((t+256).toString(16).slice(1));function En(t,n=0){return(B[t[n+0]]+B[t[n+1]]+B[t[n+2]]+B[t[n+3]]+"-"+B[t[n+4]]+B[t[n+5]]+"-"+B[t[n+6]]+B[t[n+7]]+"-"+B[t[n+8]]+B[t[n+9]]+"-"+B[t[n+10]]+B[t[n+11]]+B[t[n+12]]+B[t[n+13]]+B[t[n+14]]+B[t[n+15]]).toLowerCase()}let Ce;const kn=new Uint8Array(16);function Sn(){if(!Ce){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ce=crypto.getRandomValues.bind(crypto)}return Ce(kn)}const Ln=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ve={randomUUID:Ln};function Dn(t,n,s){t=t||{};const r=t.random??t.rng?.()??Sn();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,En(r)}function Rn(t,n,s){return Ve.randomUUID&&!t?Ve.randomUUID():Dn(t)}class W{static PROTOCOL_VERSION={major:1,minor:1,patch:0};static PROTOCOL_NAME="BCP";static async dispatch(n,s,r){const o={protocol:this.PROTOCOL_NAME,version:this.PROTOCOL_VERSION,domain:n,message:{id:Rn(),timestamp:Date.now(),idempotency_key:r,intent:s}};try{console.log(`[BladeDispatcher] Dispatching ${n} intent:`,s),await q("dispatch",{envelope:o})}catch(i){throw console.error("[BladeDispatcher] Failed to dispatch:",i),i}}static async chat(n){return this.dispatch("Chat",{type:"Chat",payload:n})}static async editor(n){return this.dispatch("Editor",{type:"Editor",payload:n})}static async file(n){return this.dispatch("File",{type:"File",payload:n})}static async workflow(n){return this.dispatch("Workflow",{type:"Workflow",payload:n})}static async terminal(n){return this.dispatch("Terminal",{type:"Terminal",payload:n})}}const xe={CHANGE_APPLIED:"change-applied",ALL_EDITS_APPLIED:"all-edits-applied",TODO_UPDATED:"todo_updated"},ot=c.createContext(void 0),An=({children:t})=>{const[n,s]=c.useState({activeFile:null,cursorLine:null,cursorColumn:null,selectionStartLine:null,selectionEndLine:null}),r=c.useCallback(d=>{s(u=>({...u,activeFile:d}))},[]),o=c.useCallback((d,u)=>{s(h=>({...h,cursorLine:d,cursorColumn:u}))},[]),i=c.useCallback((d,u)=>{s(h=>({...h,selectionStartLine:d,selectionEndLine:u}))},[]),a=c.useCallback(()=>{s(d=>({...d,selectionStartLine:null,selectionEndLine:null}))},[]);return e.jsx(ot.Provider,{value:{editorState:n,setActiveFile:r,setCursorPosition:o,setSelection:i,clearSelection:a},children:t})},Oe=()=>{const t=c.useContext(ot);if(!t)throw new Error("useEditor must be used within EditorProvider");return t};class zn{chunks;nextSeq;onApply;onComplete;constructor(n,s){this.chunks=new Map,this.nextSeq=0,this.onApply=n,this.onComplete=s}add(n,s,r){for(this.chunks.set(n,{seq:n,data:s,is_final:r});this.chunks.has(this.nextSeq);){const o=this.chunks.get(this.nextSeq);if(this.onApply(o.data,o.is_final),this.chunks.delete(this.nextSeq),this.nextSeq++,o.is_final&&this.onComplete){this.onComplete(),this.clear();break}}}clear(){this.chunks.clear(),this.nextSeq=0}getPendingCount(){return this.chunks.size}getNextSeq(){return this.nextSeq}}class at{buffers;onApply;onComplete;constructor(n,s){this.buffers=new Map,this.onApply=n,this.onComplete=s}add(n,s,r,o){this.buffers.has(n)||this.buffers.set(n,new zn((i,a)=>this.onApply(n,i,a),()=>{this.onComplete&&this.onComplete(n),this.buffers.delete(n)})),this.buffers.get(n).add(s,r,o)}clear(n){const s=this.buffers.get(n);s&&(s.clear(),this.buffers.delete(n))}clearAll(){this.buffers.clear()}getStats(){const n=[];return this.buffers.forEach((s,r)=>{n.push({id:r,pending:s.getPendingCount(),nextSeq:s.getNextSeq()})}),n}}class Tn extends at{constructor(n,s){super((r,o,i)=>n(r,o.chunk,i??!1,o.type||"content"),s)}addMessageDelta(n,s,r,o){this.add(n,s,{chunk:r,is_final:o,type:"content"},o)}addReasoningDelta(n,s,r,o){this.add(n,s,{chunk:r,is_final:o,type:"reasoning"},o)}}class In extends at{constructor(n){super((s,r)=>n(s,r.data))}addOutput(n,s,r){this.add(n,s,{data:r})}}function On(t,n,s){const r=Date.now();return`${t}-${n}-${r}`}class $n{cache;ttl;constructor(n=6e4){this.cache=new Map,this.ttl=n}set(n,s,r){const o=`${n}:${s}`;this.cache.set(o,{key:r,timestamp:Date.now()}),this.cleanup()}get(n,s){const r=`${n}:${s}`,o=this.cache.get(r);return o?Date.now()-o.timestamp>this.ttl?(this.cache.delete(r),null):o.key:null}has(n,s){return this.get(n,s)!==null}cleanup(){const n=Date.now(),s=[];this.cache.forEach((r,o)=>{n-r.timestamp>this.ttl&&s.push(o)}),s.forEach(r=>this.cache.delete(r))}clear(){this.cache.clear()}size(){return this.cleanup(),this.cache.size}}const He=new $n;function Ee(t,n){const s=He.get(t,n);if(s)return console.log(`[Idempotency] Using cached key for ${t}:${n}`),s;const r=On(t,n);return He.set(t,n,r),console.log(`[Idempotency] Generated new key for ${t}:${n}`),r}const ke={APPROVE_CHANGE:"approve-change",APPROVE_ALL:"approve-all",REJECT_CHANGE:"reject-change",REJECT_ALL:"reject-all",SAVE_FILE:"save-file",DELETE_FILE:"delete-file",EXECUTE_COMMAND:"execute-command"};function it(){const{editorState:t}=Oe(),[n,s]=c.useState([]),[r,o]=c.useState(!1),[i,a]=c.useState(null),d=c.useRef(null),u=c.useRef({id:"",content:""}),h=c.useRef({id:"",content:""}),[w,N]=c.useState([]),[m,E]=c.useState("anthropic/claude-sonnet-4-5-20250929"),l=c.useCallback(async g=>{try{await q("log_frontend",{message:g})}catch(v){console.error("[useChat] log_frontend failed",v)}},[]),[C,f]=c.useState(null),[j,b]=c.useState([]);c.useEffect(()=>{async function g(){try{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window)){console.log("Not in Tauri environment, skipping chat init");return}const[v,_]=await Promise.all([q("get_conversation"),q("list_models")]);if(console.log("Loaded conversation:",v),s(v),N(_),_.length>0){const T=_.find(R=>R.id==="anthropic/claude-sonnet-4-5-20250929")||_.find(R=>R.id==="openai/gpt-5.2")||_[0];E(T.id)}}catch(v){console.error("Failed to init:",v)}}g()},[]),c.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let g,v,_,T,R,U;d.current||(d.current=new Tn((P,oe,mt,$e)=>{if(o(!0),$e==="reasoning"){h.current.id!==P&&(h.current={id:P,content:""}),h.current.content+=oe;const re=h.current.content;s(K=>{const ee=K.findIndex(te=>te.id===P);if(ee!==-1){const te=[...K],ae={...te[ee],reasoning:re},X=[...ae.blocks||[]],J=X[X.length-1];return J&&J.type==="reasoning"?X[X.length-1]={...J,content:J.content+oe}:X.push({type:"reasoning",content:oe,id:crypto.randomUUID()}),ae.blocks=X,te[ee]=ae,te}return[...K,{id:P,role:"Assistant",reasoning:re,content:"",blocks:[{type:"reasoning",content:re,id:crypto.randomUUID()}]}]})}else{u.current.id!==P&&(u.current={id:P,content:""}),u.current.content+=oe;const re=u.current.content;s(K=>{const ee=K.findIndex(G=>G.id===P);if(ee!==-1){const G=[...K],X={...G[ee],content:re},J=[...X.blocks||[]],A=J[J.length-1];return A&&A.type==="text"?J[J.length-1]={...A,content:A.content+oe}:J.push({type:"text",content:oe,id:crypto.randomUUID()}),X.blocks=J,G[ee]=X,G}const te=K[K.length-1];if(te&&te.role==="Assistant"&&!te.id){const G=[...K],ae=G[K.length-1];return G[K.length-1]={...ae,id:P,content:re,blocks:[...ae.blocks||[],{type:"text",content:oe,id:crypto.randomUUID()}]},G}return[...K,{id:P,role:"Assistant",content:re,blocks:[{type:"text",content:re,id:crypto.randomUUID()}]}]})}},P=>{console.log(`[v1.1 MessageBuffer] Message ${P} completed`),o(!1)}));const se=(async()=>{g=await O("chat-done",()=>{o(!1),f(null)}),v=await O("chat-error",A=>{a(A.payload),o(!1),f(null)}),_=await O("request-confirmation",A=>{console.log("Permission requested for:",A.payload),f(A.payload.actions)}),T=await O("propose-changes",A=>{console.log("[PROPOSE CHANGES] received",A.payload.map(z=>({id:z.id,type:z.change_type,path:z.path}))),b(z=>{const I=A.payload.filter(D=>!z.some(M=>M.id===D.id));return[...z,...I]}),A.payload.forEach(z=>{if(z.change_type==="new_file"){const I=z.path.split("/").pop()||z.path;rt("open-ephemeral-document",{id:`new-file-${z.id}`,title:`NEW: ${I}`,content:z.content,suggestedName:z.path})}})}),R=await O("command-executed",A=>{console.log("[COMMAND EXECUTED]",A.payload),s(z=>{const I=z.findIndex((Z,Q)=>Z.role==="Assistant"&&Q===z.length-1);if(I===-1)return z;const D=[...z],M=D[I];return D[I]={...M,commandExecutions:[...M.commandExecutions||[],{command:A.payload.command,cwd:A.payload.cwd,output:A.payload.output,exitCode:A.payload.exitCode,duration:A.payload.duration,timestamp:Date.now()}]},D})});const ee=await O(xe.CHANGE_APPLIED,A=>{const{change_id:z,file_path:I}=A.payload;console.log("[CHAT] Change applied signal received:",z,"for",I),b(D=>D.filter(M=>M.id!==z&&M.path!==I))}),G=await O(xe.ALL_EDITS_APPLIED,A=>{const{file_paths:z}=A.payload;console.log("[CHAT] All changes applied for:",z),b(I=>I.filter(D=>!z.includes(D.path)))}),X=await O(xe.TODO_UPDATED,A=>{console.log("[TODO UPDATED]",A.payload),s(z=>{const I=[...z];for(let D=I.length-1;D>=0;D--)if(I[D].role==="Assistant"){I[D]={...I[D],todos:A.payload.todos};break}return I})});return U=await O("blade-event",A=>{const z=A.payload;if(z.event.type==="Chat"){const I=z.event.payload;if(I.type==="MessageDelta"){const{id:D,seq:M,chunk:Z,is_final:Q}=I.payload;console.log(`[v1.1 Chat] MessageDelta: id=${D}, seq=${M}, is_final=${Q}, chunk_len=${Z.length}`),d.current&&d.current.addMessageDelta(D,M,Z,Q)}else if(I.type==="ReasoningDelta"){const{id:D,seq:M,chunk:Z,is_final:Q}=I.payload;console.log(`[v1.1 Chat] ReasoningDelta: id=${D}, seq=${M}, is_final=${Q}, chunk_len=${Z.length}`),d.current&&d.current.addReasoningDelta(D,M,Z,Q)}else if(I.type==="MessageCompleted"){const{id:D}=I.payload;console.log(`[v1.1 Chat] MessageCompleted: id=${D}`),d.current&&d.current.clear(D),u.current.id===D&&(u.current={id:"",content:""}),h.current.id===D&&(h.current={id:"",content:""}),o(!1)}else if(I.type==="ToolUpdate"){const{message_id:D,tool_call_id:M,status:Z,result:Q,tool_call:le}=I.payload;console.log(`[v1.1 Chat] ToolUpdate: msg=${D} tool=${M} status=${Z}`),s(we=>{if(we.findIndex(Y=>Y.id===D)===-1){const Y={id:D,role:"Assistant",content:"",tool_calls:le?[{...le,status:Z,result:Q}]:[],blocks:le?[{type:"tool_call",id:M}]:[]};return[...we,Y]}return we.map(Y=>{if(Y.id===D){const je=Y.tool_calls||[],ce=je.findIndex(Ne=>Ne.id===M);let de=[...je],ge=[...Y.blocks||[]];if(ce>=0)de[ce]={...de[ce],status:Z},Q&&(de[ce].result=Q),le&&(de[ce]={...de[ce],...le});else if(le){const Ne=Y.content_before_tools!==void 0?Y.content_before_tools:Y.content;return ge.some(Fe=>Fe.type==="tool_call"&&Fe.id===M)||ge.push({type:"tool_call",id:M}),{...Y,content_before_tools:Ne,tool_calls:[...je,le],blocks:ge}}else console.warn("[v1.1 Chat] Received ToolUpdate for unknown tool but no tool_call data provided:",M);return{...Y,tool_calls:de,blocks:ge}}return Y})})}}}),()=>{g&&g(),v&&v(),_&&_(),T&&T(),R&&R(),ee&&ee(),G&&G(),X&&X(),U&&U()}})();return()=>{se.then(P=>P())}},[]);const p=c.useCallback(async g=>{try{o(!0),a(null);const v={id:crypto.randomUUID(),role:"User",content:g};s(U=>[...U,v]);const _=t.activeFile,T=_||null,R=_?[_]:[];await W.chat({type:"SendMessage",payload:{content:g,model:m,context:{active_file:T,open_files:R,cursor_line:t.cursorLine??null,cursor_column:t.cursorColumn??null,selection_start:t.selectionStartLine??null,selection_end:t.selectionEndLine??null}}})}catch(v){console.error("Failed to send message:",v),a(v instanceof Error?v.message:String(v))}},[t.activeFile,t.cursorLine,t.cursorColumn,t.selectionStartLine,t.selectionEndLine,m]),y=c.useCallback(async()=>{try{await W.chat({type:"StopGeneration"}),o(!1),f(null)}catch(g){console.error("Failed to stop generation:",g)}},[]),x=c.useCallback(async g=>{console.log("[useChat] approveChange called with:",g),l(`[approveChange] changeId=${g}`);try{const v=j.find(T=>T.id===g);console.log("[useChat] Found change:",v),l(`[approveChange] found change path=${v?.path??"n/a"} type=${v?.change_type??"n/a"}`);const _=Ee(ke.APPROVE_CHANGE,g);await W.dispatch("Workflow",{type:"Workflow",payload:{type:"ApproveAction",payload:{action_id:g}}},_),console.log("[useChat] Backend approve_action completed"),l(`[approveChange] backend completed changeId=${g}`),b(T=>{if(v){const R=T.filter(U=>U.id!==g&&U.path!==v.path);return R.length<T.length-1&&console.log(`[CHANGE] Removed ${T.length-R.length-1} stale changes for ${v.path}`),R}return T.filter(R=>R.id!==g)})}catch(v){console.error("Failed to approve change:",v)}},[j,l]),k=c.useCallback(async g=>{try{const v=Ee(ke.REJECT_CHANGE,g);await W.dispatch("Workflow",{type:"Workflow",payload:{type:"RejectAction",payload:{action_id:g}}},v),b(_=>_.filter(T=>T.id!==g))}catch(v){console.error("Failed to reject change:",v)}},[]),$=c.useCallback(async()=>{try{console.log("[useChat] approveAllChanges called; pendingChanges:",j.map(_=>({id:_.id,path:_.path,type:_.change_type}))),l(`[approveAllChanges] count=${j.length} ids=${j.map(_=>_.id).join(",")}`);const g=`batch-${Date.now()}`,v=Ee(ke.APPROVE_ALL,g);await W.dispatch("Workflow",{type:"Workflow",payload:{type:"ApproveAll",payload:{batch_id:g}}},v),console.log("[useChat] Backend approve_all completed"),l("[approveAllChanges] backend completed"),b([])}catch(g){console.error("Failed to approve all changes:",g)}},[j,l]),L=c.useCallback(g=>{b(v=>v.filter(_=>!g.includes(_.id)))},[]),F=c.useCallback(async g=>{try{await W.workflow({type:"ApproveTool",payload:{approved:g}}),f(null)}catch(v){console.error("Failed to approve tool:",v)}},[]),S=c.useCallback(async g=>{try{await W.workflow({type:"ApproveToolDecision",payload:{decision:g}}),f(null)}catch(v){console.error("Failed to approve tool decision:",v)}},[]);return{messages:n,loading:r,error:i,sendMessage:p,stopGeneration:y,models:w,selectedModelId:m,setSelectedModelId:E,pendingActions:C,approveTool:F,approveToolDecision:S,pendingChanges:j,approveChange:x,approveAllChanges:$,rejectChange:k,removeChangesFromList:L}}function Fn(){const[t,n]=c.useState(new Map);return c.useEffect(()=>{let r;return(async()=>r=await O("command-execution-started",i=>{console.log("[CMD EXEC] Started:",i.payload),n(a=>{const d=new Map(a);return d.set(i.payload.call_id,{commandId:i.payload.command_id,callId:i.payload.call_id,command:i.payload.command,cwd:i.payload.cwd,isRunning:!0}),d})}))(),()=>{r&&r()}},[]),{executions:t,handleCommandComplete:async(r,o,i)=>{console.log("[CMD EXEC] Complete:",{callId:r,exitCode:i,outputLength:o.length}),n(a=>{const d=new Map(a),u=d.get(r);return u&&d.set(r,{...u,output:o,exitCode:i,isRunning:!1}),d});try{await q("submit_command_result",{callId:r,output:o,exitCode:i}),console.log("[CMD EXEC] Result submitted to backend")}catch(a){console.error("[CMD EXEC] Failed to submit result:",a)}}}}const qe=({toolCall:t,status:n="pending"})=>{const s=()=>{switch(n){case"executing":return e.jsx(et,{className:"w-3.5 h-3.5 text-blue-400 animate-spin"});case"complete":return e.jsx(Qe,{className:"w-3.5 h-3.5 text-emerald-400"});case"error":return e.jsx(Se,{className:"w-3.5 h-3.5 text-red-400"});case"skipped":return e.jsx(Se,{className:"w-3.5 h-3.5 text-yellow-400"});default:return e.jsx(gt,{className:"w-3.5 h-3.5 text-purple-400"})}},r=()=>{switch(n){case"executing":return"border-blue-500/20 bg-[#0d1117]";case"complete":return"border-emerald-500/20 bg-[#0d1117]";case"error":return"border-red-500/30 bg-[#0d1117]";case"skipped":return"border-yellow-500/30 bg-[#0d1117]";default:return"border-zinc-700/50 bg-[#0d1117]"}},o=()=>{switch(n){case"executing":return"Executing";case"complete":return"Complete";case"error":return"Failed";case"skipped":return"Skipped";default:return"Pending"}},i=(u,h)=>{if(u==="apply_patch"&&h){const N=h.patches;if(N&&N.length>1)return`ðŸ“ Applying ${N.length} Code Changes`}return{apply_patch:"ðŸ“ Applying Code Changes",edit_file:"âœï¸ Editing File",read_file:"ðŸ“– Reading File",write_file:"ðŸ’¾ Writing File",list_files:"ðŸ“‚ Listing Files",grep_search:"ðŸ” Searching Code",run_command:"âš™ï¸ Running Command",create_file:"ðŸ“„ Creating File",delete_file:"ðŸ—‘ï¸ Deleting File",list_directory:"ðŸ“ Listing Directory",get_workspace_structure:"ðŸ—‚ï¸ Analyzing Workspace"}[u]||u};let a={};try{a=JSON.parse(t.function.arguments)}catch{a={raw:t.function.arguments}}const d=["apply_patch"].includes(t.function.name);return e.jsxs("div",{className:`border rounded-md overflow-hidden transition-all duration-200 ${r()}`,children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-zinc-900/40",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s(),e.jsx("span",{className:"text-xs font-medium text-zinc-200",children:i(t.function.name,a)}),e.jsx("span",{className:"text-[9px] font-mono text-zinc-600 bg-zinc-900/80 px-1.5 py-0.5 rounded border border-zinc-800/50",children:t.id?.slice(0,8)||"unknown"})]}),e.jsx("span",{className:`text-[9px] font-mono uppercase tracking-wider font-semibold ${n==="complete"?"text-emerald-400":n==="executing"?"text-blue-400":n==="error"?"text-red-400":n==="skipped"?"text-yellow-400":"text-zinc-500"}`,children:o()})]}),!d&&Object.keys(a).length>0&&e.jsx("div",{className:"px-3 py-2.5 space-y-1.5 bg-zinc-950/30",children:Object.entries(a).map(([u,h])=>{let w=typeof h=="string"?h:JSON.stringify(h);return w.length>200&&(w=w.substring(0,200)+"..."),e.jsxs("div",{className:"flex gap-3 text-xs items-start",children:[e.jsxs("span",{className:"font-mono text-zinc-500 min-w-[80px] shrink-0",children:[u,":"]}),e.jsx("span",{className:"font-mono text-zinc-300 flex-1 break-all select-text",children:w})]},u)})})]})},Ke=({command:t,cwd:n,output:s,exitCode:r,duration:o})=>{const[i,a]=c.useState(!0),d=r===0;return e.jsxs("div",{className:"my-3 bg-[#1e1e1e] border border-[#3e3e42] rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>a(!i),className:"w-full flex items-center gap-3 px-4 py-3 bg-[#252526] hover:bg-[#2d2d2d] transition-colors text-left",children:[e.jsx("div",{className:`p-1.5 rounded ${d?"bg-emerald-500/10":"bg-red-500/10"}`,children:d?e.jsx(Qe,{className:"w-4 h-4 text-emerald-500"}):e.jsx(Se,{className:"w-4 h-4 text-red-500"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ue,{className:"w-3.5 h-3.5 text-zinc-400"}),e.jsx("code",{className:"text-sm font-mono text-white truncate",children:t})]}),n&&e.jsx("div",{className:"text-xs font-mono text-zinc-500 truncate",children:n})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-zinc-400",children:[o!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bt,{className:"w-3 h-3"}),e.jsxs("span",{children:[o,"ms"]})]}),e.jsxs("div",{className:`px-2 py-0.5 rounded text-xs font-medium ${d?"bg-emerald-500/10 text-emerald-400":"bg-red-500/10 text-red-400"}`,children:["Exit ",r]}),i?e.jsx(me,{className:"w-4 h-4"}):e.jsx(be,{className:"w-4 h-4"})]})]}),i&&s&&e.jsx("div",{className:"border-t border-[#3e3e42]",children:e.jsx("pre",{className:"p-4 text-xs font-mono text-zinc-300 overflow-x-auto max-h-[400px] overflow-y-auto bg-[#1e1e1e] select-text",children:s})}),i&&!s&&e.jsx("div",{className:"border-t border-[#3e3e42] px-4 py-3 text-xs text-zinc-500 italic",children:"No output"})]})},Ge=({actions:t,onRun:n,onSkip:s})=>e.jsxs("div",{className:"border border-blue-500/30 rounded-lg overflow-hidden bg-blue-950/10 my-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-900/20 border-b border-blue-500/20",children:[e.jsx(ue,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-blue-300",children:"Command Approval Required"})]}),e.jsx("div",{className:"px-3 py-2 space-y-2",children:t.map((r,o)=>e.jsxs("div",{className:"bg-[#0d1117] border border-zinc-800 rounded overflow-hidden",children:[r.cwd&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-900/50 border-b border-zinc-800",children:[e.jsx(Le,{className:"w-3 h-3 text-zinc-500"}),e.jsx("span",{className:"text-[10px] font-mono text-zinc-500",children:r.cwd})]}),e.jsx("div",{className:"px-3 py-2",children:e.jsx("code",{className:"text-xs font-mono text-zinc-200 break-all",children:r.description})})]},o))}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-zinc-900/30 border-t border-blue-500/20",children:[e.jsxs("button",{onClick:s,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 rounded text-xs font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800/50 transition-colors",children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),"Skip"]}),e.jsxs("button",{onClick:n,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 rounded text-xs font-medium bg-blue-600 hover:bg-blue-500 text-white transition-colors",children:[e.jsx(yt,{className:"w-3.5 h-3.5"}),"Run"]})]})]}),Pn=({item:t})=>{const n=t.status==="completed"?"âœ“":t.status==="in_progress"?"âŸ³":"",s=t.status==="in_progress"?t.activeForm:t.content;return e.jsxs("div",{className:`todo-item todo-${t.status}`,children:[e.jsx("span",{className:"todo-icon",children:n}),e.jsx("span",{className:"todo-text",children:s})]})},Mn=({todos:t})=>!t||t.length===0?null:e.jsx("div",{className:"todo-list",children:t.map((n,s)=>e.jsx(Pn,{item:n},s))}),Xe=({content:t,isActive:n,hasContent:s})=>{const[r,o]=c.useState(!1),i=c.useRef(n);return c.useEffect(()=>{n&&!i.current&&!s&&o(!0),s&&r&&n&&o(!1),i.current=n},[n,s,r]),t?e.jsxs("div",{className:"my-3 rounded-md border border-zinc-800 bg-zinc-900/40 overflow-hidden group/reasoning",children:[e.jsxs("button",{onClick:()=>o(!r),className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-zinc-800/50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 group-hover/reasoning:text-zinc-400 transition-colors",children:[e.jsx(jt,{className:`w-3.5 h-3.5 ${n&&!s?"text-purple-400 animate-pulse":""}`}),e.jsx("span",{className:"font-mono text-[10px] uppercase tracking-wider font-semibold",children:n&&!s?"Reasoning...":"Reasoning Process"})]}),e.jsx("div",{className:"flex-1"}),n&&!s&&e.jsx(et,{className:"w-3 h-3 text-purple-500/50 animate-spin mr-2"}),r?e.jsx(me,{className:"w-3.5 h-3.5 text-zinc-600"}):e.jsx(be,{className:"w-3.5 h-3.5 text-zinc-600"})]}),r&&e.jsx("div",{className:"px-3 py-3 border-t border-zinc-800/50 bg-zinc-950/30",children:e.jsx("div",{className:"prose prose-invert prose-xs max-w-none text-zinc-400 font-mono text-[11px] leading-relaxed select-text",children:e.jsx(he,{children:t})})})]}):null},Bn=({message:t,pendingActions:n,onApproveCommand:s,onSkipCommand:r,isContinued:o=!1,isActive:i=!1})=>{const a=t.role==="User",d=t.role==="System",u=t.role==="Tool",h=t.role==="Assistant";if(u)return null;const w=!!t.reasoning;(t.tool_calls||[]).filter(f=>f.function.name!=="todo_write").length>0;const m=t.content_before_tools!==void 0||t.content_after_tools!==void 0;let E="",l="";m?(E=t.content_before_tools||"",l=t.content_after_tools||"",!l&&t.content.length>E.length&&t.content.startsWith(E)&&(l=t.content.slice(E.length))):(E=t.content,l="");const C=E.length>0||l.length>0;return e.jsxs("div",{className:`flex gap-3 px-4 group ${o?"pt-1 pb-2":"pt-4 pb-4"} ${a?"bg-zinc-800/10":""} ${u?"opacity-70":""}`,children:[e.jsxs("div",{className:"w-5 shrink-0 flex flex-col items-center",children:[!o&&e.jsxs("div",{className:"mt-0.5 opacity-80 group-hover:opacity-100 transition-opacity",children:[a&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-zinc-700/50 flex items-center justify-center",children:e.jsx(vt,{className:"w-3 h-3 text-zinc-300"})}),h&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500/10 flex items-center justify-center",children:e.jsx(wt,{className:"w-3.5 h-3.5 text-emerald-500"})}),d&&e.jsx(ue,{className:"w-4 h-4 text-yellow-600"}),u&&e.jsx(ue,{className:"w-4 h-4 text-purple-500/80"})]}),o&&e.jsx("div",{className:"w-px h-full bg-zinc-800/50"})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1 overflow-hidden",children:[!o&&e.jsxs("div",{className:"flex items-center gap-2 h-5 mb-1",children:[e.jsx("span",{className:"font-semibold text-[11px] text-zinc-400",children:a?"User":h?"Assistant":t.role}),u&&t.tool_call_id&&e.jsx("span",{className:"text-[10px] font-mono text-zinc-600 bg-zinc-900 border border-zinc-800 px-1.5 rounded-sm",children:t.tool_call_id.slice(0,8)})]}),t.blocks&&t.blocks.length>0?e.jsxs(e.Fragment,{children:[t.blocks.map((f,j)=>{if(f.type==="reasoning")return e.jsx(Xe,{content:f.content,isActive:i&&j===t.blocks.length-1,hasContent:!1},f.id||`reasoning-${j}`);if(f.type==="text")return e.jsx("div",{className:`prose prose-invert prose-xs max-w-none text-zinc-300 leading-relaxed mb-3 select-text blocks-text
                                        prose-headings:text-zinc-200 prose-headings:font-semibold
                                        prose-p:text-zinc-300 prose-p:leading-relaxed prose-p:my-2
                                        prose-strong:text-zinc-100 prose-strong:font-semibold
                                        prose-a:text-emerald-400 prose-a:no-underline hover:prose-a:underline
                                        prose-code:text-emerald-400 prose-code:bg-zinc-900 prose-code:px-1 prose-code:py-0.5 prose-code:rounded
                                        prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800
                                        prose-ul:text-zinc-300 prose-ul:my-2 prose-ol:text-zinc-300 prose-ol:my-2
                                        prose-li:text-zinc-300 prose-li:leading-relaxed prose-li:my-1
                                        prose-blockquote:border-l-emerald-500 prose-blockquote:text-zinc-400`,children:e.jsx(he,{children:f.content})},f.id||`text-${j}`);if(f.type==="tool_call"){const b=t.tool_calls?.find(p=>p.id===f.id);return b?e.jsx("div",{className:"mb-3 space-y-2",children:e.jsx(qe,{toolCall:b,status:b.status||"executing",result:b.result})},f.id):null}return null}),n&&n.length>0&&s&&r&&e.jsx("div",{className:"mb-3",children:e.jsx(Ge,{actions:n,onRun:s,onSkip:r})}),t.commandExecutions&&t.commandExecutions.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:t.commandExecutions.map((f,j)=>e.jsx(Ke,{command:f.command,cwd:f.cwd,output:f.output,exitCode:f.exitCode,duration:f.duration},`${f.timestamp}-${j}`))})]}):(()=>{const f=(t.tool_calls||[]).filter(x=>x.function.name!=="todo_write"),j=f.length>0,b=t.content_before_tools!==void 0||t.content_after_tools!==void 0;let p="",y="";return b?(p=t.content_before_tools||"",y=t.content_after_tools||"",!y&&t.content.length>p.length&&t.content.startsWith(p)&&(y=t.content.slice(p.length))):p=t.content,e.jsxs(e.Fragment,{children:[w&&e.jsx(Xe,{content:t.reasoning,isActive:i,hasContent:C}),p&&e.jsx("div",{className:"prose prose-invert prose-xs max-w-none text-zinc-300 leading-relaxed mb-3 select-text",children:e.jsx(he,{children:p})}),n&&n.length>0&&s&&r&&e.jsx("div",{className:"mb-3",children:e.jsx(Ge,{actions:n,onRun:s,onSkip:r})}),j&&e.jsx("div",{className:"mb-3 space-y-2",children:f.map((x,k)=>e.jsx(qe,{toolCall:x,status:x.status||"executing",result:x.result},`${x.id}-${k}`))}),t.todos&&t.todos.length>0&&e.jsx(Mn,{todos:t.todos}),y&&e.jsx("div",{className:"prose prose-invert prose-xs max-w-none text-zinc-300 leading-relaxed select-text",children:e.jsx(he,{children:y})}),t.commandExecutions&&t.commandExecutions.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:t.commandExecutions.map((x,k)=>e.jsx(Ke,{command:x.command,cwd:x.cwd,output:x.output,exitCode:x.exitCode,duration:x.duration},`${x.timestamp}-${k}`))})]})})()]})]})},Un=({onSend:t,onStop:n,disabled:s,loading:r})=>{const{t:o}=ze(),[i,a]=c.useState(""),d=c.useRef(null);c.useEffect(()=>{d.current&&(d.current.style.height="auto",d.current.style.height=d.current.scrollHeight+"px")},[i]);const u=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),i.trim()&&!s&&!r&&(t(i),a("")))};return e.jsx("div",{className:"p-3 border-t border-[var(--border-subtle)] bg-[var(--bg-app)] pb-5",children:e.jsxs("div",{className:`relative bg-[var(--bg-surface)] rounded-md overflow-hidden border transition-colors ${r?"border-[var(--border-focus)]":"border-[var(--border-subtle)] focus-within:border-[var(--fg-secondary)]"}`,children:[e.jsx("textarea",{ref:d,value:i,onChange:h=>a(h.target.value),onKeyDown:u,placeholder:o("chat.inputPlaceholder"),className:"w-full bg-transparent text-[var(--fg-primary)] p-3 pr-10 outline-none resize-none min-h-[42px] max-h-[200px] text-xs font-mono placeholder-[var(--fg-tertiary)]",rows:1,disabled:s||r}),e.jsx("button",{onClick:()=>{r&&n?n():i.trim()&&!s&&(t(i),a(""))},disabled:!i.trim()&&!r||s,className:`absolute right-2 bottom-2 p-1.5 transition-colors rounded hover:bg-[var(--bg-surface-hover)] ${r?"text-red-400":"text-[var(--fg-tertiary)] hover:text-[var(--fg-primary)] disabled:opacity-30 disabled:cursor-not-allowed"}`,children:r?e.jsx(Nt,{className:"w-3.5 h-3.5 fill-current animate-pulse"}):e.jsx(_t,{className:"w-3.5 h-3.5"})})]})})},Wn=({models:t,selectedId:n,onSelect:s,disabled:r})=>{const[o,i]=c.useState(!1),a=c.useRef(null),d=t.find(h=>h.id===n)||null;c.useEffect(()=>{const h=w=>{a.current&&!a.current.contains(w.target)&&i(!1)};return o&&document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[o]);const u=h=>{const w=h.toLowerCase();return w.includes("gpt")?e.jsx(Ct,{className:"w-3.5 h-3.5 text-green-400"}):w.includes("claude")?e.jsx(Et,{className:"w-3.5 h-3.5 text-orange-400"}):w.includes("gemini")?e.jsx(kt,{className:"w-3.5 h-3.5 text-blue-400"}):e.jsx(Pe,{className:"w-3.5 h-3.5 text-zinc-400"})};return e.jsxs("div",{className:"relative w-full",ref:a,children:[e.jsxs("button",{type:"button",onClick:()=>!r&&i(!o),disabled:r,className:`
                    w-full flex items-center justify-between px-3 py-1.5 
                    bg-[var(--bg-surface)] hover:bg-[var(--bg-surface-hover)]
                    border border-[var(--border-subtle)] hover:border-[var(--border-hover)]
                    rounded transition-all duration-200 group
                    ${o?"ring-1 ring-[var(--accent-primary)]/50 border-[var(--accent-primary)]/50":""}
                    ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("div",{className:"shrink-0 p-0.5 rounded bg-[var(--bg-app)]/50 border border-[var(--border-subtle)]",children:d?u(d.id):e.jsx(Pe,{className:"w-3 h-3"})}),e.jsx("div",{className:"flex flex-col items-start min-w-0",children:e.jsx("span",{className:"text-[11px] font-medium text-[var(--fg-secondary)] truncate w-full text-left",children:d?.name||"Select Model"})})]}),e.jsx(me,{className:`w-3 h-3 text-[var(--fg-tertiary)] transition-transform duration-200 ${o?"rotate-180":""}`})]}),o&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1.5 py-1 bg-[var(--bg-panel)] border border-[var(--border-subtle)] rounded shadow-xl z-50 max-h-[300px] overflow-y-auto flex flex-col gap-0.5 animate-in fade-in zoom-in-95 duration-100 origin-top",children:[t.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-[var(--fg-tertiary)] text-center italic",children:"No models available"}),t.map(h=>{const w=h.id===n;return e.jsxs("button",{onClick:()=>{s(h.id),i(!1)},className:`
                                    flex items-center gap-3 px-3 py-2 mx-1 rounded-sm text-left
                                    transition-colors duration-150
                                    ${w?"bg-[var(--accent-primary)]/10 text-[var(--fg-primary)]":"text-[var(--fg-secondary)] hover:bg-[var(--bg-surface-hover)] hover:text-[var(--fg-primary)]"}
                                `,children:[e.jsx("div",{className:"shrink-0 mt-0.5",children:u(h.id)}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs font-medium truncate",children:h.name}),h.description&&e.jsx("span",{className:"text-[10px] text-[var(--fg-tertiary)] truncate opacity-80",children:h.description})]}),w&&e.jsx(ye,{className:"w-3.5 h-3.5 text-[var(--accent-primary)] shrink-0"})]},h.id)})]})]})},Vn=({commandId:t,command:n,cwd:s,onComplete:r})=>{const o=c.useRef(null),i=c.useRef(null),a=c.useRef(""),d=c.useRef(!0),[u,h]=c.useState("Running..."),w=c.useRef(r);return c.useEffect(()=>{w.current=r},[r]),c.useEffect(()=>{if(!o.current||i.current)return;const N=new tt({cursorBlink:!1,fontFamily:"monospace",fontSize:12,theme:{background:"#0a0a0a",foreground:"#e5e5e5"},rows:8,cols:80,scrollback:1e3,disableStdin:!0});return N.open(o.current),i.current=N,N.write(`\x1B[1;36m$ ${n}\x1B[0m\r
`),(async()=>{try{const E=`chat-cmd-${t}`,l=await O("terminal-output",f=>{f.payload.id===E&&(N.write(f.payload.data),a.current+=f.payload.data)}),C=await O("terminal-exit",f=>{if(f.payload.id===E){d.current=!1;const j=f.payload.exit_code;j===0?(N.write(`\r
\x1B[1;32mâœ“ Command completed successfully\x1B[0m\r
`),h("Completed")):(N.write(`\r
\x1B[1;31mâœ— Command failed with exit code ${j}\x1B[0m\r
`),h(`Failed (exit ${j})`)),w.current&&w.current(a.current,j),l(),C()}});await W.terminal({type:"Spawn",payload:{id:E,command:n,cwd:s||void 0,interactive:!1}})}catch(E){console.error("Failed to execute command:",E),N.write(`\r
\x1B[31mFailed to execute command: ${E}\x1B[0m\r
`),d.current=!1,h("Error"),w.current&&w.current(a.current,1)}})(),()=>{N.dispose(),i.current=null}},[t,n,s]),e.jsxs("div",{className:"my-2 border border-zinc-800 rounded-lg overflow-hidden bg-[#0a0a0a]",children:[e.jsx("div",{className:"flex items-center justify-between px-3 py-2 bg-zinc-900/50 border-b border-zinc-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-3.5 h-3.5 text-emerald-500"}),e.jsx("span",{className:"text-xs font-mono text-zinc-400",children:u})]})}),e.jsx("div",{ref:o,className:"w-full",style:{height:"200px",overflow:"hidden"}})]})},Hn=()=>{const{t}=ze(),{messages:n,loading:s,error:r,sendMessage:o,stopGeneration:i,models:a,selectedModelId:d,setSelectedModelId:u,pendingActions:h,approveToolDecision:w,pendingChanges:N,approveAllChanges:m,rejectChange:E}=it(),{executions:l,handleCommandComplete:C}=Fn(),f=c.useRef(null),j=c.useRef(!0);return c.useEffect(()=>{(n[n.length-1]?.role==="User"||j.current)&&f.current?.scrollIntoView({behavior:"smooth"})},[n,s,N]),e.jsxs("div",{className:"flex flex-col h-full bg-[var(--bg-app)] text-[var(--fg-primary)] font-sans tracking-tight",children:[e.jsx("header",{className:"h-10 border-b border-[var(--border-subtle)] flex items-center px-2 bg-[var(--bg-app)] select-none shrink-0 z-30",children:e.jsx("div",{className:"w-full",children:e.jsx(Wn,{models:a,selectedId:d||"",onSelect:u,disabled:s})})}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-800 scrollbar-track-transparent",onScroll:b=>{const p=b.target,y=Math.abs(p.scrollHeight-p.scrollTop-p.clientHeight)<50;j.current=y},children:e.jsxs("div",{className:"max-w-4xl mx-auto py-6",children:[n.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-[var(--fg-tertiary)] text-center space-y-4 select-none",children:[e.jsx("div",{className:"text-4xl opacity-20 filter grayscale",children:"ðŸ—¡ï¸"}),e.jsx("h2",{className:"text-sm font-medium text-[var(--fg-secondary)] tracking-wide uppercase",children:"System Ready"}),e.jsx("p",{className:"max-w-xs text-xs font-mono opacity-50",children:"Awaiting input. Surgical precision engaged."})]}),n.map((b,p)=>{const y=p===n.length-1,k=y&&b.role==="Assistant"&&h&&h.length>0,$=p>0?n[p-1]:null,L=b.role==="Assistant",F=$?.role==="Assistant",S=L&&F,g=y&&s,v=b.tool_calls?.map(_=>l.get(_.id)).filter(Boolean)||[];return e.jsxs(pe.Fragment,{children:[e.jsx(Bn,{message:b,pendingActions:k?h:void 0,onApproveCommand:k?()=>w("approve_once"):void 0,onSkipCommand:k?()=>w("reject"):void 0,isContinued:S,isActive:g}),v.map(_=>_&&e.jsxs("div",{className:"px-4 py-2 pl-[44px]",children:[" ",e.jsx(Vn,{commandId:_.commandId,command:_.command,cwd:_.cwd,onComplete:(T,R)=>{C(_.callId,T,R)}})]},_.callId))]},p)}),N.length>0&&e.jsxs("div",{className:"px-4 py-3 bg-purple-900/20 border border-purple-500/30 rounded-md mx-4",children:[e.jsxs("div",{className:"text-xs text-purple-300 font-semibold mb-1",children:["ðŸ“ ",N.length," change",N.length>1?"s":""," pending review"]}),e.jsx("div",{className:"text-xs text-[var(--fg-secondary)]",children:N.map(b=>b.path?.split("/").pop()||"unknown").join(", ")}),e.jsx("div",{className:"text-xs text-[var(--fg-tertiary)] mt-2",children:"Open the file in the editor to review changes, or use the buttons below."})]}),r&&e.jsxs("div",{className:"p-3 mx-4 mb-4 bg-red-500/5 border border-red-500/20 text-red-400 rounded-sm text-xs font-mono",children:["ERR: ",r]}),e.jsx("div",{ref:f,className:"h-4"})]})}),N.length>0&&e.jsx("div",{className:"shrink-0 px-3 py-2 bg-[var(--bg-panel)] border-t border-[var(--border-subtle)]",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400 animate-pulse"}),e.jsxs("span",{className:"text-[10px] text-[var(--fg-secondary)] font-mono uppercase tracking-wide",children:[N.length," ",N.length===1?"change":"changes"," pending review"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>{N.forEach(b=>E(b.id))},className:"flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-medium bg-red-600/80 hover:bg-red-500 text-white transition-colors",children:[e.jsx(fe,{className:"w-3 h-3"}),t("diff.rejectAll")]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-medium bg-emerald-600/80 hover:bg-emerald-500 text-white transition-colors",children:[e.jsx(ye,{className:"w-3 h-3"}),t("diff.acceptAll")]})]})]})}),e.jsx("div",{className:"shrink-0 z-20",children:e.jsx(Un,{onSend:o,onStop:i,loading:s})})]})},qn=(t,n,s)=>t?n?s?e.jsx(Le,{className:"w-3.5 h-3.5 text-[var(--fg-secondary)] fill-[var(--fg-secondary)]/20"}):e.jsx(Le,{className:"w-3.5 h-3.5 text-[var(--fg-tertiary)]"}):t.endsWith(".rs")?e.jsx(_e,{className:"w-3.5 h-3.5 text-orange-600/80"}):t.endsWith(".tsx")||t.endsWith(".ts")?e.jsx(_e,{className:"w-3.5 h-3.5 text-blue-500/80"}):t.endsWith(".json")||t.endsWith(".toml")?e.jsx(_e,{className:"w-3.5 h-3.5 text-yellow-500/80"}):t.endsWith(".md")?e.jsx(Te,{className:"w-3.5 h-3.5 text-[var(--fg-secondary)]"}):e.jsx(Me,{className:"w-3.5 h-3.5 text-[var(--fg-tertiary)]"}):e.jsx(Me,{className:"w-3.5 h-3.5 text-[var(--fg-tertiary)]"}),Kn=({onFileSelect:t,activeFile:n,roots:s,refreshKey:r})=>{const o=pe.useRef(new Map);pe.useEffect(()=>{s.forEach(a=>{o.current.has(a.path)||o.current.set(a.path,{id:a.path,name:a.name,is_dir:a.is_dir,data:a})})},[s]);const i=Ht({rootItemId:"root",getItemName:a=>a.getItemData()?.name||"Unknown",isItemFolder:a=>a.getItemData()?.is_dir||!1,features:[qt,Kt,Gt,Xt,Yt],createLoadingItemData:()=>({id:"loading",name:"Loading...",is_dir:!1}),dataLoader:{getItem:a=>a==="root"?{id:"root",name:"root",is_dir:!0}:o.current.get(a)||{id:a,name:a.split("/").pop()||a,is_dir:!1},getChildren:a=>{const d=a==="root"?null:a;return a==="root"&&s.length>0?(s.forEach(u=>{o.current.set(u.path,{id:u.path,name:u.name,is_dir:u.is_dir,data:u})}),s.map(u=>u.path)):new Promise((u,h)=>{Ie(()=>Promise.resolve().then(()=>Cn),void 0).then(async({listen:w})=>{let N=!1;const m=await w("sys-event",E=>{let l=E.payload;if(l.event&&l.id&&l.timestamp&&(l=l.event),l.type==="File"&&l.payload.type==="Listing"&&l.payload.payload.path===d){N=!0;const C=l.payload.payload.entries;C.forEach(f=>{o.current.set(f.path,{id:f.path,name:f.name,is_dir:f.is_dir,data:f})}),u(C.map(f=>f.path)),m()}});W.file({type:"List",payload:{path:d}}),setTimeout(()=>{m(),N||u([])},5e3)})})}}});return e.jsxs("div",{className:"flex flex-col h-full w-full",children:[e.jsxs("div",{className:"px-2 py-2 border-b border-[var(--border-subtle)] flex items-center gap-2",children:[e.jsx(St,{className:"w-3 h-3 text-[var(--fg-tertiary)]"}),e.jsx("input",{type:"text",placeholder:"Search...",className:"bg-transparent border-none outline-none text-xs w-full text-[var(--fg-primary)] placeholder-[var(--fg-tertiary)]",onChange:a=>i.setSearch(a.target.value)})]}),e.jsxs("div",{...i.getContainerProps(),className:"flex-1 overflow-y-auto text-xs font-mono select-none outline-none",children:[i.getItems().map(a=>c.createElement("div",{...a.getProps(),key:a.getId(),className:`group flex items-center gap-1.5 py-1 px-2 cursor-pointer relative
                            ${a.isSelected()?"bg-[var(--bg-selection)] text-[var(--accent-secondary)]":"text-[var(--fg-secondary)] hover:bg-[var(--bg-surface-hover)]"}
                            ${a.isFocused()?"ring-1 ring-inset ring-[var(--border-focus)]":""}
                        `,style:{paddingLeft:`${a.getItemMeta().level*12+8}px`},onClick:d=>{a.isFolder()?a.isExpanded()?a.collapse():a.expand():(a.select(),t(a.getId()))}},Array.from({length:a.getItemMeta().level}).map((d,u)=>e.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-[var(--border-subtle)]/20",style:{left:`${u*12+11}px`}},u)),e.jsx("span",{className:`transition-transform duration-200 ${a.isExpanded()?"rotate-90":""}`,children:a.isFolder()?e.jsx(be,{className:"w-3 h-3 text-[var(--fg-tertiary)] group-hover:text-[var(--fg-secondary)] transition-colors"}):e.jsx("span",{className:"w-3"})}),qn(a.getItemName(),a.isFolder(),a.isExpanded()),e.jsx("span",{className:"truncate opacity-90 group-hover:opacity-100 transition-opacity",children:a.getItemName()}))),i.getItems().length===0&&e.jsx("div",{className:"p-4 text-[var(--fg-tertiary)] italic",children:s.length>0?"Loading tree...":"Waiting for workspace..."})]})]})};class Gn extends c.Component{state={hasError:!1,error:null};static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){console.error("Uncaught error:",n,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error):e.jsxs("div",{className:"p-4 text-red-500 overflow-auto h-full text-xs font-mono bg-zinc-950",children:[e.jsx("h2",{className:"font-bold mb-2",children:"Something went wrong."}),e.jsx("pre",{children:this.state.error?.toString()}),e.jsx("pre",{className:"mt-2 text-zinc-500",children:this.state.error?.stack})]}):this.props.children}}const Xn=({onFileSelect:t,activeFile:n})=>{const[s,r]=c.useState([]),[o,i]=c.useState(null),[a,d]=c.useState(0),u=pe.useCallback(async()=>{if(!(typeof window>"u"||!("__TAURI_INTERNALS__"in window)))try{await W.file({type:"List",payload:{path:null}}),i(null)}catch(m){console.warn("Failed to load root:",m),i(String(m))}},[]);c.useEffect(()=>{let m;return(async()=>m=await O("sys-event",l=>{const C=l.payload;if(C.type==="File"){const f=C.payload;f.type==="Listing"&&f.payload.path===null&&r(f.payload.entries)}}))(),()=>{m&&m()}},[]),c.useEffect(()=>{u()},[u]),c.useEffect(()=>{let m;return(async()=>m=await O("refresh-explorer",()=>{console.log("[EXPLORER] Refresh event received"),d(l=>l+1),u()}))(),()=>{m&&m()}},[u]);const[h,w]=c.useState(""),N=async()=>{try{const{invoke:m}=await Ie(async()=>{const{invoke:E}=await Promise.resolve().then(()=>jn);return{invoke:E}},void 0);await m("open_workspace",{path:h}),u()}catch(m){console.error(m),i(String(m))}};return e.jsxs("div",{className:"h-full bg-[var(--bg-panel)] border-r border-[var(--border-subtle)] flex flex-col text-[var(--fg-secondary)]",children:[e.jsxs("div",{className:"h-9 px-4 flex items-center bg-[var(--bg-panel)] border-b border-[var(--border-subtle)] text-[10px] uppercase tracking-wider font-semibold select-none justify-between text-[var(--fg-tertiary)]",children:[e.jsx("span",{children:"Explorer"}),e.jsx("button",{onClick:u,className:"hover:text-[var(--fg-primary)]",title:"Refresh",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pt-2 scrollbar-thin scrollbar-thumb-zinc-800",children:s.length===0?e.jsxs("div",{className:"p-4 flex flex-col gap-2",children:[e.jsx("p",{className:"text-xs text-[var(--fg-tertiary)] italic text-center",children:"No workspace open."}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{className:"bg-[var(--bg-surface)] border border-[var(--border-subtle)] text-xs p-1 w-full rounded-sm text-[var(--fg-primary)]",placeholder:"/path/to/folder",value:h,onChange:m=>w(m.target.value),onKeyDown:m=>m.key==="Enter"&&N()}),e.jsx("button",{onClick:N,className:"p-1.5 bg-[var(--bg-surface)] hover:bg-[var(--bg-surface-hover)] rounded-sm text-[var(--fg-primary)]",children:e.jsx(be,{className:"w-3 h-3"})})]}),o&&e.jsx("p",{className:"text-[10px] text-[var(--accent-error)] break-all",children:o})]}):e.jsx(Gn,{children:e.jsx(Kn,{onFileSelect:t,activeFile:n,roots:s,refreshKey:a})})})]})},Yn=({original:t,modified:n,onAccept:s,onReject:r})=>e.jsxs("div",{className:"my-1 rounded-md overflow-hidden border border-zinc-700 font-mono text-sm bg-[#1e1e1e] shadow-lg select-none",children:[e.jsxs("div",{className:"flex items-center justify-between bg-zinc-800 px-2 py-1 border-b border-zinc-700",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs text-zinc-400",children:e.jsx("span",{className:"font-semibold text-purple-400",children:"AI Suggestion"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:s,className:"flex items-center gap-1 px-3 py-1 rounded bg-emerald-600 text-white hover:bg-emerald-500 transition-colors text-xs font-semibold shadow-lg",children:[e.jsx(ye,{className:"w-3 h-3"}),"Accept"]}),e.jsxs("button",{onClick:r,className:"flex items-center gap-1 px-3 py-1 rounded bg-red-600 text-white hover:bg-red-500 transition-colors text-xs font-semibold shadow-lg",children:[e.jsx(fe,{className:"w-3 h-3"}),"Reject"]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"bg-red-900/20 border-l-2 border-red-500/50 p-2 opacity-70 relative group",children:[e.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-50 text-[10px] text-red-400",children:"ORIGINAL"}),e.jsx("pre",{className:"m-0 whitespace-pre-wrap text-red-100/70 strike-through",children:t})]}),e.jsxs("div",{className:"bg-emerald-900/20 border-l-2 border-emerald-500/50 p-2 relative group",children:[e.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-50 text-[10px] text-emerald-400",children:"MODIFIED"}),e.jsx("pre",{className:"m-0 whitespace-pre-wrap text-emerald-100",children:n})]})]})]}),Jn=H.define(),Re=H.define(),lt=H.define();H.define();H.define();class Ye extends Jt{constructor(n){super(),this.diff=n}eq(n){return n.diff.id===this.diff.id}toDOM(n){const s=document.createElement("div"),r=Lt.createRoot(s),o=()=>{const a=n.posAtDOM(s),d=this.diff.to-this.diff.from,u=a+d;n.dispatch({changes:{from:a,to:u,insert:this.diff.modified},effects:Re.of(this.diff.id)})},i=()=>{n.dispatch({effects:Re.of(this.diff.id)})};return r.render(e.jsx(Yn,{original:this.diff.original,modified:this.diff.modified,onAccept:o,onReject:i})),s}}const Zn=ve.define({create(){return V.none},update(t,n){t=t.map(n.changes);for(const s of n.effects)if(s.is(Jn)){const r=V.replace({widget:new Ye(s.value),block:!0});t=t.update({add:[r.range(s.value.from,s.value.to)]})}else s.is(Re)?t=t.update({filter:(r,o,i)=>!(i.spec.widget instanceof Ye&&i.spec.widget.diff.id===s.value)}):s.is(lt)&&(t=V.none);return t},provide:t=>ie.decorations.from(t)}),ct=H.define(),dt=H.define(),Qn=V.line({attributes:{class:"cm-highlighted-line",style:"background-color: rgba(255, 255, 0, 0.15); border-left: 3px solid rgba(255, 255, 0, 0.6);"}}),es=ve.define({create(){return V.none},update(t,n){t=t.map(n.changes);for(const s of n.effects)if(s.is(ct)){const{startLine:r,endLine:o}=s.value,i=[];for(let a=r;a<=o;a++)try{const d=n.state.doc.line(a);i.push(Qn.range(d.from))}catch{console.warn(`Line ${a} out of range`)}t=V.set(i)}else s.is(dt)&&(t=V.none);return t},provide:t=>ie.decorations.from(t)}),Ae=H.define(),ts=H.define(),ns=H.define(),ss=H.define(),rs=H.define(),os=H.define();function ut(t,n){let s=t;for(const r of n)r.accepted&&(s=s.replace(r.old_content,r.new_content));return s}const pt=ve.define({create(){return{baseContent:"",pendingDiffs:[],isDirty:!1}},update(t,n){let s=t;for(const r of n.effects)r.is(Ae)?s={baseContent:r.value,pendingDiffs:[],isDirty:!1}:r.is(ts)?s={...s,pendingDiffs:[...s.pendingDiffs,r.value]}:r.is(ns)?s={...s,pendingDiffs:s.pendingDiffs.map(o=>o.id===r.value?{...o,accepted:!0}:o),isDirty:!0}:r.is(ss)?s={...s,pendingDiffs:s.pendingDiffs.filter(o=>o.id!==r.value)}:r.is(rs)?s={baseContent:ut(s.baseContent,s.pendingDiffs),pendingDiffs:[],isDirty:!1}:r.is(os)&&(s={...s,pendingDiffs:[],isDirty:!1});return s}});function as(t){const n=t.state.field(pt);return ut(n.baseContent,n.pendingDiffs)}const ft=H.define(),ht=H.define(),is=V.line({class:"cm-diff-removed-line"});V.line({class:"cm-diff-added-line"});V.line({class:"cm-diff-context-line"});const ls=ve.define({create(){return{diff:null,decorations:V.none}},update(t,n){let s=t.diff,r=t.decorations;for(const o of n.effects)if(o.is(ft))if(s=o.value,s){const i=[];for(const a of s.hunks)for(let d=a.fromLine;d<=a.toLine;d++)try{const u=n.state.doc.line(d);i.push(is.range(u.from))}catch{}i.sort((a,d)=>a.from-d.from),r=V.set(i)}else r=V.none;else o.is(ht)&&(s=null,r=V.none);return n.docChanged&&r!==V.none&&(r=r.map(n.changes)),{diff:s,decorations:r}},provide:t=>ie.decorations.from(t,n=>n.decorations)}),cs=ie.theme({".cm-diff-removed-line":{backgroundColor:"rgba(239, 68, 68, 0.15)",borderLeft:"3px solid rgba(239, 68, 68, 0.6)"},".cm-diff-added-line":{backgroundColor:"rgba(34, 197, 94, 0.15)",borderLeft:"3px solid rgba(34, 197, 94, 0.6)"},".cm-diff-context-line":{backgroundColor:"rgba(161, 161, 170, 0.05)"},".cm-diff-ghost-text":{color:"rgba(34, 197, 94, 0.7)",fontStyle:"italic"}});function Je(t,n,s){const r=t.indexOf(n);if(r===-1)return null;const i=(t.substring(0,r).match(/\n/g)||[]).length+1,a=(n.match(/\n/g)||[]).length+1,d=i+a-1,u=[];for(let w=i;w<=d;w++)u.push(w);return{removedLines:u,addedLines:[]}}const xt=c.forwardRef(({content:t,onChange:n,onSave:s,filename:r,highlightLines:o},i)=>{const a=c.useRef(null),d=c.useRef(null),u=c.useRef(new Zt),{setCursorPosition:h,setSelection:w,clearSelection:N}=Oe();c.useImperativeHandle(i,()=>({getView:()=>d.current,clearDiffs:()=>{d.current&&d.current.dispatch({effects:lt.of(null)})},showInlineDiff:l=>{const C=d.current;if(!C)return;if(!l){C.dispatch({effects:ht.of(null)});return}const f=C.state.doc.toString(),j=[];if(l.change_type==="patch"){const b=Je(f,l.old_content,l.new_content);b&&j.push({id:`${l.id}-0`,fromLine:b.removedLines[0]||1,toLine:b.removedLines[b.removedLines.length-1]||1,oldText:l.old_content,newText:l.new_content})}else l.change_type==="multi_patch"&&l.patches.forEach((b,p)=>{const y=Je(f,b.old_text,b.new_text);y&&j.push({id:`${l.id}-${p}`,fromLine:b.start_line||y.removedLines[0]||1,toLine:b.end_line||y.removedLines[y.removedLines.length-1]||1,oldText:b.old_text,newText:b.new_text})});j.length>0&&C.dispatch({effects:ft.of({id:l.id,hunks:j,path:l.path})})}}));const m=l=>l?l.endsWith(".rs")?bn():l.endsWith(".js")||l.endsWith(".jsx")?We():l.endsWith(".ts")||l.endsWith(".tsx")?We({typescript:!0}):[]:[];c.useEffect(()=>{if(!a.current||d.current)return;const l=Qt.create({doc:t,extensions:[en(),tn(),nn(),sn(),rn(),on(),an(),ln(),cn(),dn(yn),un,Zn,es,pt,ls,cs,ie.theme({"&":{height:"100%"},".cm-scroller":{overflow:"auto"}}),u.current.of(m(r)),pn.of([{key:"Mod-s",run:f=>{if(s){const j=as(f);s(j)}return!0}},...fn,...hn,...xn,...mn,...gn]),ie.updateListener.of(f=>{if(f.docChanged&&n(f.state.doc.toString()),f.selectionSet){const j=f.state.selection.main,b=f.state.doc.lineAt(j.head),p=b.number,y=j.head-b.from;if(h(p,y),j.from!==j.to){const x=f.state.doc.lineAt(j.from).number,k=f.state.doc.lineAt(j.to).number;w(x,k)}else N()}})]}),C=new ie({state:l,parent:a.current});return d.current=C,()=>{C.destroy(),d.current=null}},[]);const E=c.useRef(r);return c.useEffect(()=>{const l=d.current;if(!l)return;r!==E.current?(E.current=r,l.dispatch({changes:{from:0,to:l.state.doc.length,insert:t},effects:[u.current.reconfigure(m(r)),Ae.of(t)]})):l.state.doc.toString()!==t&&l.dispatch({changes:{from:0,to:l.state.doc.length,insert:t},effects:Ae.of(t)})},[r,t]),c.useEffect(()=>{const l=d.current;if(l&&t)if(o)try{setTimeout(()=>{if(!d.current)return;const C=d.current.state.doc.line(o.startLine);d.current.dispatch({effects:[ct.of({startLine:o.startLine,endLine:o.endLine}),ie.scrollIntoView(C.from,{y:"center"})]})},100)}catch(C){console.error("Error applying line highlight:",C)}else l.dispatch({effects:dt.of(null)})},[o,t]),e.jsx("div",{className:"h-full w-full relative",children:e.jsx("div",{ref:a,className:"h-full w-full overflow-hidden text-base"})})});xt.displayName="CodeEditor";const ds=({currentFileIndex:t,totalFiles:n,currentHunkIndex:s,totalHunks:r,onAccept:o,onReject:i,onNextFile:a,onPrevFile:d,onNextHunk:u,onPrevHunk:h,filename:w})=>(pe.useEffect(()=>{const N=m=>{m.ctrlKey&&m.key==="Enter"&&(m.preventDefault(),o()),m.ctrlKey&&m.key==="Backspace"&&(m.preventDefault(),i()),m.altKey&&m.key==="k"&&(m.preventDefault(),h?.()),m.altKey&&m.key==="j"&&(m.preventDefault(),u?.())};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[o,i,u,h]),e.jsx("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50",children:e.jsxs("div",{className:"flex items-center gap-1 bg-zinc-900/95 border border-zinc-700/60 rounded-lg shadow-2xl px-2 py-1.5 backdrop-blur-sm",children:[e.jsxs("button",{onClick:o,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium bg-emerald-600 hover:bg-emerald-500 text-white transition-colors",title:"Accept Changes (Ctrl+Enter)",children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Accept Changes"}),e.jsx("kbd",{className:"ml-1 px-1 py-0.5 text-[9px] bg-emerald-700/50 rounded",children:"Ctrl+â†µ"})]}),e.jsxs("button",{onClick:i,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium bg-zinc-700 hover:bg-red-600 text-zinc-300 hover:text-white transition-colors",title:"Reject (Ctrl+Backspace)",children:[e.jsx("span",{children:"Reject"}),e.jsx("kbd",{className:"ml-1 px-1 py-0.5 text-[9px] bg-zinc-600/50 rounded",children:"Ctrl+âŒ«"})]}),e.jsx("div",{className:"w-px h-5 bg-zinc-700 mx-1"}),r&&r>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:h,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 transition-colors",title:"Previous hunk (Alt+K)",children:e.jsx(Be,{className:"w-3.5 h-3.5"})}),e.jsx("span",{className:"text-[10px] text-zinc-500 font-mono px-1",children:e.jsx("kbd",{className:"text-zinc-600",children:"Alt+K"})}),e.jsx("button",{onClick:u,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 transition-colors",title:"Next hunk (Alt+J)",children:e.jsx(me,{className:"w-3.5 h-3.5"})}),e.jsx("span",{className:"text-[10px] text-zinc-500 font-mono px-1",children:e.jsx("kbd",{className:"text-zinc-600",children:"Alt+J"})}),e.jsx("div",{className:"w-px h-5 bg-zinc-700 mx-1"})]}),e.jsx("button",{onClick:d,disabled:t<=1,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Previous file",children:e.jsx(Be,{className:"w-3.5 h-3.5"})}),e.jsxs("span",{className:"text-xs text-zinc-400 font-mono min-w-[80px] text-center",children:["Edited files ",e.jsxs("span",{className:"text-zinc-200",children:[t,"/",n]})]}),e.jsx("button",{onClick:a,disabled:t>=n,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Next file",children:e.jsx(me,{className:"w-3.5 h-3.5"})})]})})),Ze=({activeFile:t,highlightLines:n,pendingEdit:s,onAcceptEdit:r,onRejectEdit:o,totalPendingFiles:i=1,currentFileIndex:a=1,onNextFile:d,onPrevFile:u})=>{const[h,w]=c.useState(""),[N,m]=c.useState(!1),[E,l]=c.useState(null),[C,f]=c.useState(0),{setActiveFile:j}=Oe(),b=c.useRef(null);c.useEffect(()=>{j(t)},[t,j]),c.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let y,x;return(async()=>(y=await O(xe.CHANGE_APPLIED,$=>{$.payload.file_path===t&&(console.log("[EDITOR] Change applied, reloading:",t),b.current&&b.current.clearDiffs(),f(L=>L+1))}),x=await O(xe.ALL_EDITS_APPLIED,$=>{$.payload.file_paths.includes(t||"")&&(console.log("[EDITOR] All edits applied, reloading:",t),b.current&&b.current.clearDiffs(),f(L=>L+1))})))(),()=>{y&&y(),x&&x()}},[t]),c.useEffect(()=>{if(!t)return;let y;return(async()=>y=await O("sys-event",k=>{const $=k.payload;if($.type==="File"){const L=$.payload;L.type==="Content"&&L.payload.path===t?(console.log("[EDITOR] Received content for:",t),w(L.payload.data),m(!1),l(null)):L.type==="Written"&&L.payload.path===t&&console.log("[EDITOR] Confirmed written:",t)}else if($.type==="System"){const L=$.payload;if(L.type==="IntentFailed"&&N){const F=L.payload.error;"details"in F&&F.details.id?.includes(t)&&(l(`Failed to load: ${JSON.stringify(F)}`),m(!1))}}}))(),()=>{y&&y()}},[t,N]),c.useEffect(()=>{async function y(){if(!t){w("");return}m(!0),l(null);try{typeof window<"u"&&await W.file({type:"Read",payload:{path:t}})}catch(x){console.error(x),l(String(x))}finally{m(!1)}}y()},[t,C]);const p=async y=>{if(t)try{await W.file({type:"Write",payload:{path:t,content:y}}),console.log("Save intent dispatched:",t)}catch(x){console.error("Save failed:",x)}};return t?e.jsxs("div",{className:"h-full flex flex-col relative bg-[#1e1e1e]",children:[N&&e.jsx("div",{className:"absolute inset-0 bg-black/50 z-10 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-emerald-500 border-t-transparent rounded-full"})}),E&&e.jsxs("div",{className:"bg-red-900/50 text-red-200 p-2 text-xs font-mono",children:["ERR_LOAD: ",E]}),e.jsx(xt,{ref:b,content:h,onChange:w,onSave:p,filename:t,highlightLines:n||void 0}),s&&s.path===t&&r&&o&&e.jsx(ds,{currentFileIndex:a,totalFiles:i,onAccept:async()=>{await r(s.id),setTimeout(()=>f(y=>y+1),100)},onReject:()=>{o(s.id)},onNextFile:d,onPrevFile:u,filename:s.path.split("/").pop()})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-zinc-600 select-none bg-zinc-900/50",children:[e.jsx("div",{className:"text-4xl opacity-20 mb-4 font-thin",children:"âˆ…"}),e.jsx("p",{className:"font-mono text-xs uppercase tracking-widest opacity-50",children:"No Active Buffer"})]})};function us({id:t="main-terminal"}){const n=c.useRef(null),s=c.useRef(null),r=c.useRef(null),o=c.useRef(null);return c.useEffect(()=>{if(!n.current||s.current)return;const i=new tt({cursorBlink:!0,fontFamily:'"Fira Code", "Symbols Nerd Font Mono", monospace',fontSize:12,lineHeight:1.2,theme:{background:"#09090b",foreground:"#d4d4d8",cursor:"#e4e4e7",selectionBackground:"rgba(255, 255, 255, 0.2)"},allowTransparency:!0,fontWeight:"normal",fontWeightBold:"bold"}),a=new Wt;i.loadAddon(a),i.loadAddon(new Vt),i.open(n.current);let d=0;const u=setInterval(()=>{d++;try{const l=a.proposeDimensions();l&&l.cols>0&&l.rows>0&&(a.fit(),clearInterval(u),i.refresh(0,i.rows-1))}catch{}d>20&&clearInterval(u)},100);s.current=i,r.current=a,(async()=>{try{const l=await q("get_current_workspace");await W.terminal({type:"Spawn",payload:{id:t,cwd:l||void 0,interactive:!0}}),setTimeout(()=>{const C=a.proposeDimensions();C&&W.terminal({type:"Resize",payload:{id:t,rows:C.rows,cols:C.cols}})},50)}catch(l){console.error("Failed to create terminal:",l),i.write(`\r
\x1B[31mFailed to initialize terminal backend.\x1B[0m\r
`)}})(),o.current||(o.current=new In((l,C)=>{l===t&&s.current&&s.current.write(C)}));const w=O("terminal-output",l=>{l.payload.id===t&&i.write(l.payload.data)}),N=O("blade-event",l=>{const C=l.payload;if(C.event.type==="Terminal"){const f=C.event.payload;if(f.type==="Output"){const{id:j,seq:b,data:p}=f.payload;o.current&&o.current.addOutput(j,b,p)}else if(f.type==="Spawned"){const{id:j,owner:b}=f.payload;console.log(`[v1.1 Terminal] Spawned: id=${j}, owner=${b.type}`)}else if(f.type==="Exit"){const{id:j,code:b}=f.payload;j===t&&s.current&&s.current.write(`\r
\x1B[33mProcess exited with code ${b}\x1B[0m\r
`)}}});i.onData(l=>{W.terminal({type:"Input",payload:{id:t,data:l}}).catch(console.error)});const m=()=>{if(!(!r.current||!n.current||!s.current))try{r.current.fit(),s.current.refresh(0,s.current.rows-1);const l=r.current.proposeDimensions();l&&l.cols>0&&l.rows>0&&W.terminal({type:"Resize",payload:{id:t,rows:l.rows,cols:l.cols}}).catch(C=>console.error("Resize failed",C))}catch(l){console.error("Resize logic error",l)}},E=new ResizeObserver(()=>{requestAnimationFrame(()=>{n.current?.offsetParent&&m()})});return E.observe(n.current),()=>{E.disconnect(),w.then(l=>l()),N.then(l=>l());try{i.dispose()}catch(l){console.error("Error disposing terminal",l)}s.current=null,o.current=null}},[t]),e.jsx("div",{ref:n,className:"w-full h-full bg-[var(--term-bg)]",style:{overflow:"hidden"}})}const ps=()=>{const[t,n]=c.useState([{id:"term-1",title:"Terminal 1"}]),[s,r]=c.useState("term-1"),o=()=>{const a=`term-${Date.now()}`,d={id:a,title:"zsh"};n([...t,d]),r(a)},i=(a,d)=>{if(a.stopPropagation(),t.length===1)return;const u=t.filter(h=>h.id!==d);n(u),s===d&&r(u[u.length-1].id)};return e.jsxs("div",{className:"h-full flex flex-row bg-[#1e1e1e]",children:[e.jsx("div",{className:"flex-1 relative overflow-hidden",children:t.map(a=>e.jsx("div",{className:"absolute inset-0 w-full h-full",style:{visibility:a.id===s?"visible":"hidden",zIndex:a.id===s?10:0},children:e.jsx(us,{id:a.id})},a.id))}),e.jsxs("div",{className:"w-48 bg-[#252526] border-l border-[#3c3c3c] flex flex-col",children:[e.jsxs("div",{className:"p-2 text-xs font-semibold text-zinc-400 uppercase tracking-wider flex items-center justify-between",children:[e.jsx("span",{children:"Terminals"}),e.jsx("button",{onClick:o,className:"hover:text-white transition-colors",children:e.jsx(Dt,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:t.map(a=>e.jsxs("div",{onClick:()=>r(a.id),className:`
                    group flex items-center justify-between px-3 py-2 cursor-pointer text-sm border-l-2
                    ${s===a.id?"bg-[#37373d] border-blue-500 text-white":"border-transparent text-zinc-400 hover:bg-[#2a2d2e] hover:text-zinc-200"}
                `,children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(ue,{className:"w-3.5 h-3.5 opacity-70"}),e.jsx("span",{className:"truncate",children:a.title})]}),t.length>1&&e.jsx("button",{onClick:d=>i(d,a.id),className:"opacity-0 group-hover:opacity-100 hover:bg-zinc-600 rounded p-0.5",children:e.jsx(fe,{className:"w-3 h-3"})})]},a.id))})]})]})},fs=({tabs:t,activeTabId:n,onTabClick:s,onTabClose:r})=>t.length===0?null:e.jsx("div",{className:"flex items-center bg-[#252526] border-b border-[#3c3c3c] overflow-x-auto",children:t.map(o=>{const i=n===o.id;return e.jsxs("div",{onClick:()=>s(o.id),className:`
              group flex items-center gap-2 px-3 py-2 min-w-[120px] max-w-[200px] cursor-pointer
              border-r border-[#3c3c3c] transition-colors relative
              ${i?"bg-[#1e1e1e] text-white border-t-2 border-t-emerald-500":"bg-[#2d2d2d] text-zinc-400 hover:bg-[#323233]"}
            `,children:[o.isEphemeral?e.jsx(Te,{className:`w-3.5 h-3.5 shrink-0 ${i?"text-yellow-400":"text-yellow-500"}`}):e.jsx(Rt,{className:`w-3.5 h-3.5 shrink-0 ${i?"text-blue-400":"text-zinc-500"}`}),e.jsx("span",{className:`text-xs truncate flex-1 ${i?"font-semibold":""}`,children:o.title}),o.hasVirtualChanges&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 shrink-0 animate-pulse",title:"Virtual changes (not saved to disk)"}),o.isDirty&&!o.hasVirtualChanges&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-white shrink-0"}),i&&e.jsx("button",{onClick:a=>{a.stopPropagation(),r(o.id)},className:"hover:bg-zinc-700 rounded p-0.5 transition-colors",children:e.jsx(fe,{className:"w-3 h-3"})})]},o.id)})}),hs=({documentId:t,title:n,content:s,isEphemeral:r,suggestedName:o,onClose:i,onSave:a,changeId:d,onApprove:u})=>{const[h,w]=c.useState(!1),N=async()=>{if(r){if(console.log("[DocumentViewer] Save clicked:",{changeId:d,hasOnApprove:!!u}),d&&u){console.log("[DocumentViewer] Approving change:",d),w(!0);try{u()}catch(E){console.error("Failed to approve change:",E)}finally{w(!1)}return}w(!0);try{const{save:E}=await Ie(async()=>{const{save:C}=await import("./index-CeDnaWDR.js");return{save:C}},__vite__mapDeps([0,1,2,3,4,5,6,7])),l=await E({defaultPath:o||"document.md",filters:[{name:"Markdown",extensions:["md"]}]});l&&(await q("save_ephemeral_document",{id:t,path:l}),a&&a(l))}catch(E){console.error("Failed to save document:",E)}finally{w(!1)}}},m=async()=>{if(r)try{await q("close_ephemeral_document",{id:t})}catch(E){console.error("Failed to close ephemeral document:",E)}i()};return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-950",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-zinc-800 bg-zinc-900/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-sm font-medium text-zinc-200",children:n}),r&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-yellow-500/10 text-yellow-500 border border-yellow-500/20",children:"Unsaved"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsxs("button",{onClick:N,disabled:h,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs rounded bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 border border-emerald-500/20 transition-colors disabled:opacity-50",children:[e.jsx(At,{className:"w-3.5 h-3.5"}),h?"Saving...":"Save"]}),e.jsx("button",{onClick:m,className:"p-1.5 rounded hover:bg-zinc-800 text-zinc-400 hover:text-zinc-200 transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-8",children:e.jsx("div",{className:`prose prose-invert prose-lg max-w-none
            prose-headings:text-zinc-100 prose-headings:font-semibold prose-headings:tracking-tight
            prose-h1:text-3xl prose-h1:mb-4 prose-h1:mt-0
            prose-h2:text-2xl prose-h2:mb-3 prose-h2:mt-8
            prose-h3:text-xl prose-h3:mb-2 prose-h3:mt-6
            prose-p:text-zinc-300 prose-p:leading-relaxed prose-p:mb-4
            prose-strong:text-zinc-100 prose-strong:font-semibold
            prose-a:text-emerald-400 prose-a:no-underline hover:prose-a:underline
            prose-code:text-emerald-400 prose-code:bg-zinc-900 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:before:content-[''] prose-code:after:content-['']
            prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800 prose-pre:rounded-lg prose-pre:shadow-xl
            prose-ul:text-zinc-300 prose-ul:my-4
            prose-ol:text-zinc-300 prose-ol:my-4
            prose-li:text-zinc-300 prose-li:leading-relaxed prose-li:my-1
            prose-blockquote:border-l-emerald-500 prose-blockquote:text-zinc-400 prose-blockquote:italic
            prose-hr:border-zinc-800 prose-hr:my-8
            prose-table:border-collapse prose-table:my-6
            prose-thead:border-b-2 prose-thead:border-zinc-700
            prose-th:text-zinc-200 prose-th:font-semibold prose-th:text-left prose-th:px-4 prose-th:py-3 prose-th:bg-zinc-900/50
            prose-td:text-zinc-300 prose-td:px-4 prose-td:py-3 prose-td:border-t prose-td:border-zinc-800
            prose-tr:transition-colors hover:prose-tr:bg-zinc-900/30`,children:e.jsx(he,{remarkPlugins:[Ut],components:{code({node:E,inline:l,className:C,children:f,...j}){const b=/language-(\w+)/.exec(C||"");return!l&&b?e.jsx(vn,{style:wn,language:b[1],PreTag:"div",...j,children:String(f).replace(/\n$/,"")}):e.jsx("code",{className:C,...j,children:f})}},children:s})})})})]})},xs=()=>{const[t,n]=c.useState([]),[s,r]=c.useState(!1),[o,i]=c.useState(!1),a=c.useRef(null);return c.useEffect(()=>{!o&&a.current&&a.current.scrollIntoView({behavior:"smooth"})},[t,o]),c.useEffect(()=>{},[o]),null},ms=()=>{const{t}=ze(),[n,s]=c.useState(null),[r,o]=c.useState([]),[i,a]=c.useState(300),[d,u]=c.useState(!1),[h,w]=c.useState(new Set),{pendingChanges:N,approveChange:m,rejectChange:E}=it(),l=c.useRef(new Set);c.useEffect(()=>{const p=async()=>{try{const x=await q("get_virtual_files");w(new Set(x))}catch(x){console.error("[VIRTUAL BUFFER] Failed to get virtual files:",x)}};p();const y=setInterval(p,1e3);return()=>clearInterval(y)},[]),c.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let p;return(async()=>p=await O("propose-edit",x=>{if(x.payload.length>0){const k=x.payload[0],$=r.find(L=>L.type==="file"&&L.path===k.path);if($)s($.id);else{const L=k.path.split("/").pop()||k.path,F={id:`file-${k.path}`,title:L,type:"file",path:k.path};o(S=>[...S,F]),s(F.id)}}}))(),()=>{p&&p()}},[r]);const C=p=>{const y=r.find(x=>x.type==="file"&&x.path===p);if(y)s(y.id);else{const x=p.split("/").pop()||p,k={id:`file-${p}`,title:x,type:"file",path:p};o($=>[...$,k]),s(k.id)}},f=p=>{o(y=>y.filter(x=>x.id!==p)),n===p&&s(r.length>1?r[0].id:null)},j=(p,y)=>{o(x=>{if(!x.find(F=>F.id===p))return x;const $=y.split("/").pop()||y,L={id:`file-${y}`,title:$,type:"file",path:y};return[...x.filter(F=>F.id!==p),L]}),s(`file-${y}`)},b=p=>{u(!0),p.preventDefault()};return c.useEffect(()=>{const p=x=>{if(!d)return;const k=window.innerHeight-x.clientY-24;k>100&&k<window.innerHeight-100&&a(k)},y=()=>{u(!1)};return d&&(document.addEventListener("mousemove",p),document.addEventListener("mouseup",y)),()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",y)}},[d]),c.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let p,y,x,k,$;return(async()=>{const F=(S,g)=>{console.log(`Opening file from backend (${g}):`,S);const v=`file-${S}`;if(l.current.has(S)){console.log("[LAYOUT] Ignoring duplicate file open event for:",S);return}l.current.add(S),o(_=>{if(_.find(ne=>ne.type==="file"&&ne.path===S))return l.current.delete(S),_;const R=S.split("/").pop()||S,U={id:v,title:R,type:"file",path:S};return l.current.delete(S),[..._,U]}),s(v)};p=await O("open-file",S=>{F(S.payload,"open-file")}),y=await O("file-opened",S=>{F(S.payload,"file-opened")}),x=await O("open-file-with-highlight",S=>{console.log("Opening file with highlight from backend:",S.payload);const{path:g,start_line:v,end_line:_}=S.payload,T=`file-${g}`;o(R=>{const U=R.find(P=>P.type==="file"&&P.path===g);if(U)return R.map(P=>P.id===U.id?{...P,highlightLines:{startLine:v,endLine:_}}:P);const ne=g.split("/").pop()||g,se={id:T,title:ne,type:"file",path:g,highlightLines:{startLine:v,endLine:_}};return[...R,se]}),s(T)}),k=await O("open-ephemeral-document",S=>{console.log("[LAYOUT] ðŸ“¥ Received open-ephemeral-document event:",{id:S.payload.id,title:S.payload.title,contentLength:S.payload.content.length,suggestedName:S.payload.suggestedName});const{id:g,title:v,content:_,suggestedName:T}=S.payload;o(R=>{if(R.find(se=>se.id===g))return console.log("[LAYOUT] âš ï¸ Tab already exists, just activating:",g),R;console.log("[LAYOUT] âœ… Creating new tab with ID:",g);const ne={id:g,title:v,type:"ephemeral",content:_,suggestedName:T};return console.log("[LAYOUT] Adding tab to existing tabs:",R.length,"â†’",R.length+1),[...R,ne]}),s(g)}),$=await O("change-applied",S=>{console.log("[LAYOUT] Change applied:",S.payload);const{change_id:g,file_path:v}=S.payload,_=`new-file-${g}`;o(T=>{if(!T.find(se=>se.id===_))return T;console.log("[LAYOUT] Converting ephemeral tab to file tab:",_,"â†’",v);const U=v.split("/").pop()||v,ne={id:`file-${v}`,title:U,type:"file",path:v};return[...T.filter(se=>se.id!==_),ne]}),s(`file-${v}`)})})(),()=>{p&&p(),y&&y(),x&&x(),k&&k(),$&&$()}},[r]),e.jsxs("div",{className:"h-screen w-screen bg-[var(--bg-app)] overflow-hidden flex flex-col font-sans text-[var(--fg-primary)]",children:[e.jsx("div",{className:"h-8 bg-[var(--bg-app)] flex items-center justify-center px-4 select-none -webkit-app-region-drag border-b border-[var(--border-subtle)] relative z-50",children:e.jsx("div",{className:"text-[10px] font-medium text-[var(--fg-tertiary)] tracking-widest uppercase opacity-70",children:"ZaguÃ¡n Blade"})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-[50px] bg-[var(--bg-app)] border-r border-[var(--border-subtle)] flex flex-col items-center py-4 gap-6 z-20 shrink-0",children:[e.jsx("div",{className:"p-2 rounded-md bg-[var(--bg-surface)] text-[var(--fg-primary)] shadow-sm border border-[var(--border-subtle)] group cursor-pointer hover:border-[var(--border-focus)] transition-colors",children:e.jsx("svg",{className:"w-5 h-5 opacity-90 group-hover:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("div",{className:"p-2 rounded-md text-[var(--fg-nav)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface)] transition-all cursor-pointer",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("div",{className:"mt-auto p-2 rounded-md text-[var(--fg-nav)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface)] transition-all cursor-pointer",children:e.jsx(zt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 flex w-full relative",children:[e.jsx("div",{className:"w-64 min-w-[200px] flex flex-col border-r border-[var(--border-subtle)] bg-[var(--bg-panel)]",children:e.jsx(Xn,{onFileSelect:C,activeFile:r.find(p=>p.id===n)?.path||null})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-[300px] bg-[var(--bg-app)] relative",children:[r.length>0&&e.jsx(fs,{tabs:r.map(p=>({id:p.id,title:p.title,isEphemeral:p.type==="ephemeral",isDirty:!1,hasVirtualChanges:p.path?h.has(p.path):!1})),activeTabId:n,onTabClick:s,onTabClose:f}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:(()=>{const p=r.find(L=>L.id===n);if(!p)return e.jsx(Ze,{activeFile:null,highlightLines:null});if(p.type==="ephemeral"){const F=p.id.startsWith("new-file-")?p.id.replace("new-file-",""):void 0;return e.jsx(hs,{documentId:p.id,title:p.title,content:p.content||"",isEphemeral:!0,suggestedName:p.suggestedName,onClose:()=>f(p.id),onSave:S=>j(p.id,S),changeId:F,onApprove:F?()=>m(F):void 0})}const y=N.find(L=>L.path===p.path),x=[...new Set(N.map(L=>L.path))],k=p.path?x.indexOf(p.path)+1:0,$=L=>{const F=`file-${L}`,S=r.find(g=>g.type==="file"&&g.path===L);if(S)s(S.id);else{const g=L.split("/").pop()||L;o(v=>[...v,{id:F,title:g,type:"file",path:L}]),s(F)}};return e.jsx(Ze,{activeFile:p.path||null,highlightLines:p.highlightLines||null,pendingEdit:y,onAcceptEdit:m,onRejectEdit:E,totalPendingFiles:x.length,currentFileIndex:k||1,onNextFile:x.length>1&&k<x.length?()=>$(x[k]):void 0,onPrevFile:x.length>1&&k>1?()=>$(x[k-2]):void 0})})()}),e.jsx("div",{className:`h-[1px] cursor-row-resize bg-[var(--border-subtle)] hover:bg-[var(--accent-secondary)] hover:h-[2px] transition-all z-20 ${d?"bg-[var(--accent-secondary)] h-[2px]":""}`,onMouseDown:b}),e.jsx("div",{style:{height:i},className:"bg-[var(--term-bg)]",children:e.jsx(ps,{})})]}),e.jsx("div",{className:"w-[400px] min-w-[320px] border-l border-[var(--border-subtle)] bg-[var(--bg-panel)] flex flex-col shadow-xl z-30",children:e.jsx(Hn,{})})]})]}),e.jsxs("div",{className:"h-6 bg-[var(--bg-app)] border-t border-[var(--border-subtle)] text-[var(--fg-tertiary)] flex items-center px-3 text-[10px] font-mono justify-between select-none z-40",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1.5 hover:text-[var(--fg-secondary)] cursor-pointer transition-colors",children:[e.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]}),"main*"]}),e.jsx("span",{className:"text-[var(--fg-secondary)]",children:(()=>{const p=r.find(y=>y.id===n);return p?p.title:t("editor.noFileOpen")})()})]}),e.jsxs("div",{className:"flex items-center gap-4 opacity-70",children:[e.jsx("span",{children:t("editor.encoding")}),e.jsx("span",{children:"Rust"}),e.jsx("span",{children:t("app.name")})]})]}),e.jsx(xs,{})]})},gs=()=>e.jsx(An,{children:e.jsx(ms,{})});function bs(){return e.jsxs(Tt,{children:[e.jsx(Ue,{path:"/",element:e.jsx(gs,{})}),e.jsx(Ue,{path:"*",element:e.jsx(It,{to:"/",replace:!0})})]})}Ot.use($t).use(Ft).use(Pt).init({fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"}});Mt.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Bt,{children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"h-screen w-screen bg-[var(--bg-app)]"}),children:e.jsx(bs,{})})})}));export{q as i};
