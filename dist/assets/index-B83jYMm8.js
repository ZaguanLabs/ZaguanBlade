const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B7hia_xh.js","assets/vendor-react-bp43k5q3.js","assets/vendor-xterm-CT6HrMBF.js","assets/vendor-xterm-DDGTF8rc.css","assets/vendor-tree-DoaNKNYF.js","assets/vendor-codemirror-DCC_EBuB.js","assets/vendor-syntax-B8STJVFL.js"])))=>i.map(i=>d[i]);
import{r as d,j as t,Z as on,C as Ge,b as _t,L as Et,T as ge,c as an,e as ke,g as Re,F as Ke,X as ue,P as ln,U as cn,B as dn,M as ve,i as ze,k as un,l as St,m as pn,o as hn,u as Ze,S as Dt,q as fn,t as rt,v as Te,w as mn,x as gn,y as xn,R as we,z as ot,A as at,D as zt,E as qe,G as bn,H as Lt,I as it,J as $e,K as Qe,_ as et,N as yn,O as wn,Q as vn,V as lt,W as jn,Y as Nn,$ as Cn,a0 as kn,a1 as _n,a2 as En,a3 as Sn,a4 as Dn,a5 as ct,a6 as zn,a7 as Ln,a8 as Rn,a9 as Tn,aa as An,ab as In,ac as Mn}from"./vendor-react-bp43k5q3.js";import{D as Rt,o as Pn,L as On}from"./vendor-xterm-CT6HrMBF.js";import{u as Fn,s as $n,a as Bn,b as Wn,h as Un,c as Vn}from"./vendor-tree-DoaNKNYF.js";import{E as se,H as Hn,t as y,s as Gn,g as Kn,c as dt,y as qn,m as Jn,h as Xn,a as Yn,j as Zn,p as Qn,b as Ee,r as es,D as q,V as Tt,R as At,d as ts,S as J,e as Ae,W as ns,C as ss,f as rs,l as os,i as as,k as is,n as ls,o as cs,q as ds,u as us,v as ps,w as hs,x as fs,z as ms,A as gs,B as xs,F as bs,G as ys,I as ws,J as vs,K as js,L as Ns,M as Cs,N as ks,O as _s,P as Es}from"./vendor-codemirror-DCC_EBuB.js";import{h as Ss,v as Ds}from"./vendor-syntax-B8STJVFL.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();function zs(n,e,s,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?r:s==="a"?r.call(n):r?r.value:e.get(n)}function Ls(n,e,s,r,o){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,s),s}var De;const re="__TAURI_TO_IPC_KEY__";function It(n,e=!1){return window.__TAURI_INTERNALS__.transformCallback(n,e)}async function g(n,e={},s){return window.__TAURI_INTERNALS__.invoke(n,e,s)}class Mt{get rid(){return zs(this,De,"f")}constructor(e){De.set(this,void 0),Ls(this,De,e)}async close(){return g("plugin:resources|close",{rid:this.rid})}}De=new WeakMap;const Rs=Object.freeze(Object.defineProperty({__proto__:null,Resource:Mt,SERIALIZE_TO_IPC_FN:re,invoke:g,transformCallback:It},Symbol.toStringTag,{value:"Module"}));var Y;(function(n){n.WINDOW_RESIZED="tauri://resize",n.WINDOW_MOVED="tauri://move",n.WINDOW_CLOSE_REQUESTED="tauri://close-requested",n.WINDOW_DESTROYED="tauri://destroyed",n.WINDOW_FOCUS="tauri://focus",n.WINDOW_BLUR="tauri://blur",n.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",n.WINDOW_THEME_CHANGED="tauri://theme-changed",n.WINDOW_CREATED="tauri://window-created",n.WEBVIEW_CREATED="tauri://webview-created",n.DRAG_ENTER="tauri://drag-enter",n.DRAG_OVER="tauri://drag-over",n.DRAG_DROP="tauri://drag-drop",n.DRAG_LEAVE="tauri://drag-leave"})(Y||(Y={}));async function Pt(n,e){window.__TAURI_EVENT_PLUGIN_INTERNALS__.unregisterListener(n,e),await g("plugin:event|unlisten",{event:n,eventId:e})}async function O(n,e,s){var r;const o=typeof s?.target=="string"?{kind:"AnyLabel",label:s.target}:(r=s?.target)!==null&&r!==void 0?r:{kind:"Any"};return g("plugin:event|listen",{event:n,target:o,handler:It(e)}).then(l=>async()=>Pt(n,l))}async function Ot(n,e,s){return O(n,r=>{Pt(n,r.id),e(r)},s)}async function Ie(n,e){await g("plugin:event|emit",{event:n,payload:e})}async function Ft(n,e,s){await g("plugin:event|emit_to",{target:typeof n=="string"?{kind:"AnyLabel",label:n}:n,event:e,payload:s})}const Ts=Object.freeze(Object.defineProperty({__proto__:null,get TauriEvent(){return Y},emit:Ie,emitTo:Ft,listen:O,once:Ot},Symbol.toStringTag,{value:"Module"})),K=[];for(let n=0;n<256;++n)K.push((n+256).toString(16).slice(1));function As(n,e=0){return(K[n[e+0]]+K[n[e+1]]+K[n[e+2]]+K[n[e+3]]+"-"+K[n[e+4]]+K[n[e+5]]+"-"+K[n[e+6]]+K[n[e+7]]+"-"+K[n[e+8]]+K[n[e+9]]+"-"+K[n[e+10]]+K[n[e+11]]+K[n[e+12]]+K[n[e+13]]+K[n[e+14]]+K[n[e+15]]).toLowerCase()}let Be;const Is=new Uint8Array(16);function Ms(){if(!Be){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Be=crypto.getRandomValues.bind(crypto)}return Be(Is)}const Ps=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ut={randomUUID:Ps};function Os(n,e,s){n=n||{};const r=n.random??n.rng?.()??Ms();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,As(r)}function Fs(n,e,s){return ut.randomUUID&&!n?ut.randomUUID():Os(n)}class G{static PROTOCOL_VERSION={major:1,minor:1,patch:0};static PROTOCOL_NAME="BCP";static async dispatch(e,s,r){const o={protocol:this.PROTOCOL_NAME,version:this.PROTOCOL_VERSION,domain:e,message:{id:Fs(),timestamp:Date.now(),idempotency_key:r,intent:s}};try{console.log(`[BladeDispatcher] Dispatching ${e} intent:`,s),await g("dispatch",{envelope:o})}catch(l){throw console.error("[BladeDispatcher] Failed to dispatch:",l),l}}static async chat(e){return this.dispatch("Chat",{type:"Chat",payload:e})}static async editor(e){return this.dispatch("Editor",{type:"Editor",payload:e})}static async file(e){return this.dispatch("File",{type:"File",payload:e})}static async workflow(e){return this.dispatch("Workflow",{type:"Workflow",payload:e})}static async terminal(e){return this.dispatch("Terminal",{type:"Terminal",payload:e})}}const je={CHANGE_APPLIED:"change-applied",ALL_EDITS_APPLIED:"all-edits-applied",TODO_UPDATED:"todo_updated"},$t=d.createContext(void 0),$s=({children:n})=>{const[e,s]=d.useState({activeFile:null,cursorLine:null,cursorColumn:null,selectionStartLine:null,selectionEndLine:null}),r=d.useCallback(u=>{s(p=>({...p,activeFile:u}))},[]),o=d.useCallback((u,p)=>{s(c=>({...c,cursorLine:u,cursorColumn:p}))},[]),l=d.useCallback((u,p)=>{s(c=>({...c,selectionStartLine:u,selectionEndLine:p}))},[]),a=d.useCallback(()=>{s(u=>({...u,selectionStartLine:null,selectionEndLine:null}))},[]);return t.jsx($t.Provider,{value:{editorState:e,setActiveFile:r,setCursorPosition:o,setSelection:l,clearSelection:a},children:n})},tt=()=>{const n=d.useContext($t);if(!n)throw new Error("useEditor must be used within EditorProvider");return n};class Bs{chunks;nextSeq;onApply;onComplete;constructor(e,s){this.chunks=new Map,this.nextSeq=0,this.onApply=e,this.onComplete=s}add(e,s,r){for(this.chunks.set(e,{seq:e,data:s,is_final:r});this.chunks.has(this.nextSeq);){const o=this.chunks.get(this.nextSeq);if(this.onApply(o.data,o.is_final),this.chunks.delete(this.nextSeq),this.nextSeq++,o.is_final&&this.onComplete){this.onComplete(),this.clear();break}}}clear(){this.chunks.clear(),this.nextSeq=0}getPendingCount(){return this.chunks.size}getNextSeq(){return this.nextSeq}}class Bt{buffers;onApply;onComplete;constructor(e,s){this.buffers=new Map,this.onApply=e,this.onComplete=s}add(e,s,r,o){this.buffers.has(e)||this.buffers.set(e,new Bs((l,a)=>this.onApply(e,l,a),()=>{this.onComplete&&this.onComplete(e),this.buffers.delete(e)})),this.buffers.get(e).add(s,r,o)}clear(e){const s=this.buffers.get(e);s&&(s.clear(),this.buffers.delete(e))}clearAll(){this.buffers.clear()}getStats(){const e=[];return this.buffers.forEach((s,r)=>{e.push({id:r,pending:s.getPendingCount(),nextSeq:s.getNextSeq()})}),e}}class Ws extends Bt{constructor(e,s){super((r,o,l)=>e(r,o.chunk,l??!1,o.type||"content"),s)}addMessageDelta(e,s,r,o){this.add(e,s,{chunk:r,is_final:o,type:"content"},o)}addReasoningDelta(e,s,r,o){this.add(e,s,{chunk:r,is_final:o,type:"reasoning"},o)}}class Us extends Bt{constructor(e){super((s,r)=>e(s,r.data))}addOutput(e,s,r){this.add(e,s,{data:r})}}function Vs(n,e,s){const r=Date.now();return`${n}-${e}-${r}`}class Hs{cache;ttl;constructor(e=6e4){this.cache=new Map,this.ttl=e}set(e,s,r){const o=`${e}:${s}`;this.cache.set(o,{key:r,timestamp:Date.now()}),this.cleanup()}get(e,s){const r=`${e}:${s}`,o=this.cache.get(r);return o?Date.now()-o.timestamp>this.ttl?(this.cache.delete(r),null):o.key:null}has(e,s){return this.get(e,s)!==null}cleanup(){const e=Date.now(),s=[];this.cache.forEach((r,o)=>{e-r.timestamp>this.ttl&&s.push(o)}),s.forEach(r=>this.cache.delete(r))}clear(){this.cache.clear()}size(){return this.cleanup(),this.cache.size}}const pt=new Hs;function We(n,e){const s=pt.get(n,e);if(s)return console.log(`[Idempotency] Using cached key for ${n}:${e}`),s;const r=Vs(n,e);return pt.set(n,e,r),console.log(`[Idempotency] Generated new key for ${n}:${e}`),r}const Ue={APPROVE_CHANGE:"approve-change",APPROVE_ALL:"approve-all",REJECT_CHANGE:"reject-change",REJECT_ALL:"reject-all",SAVE_FILE:"save-file",DELETE_FILE:"delete-file",EXECUTE_COMMAND:"execute-command"};function Wt(){const{editorState:n}=tt(),[e,s]=d.useState([]),[r,o]=d.useState(!1),[l,a]=d.useState(null),u=d.useRef(null),p=d.useRef({id:"",content:""}),c=d.useRef({id:"",content:""}),[f,w]=d.useState([]),[b,S]=d.useState("anthropic/claude-sonnet-4-5-20250929"),L=d.useCallback(async E=>{try{await g("log_frontend",{message:E})}catch(k){console.error("[useChat] log_frontend failed",k)}},[]),[x,_]=d.useState(null),[z,N]=d.useState([]);d.useEffect(()=>{async function E(){try{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window)){console.log("Not in Tauri environment, skipping chat init");return}const[k,T]=await Promise.all([g("get_conversation"),g("list_models")]);if(console.log("Loaded conversation:",k),s(k),w(T),T.length>0){const W=T.find(V=>V.id==="anthropic/claude-sonnet-4-5-20250929")||T.find(V=>V.id==="openai/gpt-5.2")||T[0];S(W.id)}}catch(k){console.error("Failed to init:",k)}}E()},[]),d.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let E,k,T,W,V,Z;u.current||(u.current=new Ws((X,pe,rn,nt)=>{if(o(!0),nt==="reasoning"){c.current.id!==X&&(c.current={id:X,content:""}),c.current.content+=pe;const de=c.current.content;s(Q=>{const le=Q.findIndex(ce=>ce.id===X);if(le!==-1){const ce=[...Q],he={...ce[le],reasoning:de},te=[...he.blocks||[]],oe=te[te.length-1];return oe&&oe.type==="reasoning"?te[te.length-1]={...oe,content:oe.content+pe}:te.push({type:"reasoning",content:pe,id:crypto.randomUUID()}),he.blocks=te,ce[le]=he,ce}return[...Q,{id:X,role:"Assistant",reasoning:de,content:"",blocks:[{type:"reasoning",content:de,id:crypto.randomUUID()}]}]})}else{p.current.id!==X&&(p.current={id:X,content:""}),p.current.content+=pe;const de=p.current.content;s(Q=>{const le=Q.findIndex(ee=>ee.id===X);if(le!==-1){const ee=[...Q],te={...ee[le],content:de},oe=[...te.blocks||[]],M=oe[oe.length-1];return M&&M.type==="text"?oe[oe.length-1]={...M,content:M.content+pe}:oe.push({type:"text",content:pe,id:crypto.randomUUID()}),te.blocks=oe,ee[le]=te,ee}const ce=Q[Q.length-1];if(ce&&ce.role==="Assistant"&&!ce.id){const ee=[...Q],he=ee[Q.length-1];return ee[Q.length-1]={...he,id:X,content:de,blocks:[...he.blocks||[],{type:"text",content:pe,id:crypto.randomUUID()}]},ee}return[...Q,{id:X,role:"Assistant",content:de,blocks:[{type:"text",content:de,id:crypto.randomUUID()}]}]})}},X=>{console.log(`[v1.1 MessageBuffer] Message ${X} completed`),o(!1)}));const sn=(async()=>{E=await O("chat-done",()=>{o(!1),_(null)}),k=await O("chat-error",M=>{a(M.payload),o(!1),_(null)}),T=await O("request-confirmation",M=>{console.log("Permission requested for:",M.payload),_(M.payload.actions)}),W=await O("propose-changes",M=>{console.log("[PROPOSE CHANGES] received",M.payload.map(P=>({id:P.id,type:P.change_type,path:P.path}))),N(P=>{const $=M.payload.filter(I=>!P.some(H=>H.id===I.id));return[...P,...$]}),M.payload.forEach(P=>{if(P.change_type==="new_file"){const $=P.path.split("/").pop()||P.path;Ie("open-ephemeral-document",{id:`new-file-${P.id}`,title:`NEW: ${$}`,content:P.content,suggestedName:P.path})}})}),V=await O("command-executed",M=>{console.log("[COMMAND EXECUTED]",M.payload),s(P=>{const $=P.findIndex((ae,ie)=>ae.role==="Assistant"&&ie===P.length-1);if($===-1)return P;const I=[...P],H=I[$];return I[$]={...H,commandExecutions:[...H.commandExecutions||[],{command:M.payload.command,cwd:M.payload.cwd,output:M.payload.output,exitCode:M.payload.exitCode,duration:M.payload.duration,timestamp:Date.now()}]},I})});const le=await O(je.CHANGE_APPLIED,M=>{const{change_id:P,file_path:$}=M.payload;console.log("[CHAT] Change applied signal received:",P,"for",$),N(I=>I.filter(H=>H.id!==P&&H.path!==$))}),ee=await O(je.ALL_EDITS_APPLIED,M=>{const{file_paths:P}=M.payload;console.log("[CHAT] All changes applied for:",P),N($=>$.filter(I=>!P.includes(I.path)))}),te=await O(je.TODO_UPDATED,M=>{console.log("[TODO UPDATED]",M.payload),s(P=>{const $=[...P];for(let I=$.length-1;I>=0;I--)if($[I].role==="Assistant"){$[I]={...$[I],todos:M.payload.todos};break}return $})});return Z=await O("blade-event",M=>{const P=M.payload;if(P.event.type==="Chat"){const $=P.event.payload;if($.type==="MessageDelta"){const{id:I,seq:H,chunk:ae,is_final:ie}=$.payload;console.log(`[v1.1 Chat] MessageDelta: id=${I}, seq=${H}, is_final=${ie}, chunk_len=${ae.length}`),u.current&&u.current.addMessageDelta(I,H,ae,ie)}else if($.type==="ReasoningDelta"){const{id:I,seq:H,chunk:ae,is_final:ie}=$.payload;console.log(`[v1.1 Chat] ReasoningDelta: id=${I}, seq=${H}, is_final=${ie}, chunk_len=${ae.length}`),u.current&&u.current.addReasoningDelta(I,H,ae,ie)}else if($.type==="MessageCompleted"){const{id:I}=$.payload;console.log(`[v1.1 Chat] MessageCompleted: id=${I}`),u.current&&u.current.clear(I),p.current.id===I&&(p.current={id:"",content:""}),c.current.id===I&&(c.current={id:"",content:""}),o(!1)}else if($.type==="ToolUpdate"){const{message_id:I,tool_call_id:H,status:ae,result:ie,tool_call:me}=$.payload;console.log(`[v1.1 Chat] ToolUpdate: msg=${I} tool=${H} status=${ae}`),s(Pe=>{if(Pe.findIndex(ne=>ne.id===I)===-1){const ne={id:I,role:"Assistant",content:"",tool_calls:me?[{...me,status:ae,result:ie}]:[],blocks:me?[{type:"tool_call",id:H}]:[]};return[...Pe,ne]}return Pe.map(ne=>{if(ne.id===I){const Oe=ne.tool_calls||[],xe=Oe.findIndex(Fe=>Fe.id===H);let be=[...Oe],_e=[...ne.blocks||[]];if(xe>=0)be[xe]={...be[xe],status:ae},ie&&(be[xe].result=ie),me&&(be[xe]={...be[xe],...me});else if(me){const Fe=ne.content_before_tools!==void 0?ne.content_before_tools:ne.content;return _e.some(st=>st.type==="tool_call"&&st.id===H)||_e.push({type:"tool_call",id:H}),{...ne,content_before_tools:Fe,tool_calls:[...Oe,me],blocks:_e}}else console.warn("[v1.1 Chat] Received ToolUpdate for unknown tool but no tool_call data provided:",H);return{...ne,tool_calls:be,blocks:_e}}return ne})})}}}),()=>{E&&E(),k&&k(),T&&T(),W&&W(),V&&V(),le&&le(),ee&&ee(),te&&te(),Z&&Z()}})();return()=>{sn.then(X=>X())}},[]);const[h,v]=d.useState([]),i=d.useCallback(async E=>{try{o(!0),a(null);const k=n.activeFile,T=k||null,W=k?[k]:[];await G.chat({type:"SendMessage",payload:{content:E,model:b,context:{active_file:T,open_files:W,cursor_line:n.cursorLine??null,cursor_column:n.cursorColumn??null,selection_start:n.selectionStartLine??null,selection_end:n.selectionEndLine??null}}})}catch(k){console.error("Failed to send message:",k),a(k instanceof Error?k.message:String(k)),o(!1)}},[n.activeFile,n.cursorLine,n.cursorColumn,n.selectionStartLine,n.selectionEndLine,b]);d.useEffect(()=>{if(!r&&h.length>0){const E=h[0];v(k=>k.slice(1)),i(E)}},[r,h,i]);const C=d.useCallback(E=>{const k={id:crypto.randomUUID(),role:"User",content:E};s(T=>[...T,k]),v(T=>[...T,E])},[]),j=d.useCallback(async()=>{try{await G.chat({type:"StopGeneration"}),o(!1),_(null)}catch(E){console.error("Failed to stop generation:",E)}},[]),D=d.useCallback(async E=>{console.log("[useChat] approveChange called with:",E),L(`[approveChange] changeId=${E}`);try{const k=z.find(W=>W.id===E);console.log("[useChat] Found change:",k),L(`[approveChange] found change path=${k?.path??"n/a"} type=${k?.change_type??"n/a"}`);const T=We(Ue.APPROVE_CHANGE,E);await G.dispatch("Workflow",{type:"Workflow",payload:{type:"ApproveAction",payload:{action_id:E}}},T),console.log("[useChat] Backend approve_action completed"),L(`[approveChange] backend completed changeId=${E}`),N(W=>{if(k){const V=W.filter(Z=>Z.id!==E&&Z.path!==k.path);return V.length<W.length-1&&console.log(`[CHANGE] Removed ${W.length-V.length-1} stale changes for ${k.path}`),V}return W.filter(V=>V.id!==E)})}catch(k){console.error("Failed to approve change:",k)}},[z,L]),A=d.useCallback(async E=>{try{const k=We(Ue.REJECT_CHANGE,E);await G.dispatch("Workflow",{type:"Workflow",payload:{type:"RejectAction",payload:{action_id:E}}},k),N(T=>T.filter(W=>W.id!==E))}catch(k){console.error("Failed to reject change:",k)}},[]),R=d.useCallback(async()=>{try{console.log("[useChat] approveAllChanges called; pendingChanges:",z.map(T=>({id:T.id,path:T.path,type:T.change_type}))),L(`[approveAllChanges] count=${z.length} ids=${z.map(T=>T.id).join(",")}`);const E=`batch-${Date.now()}`,k=We(Ue.APPROVE_ALL,E);await G.dispatch("Workflow",{type:"Workflow",payload:{type:"ApproveAll",payload:{batch_id:E}}},k),console.log("[useChat] Backend approve_all completed"),L("[approveAllChanges] backend completed"),N([])}catch(E){console.error("Failed to approve all changes:",E)}},[z,L]),F=d.useCallback(E=>{N(k=>k.filter(T=>!E.includes(T.id)))},[]),U=d.useCallback(async E=>{try{await G.workflow({type:"ApproveTool",payload:{approved:E}}),_(null)}catch(k){console.error("Failed to approve tool:",k)}},[]),B=d.useCallback(async E=>{try{await G.workflow({type:"ApproveToolDecision",payload:{decision:E}}),_(null)}catch(k){console.error("Failed to approve tool decision:",k)}},[]);return{messages:e,loading:r,error:l,sendMessage:C,stopGeneration:j,models:f,selectedModelId:b,setSelectedModelId:S,pendingActions:x,approveTool:U,approveToolDecision:B,pendingChanges:z,approveChange:D,approveAllChanges:R,rejectChange:A,removeChangesFromList:F}}function Gs(){const[n,e]=d.useState(new Map);return d.useEffect(()=>{let r;return(async()=>r=await O("command-execution-started",l=>{console.log("[CMD EXEC] Started:",l.payload),e(a=>{const u=new Map(a);return u.set(l.payload.call_id,{commandId:l.payload.command_id,callId:l.payload.call_id,command:l.payload.command,cwd:l.payload.cwd,isRunning:!0}),u})}))(),()=>{r&&r()}},[]),{executions:n,handleCommandComplete:async(r,o,l)=>{console.log("[CMD EXEC] Complete:",{callId:r,exitCode:l,outputLength:o.length}),e(a=>{const u=new Map(a),p=u.get(r);return p&&u.set(r,{...p,output:o,exitCode:l,isRunning:!1}),u});try{await g("submit_command_result",{callId:r,output:o,exitCode:l}),console.log("[CMD EXEC] Result submitted to backend")}catch(a){console.error("[CMD EXEC] Failed to submit result:",a)}}}}const ht=({toolCall:n,status:e="pending"})=>{const s=()=>{switch(e){case"executing":return t.jsx(Et,{className:"w-3.5 h-3.5 text-blue-400 animate-spin"});case"complete":return t.jsx(_t,{className:"w-3.5 h-3.5 text-emerald-400"});case"error":return t.jsx(Ge,{className:"w-3.5 h-3.5 text-red-400"});case"skipped":return t.jsx(Ge,{className:"w-3.5 h-3.5 text-yellow-400"});default:return t.jsx(on,{className:"w-3.5 h-3.5 text-purple-400"})}},r=()=>{switch(e){case"executing":return"border-blue-500/20 bg-[#0d1117]";case"complete":return"border-emerald-500/20 bg-[#0d1117]";case"error":return"border-red-500/30 bg-[#0d1117]";case"skipped":return"border-yellow-500/30 bg-[#0d1117]";default:return"border-zinc-700/50 bg-[#0d1117]"}},o=()=>{switch(e){case"executing":return"Executing";case"complete":return"Complete";case"error":return"Failed";case"skipped":return"Skipped";default:return"Pending"}},l=(p,c)=>{if(p==="apply_patch"&&c){const w=c.patches;if(w&&w.length>1)return`ðŸ“ Applying ${w.length} Code Changes`}return{apply_patch:"ðŸ“ Applying Code Changes",edit_file:"âœï¸ Editing File",read_file:"ðŸ“– Reading File",write_file:"ðŸ’¾ Writing File",list_files:"ðŸ“‚ Listing Files",grep_search:"ðŸ” Searching Code",run_command:"âš™ï¸ Running Command",create_file:"ðŸ“„ Creating File",delete_file:"ðŸ—‘ï¸ Deleting File",list_directory:"ðŸ“ Listing Directory",get_workspace_structure:"ðŸ—‚ï¸ Analyzing Workspace"}[p]||p};let a={};try{a=JSON.parse(n.function.arguments)}catch{a={raw:n.function.arguments}}const u=["apply_patch"].includes(n.function.name);return t.jsxs("div",{className:`border rounded-md overflow-hidden transition-all duration-200 ${r()}`,children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-zinc-900/40",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[s(),t.jsx("span",{className:"text-xs font-medium text-zinc-200",children:l(n.function.name,a)}),t.jsx("span",{className:"text-[9px] font-mono text-zinc-600 bg-zinc-900/80 px-1.5 py-0.5 rounded border border-zinc-800/50",children:n.id?.slice(0,8)||"unknown"})]}),t.jsx("span",{className:`text-[9px] font-mono uppercase tracking-wider font-semibold ${e==="complete"?"text-emerald-400":e==="executing"?"text-blue-400":e==="error"?"text-red-400":e==="skipped"?"text-yellow-400":"text-zinc-500"}`,children:o()})]}),!u&&Object.keys(a).length>0&&t.jsx("div",{className:"px-3 py-2.5 space-y-1.5 bg-zinc-950/30",children:Object.entries(a).map(([p,c])=>{let f=typeof c=="string"?c:JSON.stringify(c);return f.length>200&&(f=f.substring(0,200)+"..."),t.jsxs("div",{className:"flex gap-3 text-xs items-start",children:[t.jsxs("span",{className:"font-mono text-zinc-500 min-w-[80px] shrink-0",children:[p,":"]}),t.jsx("span",{className:"font-mono text-zinc-300 flex-1 break-all select-text",children:f})]},p)})})]})},ft=({command:n,cwd:e,output:s,exitCode:r,duration:o})=>{const[l,a]=d.useState(!0),u=r===0;return t.jsxs("div",{className:"my-3 bg-[#1e1e1e] border border-[#3e3e42] rounded-lg overflow-hidden",children:[t.jsxs("button",{onClick:()=>a(!l),className:"w-full flex items-center gap-3 px-4 py-3 bg-[#252526] hover:bg-[#2d2d2d] transition-colors text-left",children:[t.jsx("div",{className:`p-1.5 rounded ${u?"bg-emerald-500/10":"bg-red-500/10"}`,children:u?t.jsx(_t,{className:"w-4 h-4 text-emerald-500"}):t.jsx(Ge,{className:"w-4 h-4 text-red-500"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx(ge,{className:"w-3.5 h-3.5 text-zinc-400"}),t.jsx("code",{className:"text-sm font-mono text-white truncate",children:n})]}),e&&t.jsx("div",{className:"text-xs font-mono text-zinc-500 truncate",children:e})]}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-zinc-400",children:[o!==void 0&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(an,{className:"w-3 h-3"}),t.jsxs("span",{children:[o,"ms"]})]}),t.jsxs("div",{className:`px-2 py-0.5 rounded text-xs font-medium ${u?"bg-emerald-500/10 text-emerald-400":"bg-red-500/10 text-red-400"}`,children:["Exit ",r]}),l?t.jsx(ke,{className:"w-4 h-4"}):t.jsx(Re,{className:"w-4 h-4"})]})]}),l&&s&&t.jsx("div",{className:"border-t border-[#3e3e42]",children:t.jsx("pre",{className:"p-4 text-xs font-mono text-zinc-300 overflow-x-auto max-h-[400px] overflow-y-auto bg-[#1e1e1e] select-text",children:s})}),l&&!s&&t.jsx("div",{className:"border-t border-[#3e3e42] px-4 py-3 text-xs text-zinc-500 italic",children:"No output"})]})},mt=({actions:n,onRun:e,onSkip:s})=>t.jsxs("div",{className:"border border-blue-500/30 rounded-lg overflow-hidden bg-blue-950/10 my-2",children:[t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-900/20 border-b border-blue-500/20",children:[t.jsx(ge,{className:"w-4 h-4 text-blue-400"}),t.jsx("span",{className:"text-xs font-medium text-blue-300",children:"Command Approval Required"})]}),t.jsx("div",{className:"px-3 py-2 space-y-2",children:n.map((r,o)=>t.jsxs("div",{className:"bg-[#0d1117] border border-zinc-800 rounded overflow-hidden",children:[r.cwd&&t.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-900/50 border-b border-zinc-800",children:[t.jsx(Ke,{className:"w-3 h-3 text-zinc-500"}),t.jsx("span",{className:"text-[10px] font-mono text-zinc-500",children:r.cwd})]}),t.jsx("div",{className:"px-3 py-2",children:t.jsx("code",{className:"text-xs font-mono text-zinc-200 break-all",children:r.description})})]},o))}),t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-zinc-900/30 border-t border-blue-500/20",children:[t.jsxs("button",{onClick:s,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 rounded text-xs font-medium text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800/50 transition-colors",children:[t.jsx(ue,{className:"w-3.5 h-3.5"}),"Skip"]}),t.jsxs("button",{onClick:e,className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-1.5 rounded text-xs font-medium bg-blue-600 hover:bg-blue-500 text-white transition-colors",children:[t.jsx(ln,{className:"w-3.5 h-3.5"}),"Run"]})]})]}),Ks=({item:n})=>{const e=n.status==="completed"?"âœ“":n.status==="in_progress"?"âŸ³":"",s=n.status==="in_progress"?n.activeForm:n.content;return t.jsxs("div",{className:`todo-item todo-${n.status}`,children:[t.jsx("span",{className:"todo-icon",children:e}),t.jsx("span",{className:"todo-text",children:s})]})},qs=({todos:n})=>!n||n.length===0?null:t.jsx("div",{className:"todo-list",children:n.map((e,s)=>t.jsx(Ks,{item:e},s))}),Ut=d.createContext(null),Me=()=>{const n=d.useContext(Ut);if(!n)throw new Error("useContextMenu must be used within a ContextMenuProvider");return n},Js=({children:n})=>{const[e,s]=d.useState({isOpen:!1,position:{x:0,y:0},items:[],context:void 0}),r=d.useCallback((l,a,u)=>{s({isOpen:!0,position:l,items:a,context:u})},[]),o=d.useCallback(()=>{s(l=>({...l,isOpen:!1}))},[]);return t.jsxs(Ut.Provider,{value:{showMenu:r,hideMenu:o,state:e},children:[n,e.isOpen&&t.jsx(Xs,{})]})},Xs=()=>{const{state:n,hideMenu:e}=Me(),s=d.useRef(null),[r,o]=d.useState(n.position),[l,a]=d.useState(-1);d.useEffect(()=>{if(s.current){const c=s.current.getBoundingClientRect();let{x:f,y:w}=n.position;f+c.width>window.innerWidth-8&&(f=window.innerWidth-c.width-8),w+c.height>window.innerHeight-8&&(w=window.innerHeight-c.height-8),o({x:Math.max(8,f),y:Math.max(8,w)})}},[n.position,n.items]),d.useEffect(()=>{const c=f=>{s.current&&!s.current.contains(f.target)&&e()};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[e]),d.useEffect(()=>{const c=f=>{const w=n.items.filter(b=>!b.divider&&!b.disabled);switch(f.key){case"Escape":e();break;case"ArrowDown":f.preventDefault(),a(b=>{const S=b+1;return S>=w.length?0:S});break;case"ArrowUp":f.preventDefault(),a(b=>{const S=b-1;return S<0?w.length-1:S});break;case"Enter":if(f.preventDefault(),l>=0&&l<w.length){const b=w[l];b.onClick&&(b.onClick(),e())}break}};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[n.items,l,e]);const u=c=>{c.disabled||c.divider||(c.onClick&&c.onClick(),e())};let p=-1;return t.jsx("div",{ref:s,className:"fixed z-[9999] min-w-[180px] max-w-[280px] py-1.5 bg-[var(--bg-surface)] border border-[var(--border-focus)] rounded-lg shadow-xl animate-in fade-in zoom-in-95 duration-100",style:{left:r.x,top:r.y,boxShadow:"0 8px 30px rgba(0, 0, 0, 0.4), 0 0 1px rgba(255, 255, 255, 0.1)"},children:n.items.map((c,f)=>{if(c.divider)return t.jsx("div",{className:"my-1.5 mx-2 h-px bg-[var(--border-subtle)]"},`divider-${f}`);c.disabled||p++;const w=p===l;return t.jsxs("button",{onClick:()=>u(c),disabled:c.disabled,className:`
                            w-full flex items-center gap-3 px-3 py-1.5 text-left text-[13px] transition-colors
                            ${c.disabled?"text-[var(--fg-tertiary)] cursor-not-allowed":c.danger?"text-[var(--accent-error)] hover:bg-[var(--accent-error)]/10":"text-[var(--fg-primary)] hover:bg-[var(--bg-surface-hover)]"}
                            ${w&&!c.disabled?"bg-[var(--bg-surface-hover)]":""}
                        `,children:[c.icon&&t.jsx("span",{className:"w-4 h-4 flex items-center justify-center opacity-70",children:c.icon}),t.jsx("span",{className:"flex-1",children:c.label}),c.shortcut&&t.jsx("span",{className:"text-[11px] text-[var(--fg-tertiary)] font-mono",children:c.shortcut})]},c.id)})})},gt=({content:n,isActive:e,hasContent:s})=>{const[r,o]=d.useState(!1),l=d.useRef(e);return d.useEffect(()=>{e&&!l.current&&!s&&o(!0),s&&r&&e&&o(!1),l.current=e},[e,s,r]),n?t.jsxs("div",{className:"my-3 rounded-md border border-zinc-800 bg-zinc-900/40 overflow-hidden group/reasoning",children:[t.jsxs("button",{onClick:()=>o(!r),className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-zinc-800/50 transition-colors text-left",children:[t.jsxs("div",{className:"flex items-center gap-2 text-zinc-500 group-hover/reasoning:text-zinc-400 transition-colors",children:[t.jsx(hn,{className:`w-3.5 h-3.5 ${e&&!s?"text-purple-400 animate-pulse":""}`}),t.jsx("span",{className:"font-mono text-[10px] uppercase tracking-wider font-semibold",children:e&&!s?"Reasoning...":"Reasoning Process"})]}),t.jsx("div",{className:"flex-1"}),e&&!s&&t.jsx(Et,{className:"w-3 h-3 text-purple-500/50 animate-spin mr-2"}),r?t.jsx(ke,{className:"w-3.5 h-3.5 text-zinc-600"}):t.jsx(Re,{className:"w-3.5 h-3.5 text-zinc-600"})]}),r&&t.jsx("div",{className:"px-3 py-3 border-t border-zinc-800/50 bg-zinc-950/30",children:t.jsx("div",{className:"prose prose-invert prose-xs max-w-none text-zinc-400 font-mono text-[11px] leading-relaxed select-text",children:t.jsx(ve,{children:n})})})]}):null},Ys=({message:n,pendingActions:e,onApproveCommand:s,onSkipCommand:r,isContinued:o=!1,isActive:l=!1})=>{const a=n.role==="User",u=n.role==="System",p=n.role==="Tool",c=n.role==="Assistant",{showMenu:f}=Me();if(p)return null;const w=!!n.reasoning;(n.tool_calls||[]).filter(N=>N.function.name!=="todo_write").length>0;const S=n.content_before_tools!==void 0||n.content_after_tools!==void 0;let L="",x="";S?(L=n.content_before_tools||"",x=n.content_after_tools||"",!x&&n.content.length>L.length&&n.content.startsWith(L)&&(x=n.content.slice(L.length))):(L=n.content,x="");const _=L.length>0||x.length>0,z=d.useCallback(N=>{N.preventDefault(),N.stopPropagation();const h=[{id:"copy-message",label:"Copy Message",icon:t.jsx(ze,{className:"w-4 h-4"}),shortcut:"Ctrl+C",onClick:async()=>{try{await navigator.clipboard.writeText(n.content),console.log("[Context] Copied message")}catch(v){console.error("[Context] Failed to copy:",v)}}},{id:"copy-markdown",label:"Copy as Markdown",icon:t.jsx(un,{className:"w-4 h-4"}),onClick:async()=>{try{const v=`**${n.role}:**

${n.content}`;await navigator.clipboard.writeText(v),console.log("[Context] Copied as markdown")}catch(v){console.error("[Context] Failed to copy:",v)}}}];a&&h.push({id:"div-1",label:"",divider:!0},{id:"edit-message",label:"Edit Message",icon:t.jsx(St,{className:"w-4 h-4"}),onClick:()=>{console.log("[Context] Edit message")}}),c&&h.push({id:"div-1",label:"",divider:!0},{id:"regenerate",label:"Regenerate Response",icon:t.jsx(pn,{className:"w-4 h-4"}),onClick:()=>{console.log("[Context] Regenerate response")}}),f({x:N.clientX,y:N.clientY},h)},[n,a,c,f]);return t.jsxs("div",{className:`flex gap-3 px-4 group ${o?"pt-1 pb-2":"pt-4 pb-4"} ${a?"bg-zinc-800/10":""} ${p?"opacity-70":""}`,onContextMenu:z,children:[t.jsxs("div",{className:"w-5 shrink-0 flex flex-col items-center",children:[!o&&t.jsxs("div",{className:"mt-0.5 opacity-80 group-hover:opacity-100 transition-opacity",children:[a&&t.jsx("div",{className:"w-5 h-5 rounded-full bg-zinc-700/50 flex items-center justify-center",children:t.jsx(cn,{className:"w-3 h-3 text-zinc-300"})}),c&&t.jsx("div",{className:"w-5 h-5 rounded-full bg-emerald-500/10 flex items-center justify-center",children:t.jsx(dn,{className:"w-3.5 h-3.5 text-emerald-500"})}),u&&t.jsx(ge,{className:"w-4 h-4 text-yellow-600"}),p&&t.jsx(ge,{className:"w-4 h-4 text-purple-500/80"})]}),o&&t.jsx("div",{className:"w-px h-full bg-zinc-800/50"})]}),t.jsxs("div",{className:"flex-1 min-w-0 space-y-1 overflow-hidden",children:[!o&&t.jsxs("div",{className:"flex items-center gap-2 h-5 mb-1",children:[t.jsx("span",{className:"font-semibold text-[11px] text-zinc-400",children:a?"User":c?"Assistant":n.role}),p&&n.tool_call_id&&t.jsx("span",{className:"text-[10px] font-mono text-zinc-600 bg-zinc-900 border border-zinc-800 px-1.5 rounded-sm",children:n.tool_call_id.slice(0,8)})]}),n.blocks&&n.blocks.length>0?t.jsxs(t.Fragment,{children:[n.blocks.map((N,h)=>{if(N.type==="reasoning")return t.jsx(gt,{content:N.content,isActive:l&&h===n.blocks.length-1,hasContent:!1},N.id||`reasoning-${h}`);if(N.type==="text")return t.jsx("div",{className:`prose prose-invert prose-xs max-w-none text-zinc-300 leading-relaxed mb-3 select-text blocks-text
                                        prose-headings:text-zinc-200 prose-headings:font-semibold
                                        prose-p:text-zinc-300 prose-p:leading-relaxed prose-p:my-2
                                        prose-strong:text-zinc-100 prose-strong:font-semibold
                                        prose-a:text-emerald-400 prose-a:no-underline hover:prose-a:underline
                                        prose-code:text-emerald-400 prose-code:bg-zinc-900 prose-code:px-1 prose-code:py-0.5 prose-code:rounded
                                        prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800
                                        prose-ul:text-zinc-300 prose-ul:my-2 prose-ol:text-zinc-300 prose-ol:my-2
                                        prose-li:text-zinc-300 prose-li:leading-relaxed prose-li:my-1
                                        prose-blockquote:border-l-emerald-500 prose-blockquote:text-zinc-400`,children:t.jsx(ve,{children:N.content})},N.id||`text-${h}`);if(N.type==="tool_call"){const v=n.tool_calls?.find(i=>i.id===N.id);return v?t.jsx("div",{className:"mb-3 space-y-2",children:t.jsx(ht,{toolCall:v,status:v.status||"executing",result:v.result})},N.id):null}return null}),e&&e.length>0&&s&&r&&t.jsx("div",{className:"mb-3",children:t.jsx(mt,{actions:e,onRun:s,onSkip:r})}),n.commandExecutions&&n.commandExecutions.length>0&&t.jsx("div",{className:"mt-3 space-y-2",children:n.commandExecutions.map((N,h)=>t.jsx(ft,{command:N.command,cwd:N.cwd,output:N.output,exitCode:N.exitCode,duration:N.duration},`${N.timestamp}-${h}`))})]}):(()=>{const N=(n.tool_calls||[]).filter(j=>j.function.name!=="todo_write"),h=N.length>0,v=n.content_before_tools!==void 0||n.content_after_tools!==void 0;let i="",C="";return v?(i=n.content_before_tools||"",C=n.content_after_tools||"",!C&&n.content.length>i.length&&n.content.startsWith(i)&&(C=n.content.slice(i.length))):i=n.content,t.jsxs(t.Fragment,{children:[w&&t.jsx(gt,{content:n.reasoning,isActive:l,hasContent:_}),i&&t.jsx("div",{className:"prose prose-invert prose-xs max-w-none text-zinc-300 leading-relaxed mb-3 select-text",children:t.jsx(ve,{children:i})}),e&&e.length>0&&s&&r&&t.jsx("div",{className:"mb-3",children:t.jsx(mt,{actions:e,onRun:s,onSkip:r})}),h&&t.jsx("div",{className:"mb-3 space-y-2",children:N.map((j,D)=>t.jsx(ht,{toolCall:j,status:j.status||"executing",result:j.result},`${j.id}-${D}`))}),n.todos&&n.todos.length>0&&t.jsx(qs,{todos:n.todos}),C&&t.jsx("div",{className:"prose prose-invert prose-xs max-w-none text-zinc-300 leading-relaxed select-text",children:t.jsx(ve,{children:C})}),n.commandExecutions&&n.commandExecutions.length>0&&t.jsx("div",{className:"mt-3 space-y-2",children:n.commandExecutions.map((j,D)=>t.jsx(ft,{command:j.command,cwd:j.cwd,output:j.output,exitCode:j.exitCode,duration:j.duration},`${j.timestamp}-${D}`))})]})})()]})]})},Zs=({onSend:n,onStop:e,disabled:s,loading:r})=>{const{t:o}=Ze(),[l,a]=d.useState(""),u=d.useRef(null);d.useEffect(()=>{u.current&&(u.current.style.height="auto",u.current.style.height=u.current.scrollHeight+"px")},[l]);const p=c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),l.trim()&&!s&&!r&&(n(l),a("")))};return t.jsx("div",{className:"p-3 border-t border-[var(--border-subtle)] bg-[var(--bg-app)] pb-5",children:t.jsxs("div",{className:`relative bg-[var(--bg-surface)] rounded-md overflow-hidden border transition-colors ${r?"border-[var(--border-focus)]":"border-[var(--border-subtle)] focus-within:border-[var(--fg-secondary)]"}`,children:[t.jsx("textarea",{ref:u,value:l,onChange:c=>a(c.target.value),onKeyDown:p,placeholder:o("chat.inputPlaceholder"),className:"w-full bg-transparent text-[var(--fg-primary)] p-3 pr-10 outline-none resize-none min-h-[42px] max-h-[200px] text-xs font-mono placeholder-[var(--fg-tertiary)]",rows:1,disabled:s}),t.jsx("button",{onClick:()=>{r&&!l.trim()&&e?e():l.trim()&&!s&&(n(l),a(""))},disabled:!l.trim()&&!r||s,className:`absolute right-2 bottom-2 p-1.5 transition-colors rounded hover:bg-[var(--bg-surface-hover)] ${r&&!l.trim()?"text-red-400":"text-[var(--fg-tertiary)] hover:text-[var(--fg-primary)] disabled:opacity-30 disabled:cursor-not-allowed"}`,children:r&&!l.trim()?t.jsx(Dt,{className:"w-3.5 h-3.5 fill-current animate-pulse"}):t.jsx(fn,{className:"w-3.5 h-3.5"})})]})})},Qs=({models:n,selectedId:e,onSelect:s,disabled:r})=>{const[o,l]=d.useState(!1),a=d.useRef(null),u=n.find(c=>c.id===e)||null;d.useEffect(()=>{const c=f=>{a.current&&!a.current.contains(f.target)&&l(!1)};return o&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[o]);const p=c=>{const f=c.toLowerCase();return f.includes("gpt")?t.jsx(mn,{className:"w-3.5 h-3.5 text-green-400"}):f.includes("claude")?t.jsx(gn,{className:"w-3.5 h-3.5 text-orange-400"}):f.includes("gemini")?t.jsx(xn,{className:"w-3.5 h-3.5 text-blue-400"}):t.jsx(rt,{className:"w-3.5 h-3.5 text-zinc-400"})};return t.jsxs("div",{className:"relative w-full",ref:a,children:[t.jsxs("button",{type:"button",onClick:()=>!r&&l(!o),disabled:r,className:`
                    w-full flex items-center justify-between px-3 py-1.5 
                    bg-[var(--bg-surface)] hover:bg-[var(--bg-surface-hover)]
                    border border-[var(--border-subtle)] hover:border-[var(--border-hover)]
                    rounded transition-all duration-200 group
                    ${o?"ring-1 ring-[var(--accent-primary)]/50 border-[var(--accent-primary)]/50":""}
                    ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:[t.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[t.jsx("div",{className:"shrink-0 p-0.5 rounded bg-[var(--bg-app)]/50 border border-[var(--border-subtle)]",children:u?p(u.id):t.jsx(rt,{className:"w-3 h-3"})}),t.jsx("div",{className:"flex flex-col items-start min-w-0",children:t.jsx("span",{className:"text-[11px] font-medium text-[var(--fg-secondary)] truncate w-full text-left",children:u?.name||"Select Model"})})]}),t.jsx(ke,{className:`w-3 h-3 text-[var(--fg-tertiary)] transition-transform duration-200 ${o?"rotate-180":""}`})]}),o&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1.5 py-1.5 bg-[var(--bg-surface)] border border-[var(--border-focus)] rounded-lg shadow-xl z-50 max-h-[300px] overflow-y-auto flex flex-col gap-0.5 animate-in fade-in zoom-in-95 duration-100 origin-top",style:{boxShadow:"0 8px 30px rgba(0, 0, 0, 0.4), 0 0 1px rgba(255, 255, 255, 0.1)"},children:[n.length===0&&t.jsx("div",{className:"px-3 py-2 text-xs text-[var(--fg-tertiary)] text-center italic",children:"No models available"}),n.map(c=>{const f=c.id===e;return t.jsxs("button",{onClick:()=>{s(c.id),l(!1)},className:`
                                    flex items-center gap-3 px-3 py-2 mx-1 rounded-sm text-left
                                    transition-colors duration-150
                                    ${f?"bg-[var(--accent-primary)]/10 text-[var(--fg-primary)]":"text-[var(--fg-secondary)] hover:bg-[var(--bg-surface-hover)] hover:text-[var(--fg-primary)]"}
                                `,children:[t.jsx("div",{className:"shrink-0 mt-0.5",children:p(c.id)}),t.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[t.jsx("span",{className:"text-xs font-medium truncate",children:c.name}),c.description&&t.jsx("span",{className:"text-[10px] text-[var(--fg-tertiary)] truncate opacity-80",children:c.description})]}),f&&t.jsx(Te,{className:"w-3.5 h-3.5 text-[var(--accent-primary)] shrink-0"})]},c.id)})]})]})},er=({commandId:n,command:e,cwd:s,onComplete:r})=>{const o=d.useRef(null),l=d.useRef(null),a=d.useRef(""),u=d.useRef(!0),[p,c]=d.useState("Running..."),f=d.useRef(r);return d.useEffect(()=>{f.current=r},[r]),d.useEffect(()=>{if(!o.current||l.current)return;const w=new Rt({cursorBlink:!1,fontFamily:"monospace",fontSize:12,theme:{background:"#0a0a0a",foreground:"#e5e5e5"},rows:8,cols:80,scrollback:1e3,disableStdin:!0});return w.open(o.current),l.current=w,w.write(`\x1B[1;36m$ ${e}\x1B[0m\r
`),(async()=>{try{const S=`chat-cmd-${n}`,L=await O("terminal-output",_=>{_.payload.id===S&&(w.write(_.payload.data),a.current+=_.payload.data)}),x=await O("terminal-exit",_=>{if(_.payload.id===S){u.current=!1;const z=_.payload.exit_code;z===0?(w.write(`\r
\x1B[1;32mâœ“ Command completed successfully\x1B[0m\r
`),c("Completed")):(w.write(`\r
\x1B[1;31mâœ— Command failed with exit code ${z}\x1B[0m\r
`),c(`Failed (exit ${z})`)),f.current&&f.current(a.current,z),L(),x()}});await G.terminal({type:"Spawn",payload:{id:S,command:e,cwd:s||void 0,interactive:!1}})}catch(S){console.error("Failed to execute command:",S),w.write(`\r
\x1B[31mFailed to execute command: ${S}\x1B[0m\r
`),u.current=!1,c("Error"),f.current&&f.current(a.current,1)}})(),()=>{w.dispose(),l.current=null}},[n,e,s]),t.jsxs("div",{className:"my-2 border border-zinc-800 rounded-lg overflow-hidden bg-[#0a0a0a]",children:[t.jsx("div",{className:"flex items-center justify-between px-3 py-2 bg-zinc-900/50 border-b border-zinc-800",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ge,{className:"w-3.5 h-3.5 text-emerald-500"}),t.jsx("span",{className:"text-xs font-mono text-zinc-400",children:p})]})}),t.jsx("div",{ref:o,className:"w-full",style:{height:"200px",overflow:"hidden"}})]})},tr=()=>{const{t:n}=Ze(),{messages:e,loading:s,error:r,sendMessage:o,stopGeneration:l,models:a,selectedModelId:u,setSelectedModelId:p,pendingActions:c,approveToolDecision:f,pendingChanges:w,approveAllChanges:b,rejectChange:S}=Wt(),{executions:L,handleCommandComplete:x}=Gs(),_=d.useRef(null),z=d.useRef(!0);d.useEffect(()=>{(e[e.length-1]?.role==="User"||z.current)&&_.current?.scrollIntoView({behavior:"smooth"})},[e,s,w]);const N=d.useCallback(h=>{h.preventDefault()},[]);return t.jsxs("div",{className:"flex flex-col h-full bg-[var(--bg-app)] text-[var(--fg-primary)] font-sans tracking-tight",onContextMenu:N,children:[t.jsx("header",{className:"h-10 border-b border-[var(--border-subtle)] flex items-center px-2 bg-[var(--bg-app)] select-none shrink-0 z-30",children:t.jsx("div",{className:"w-full",children:t.jsx(Qs,{models:a,selectedId:u||"",onSelect:p})})}),t.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-800 scrollbar-track-transparent",onScroll:h=>{const v=h.target,i=Math.abs(v.scrollHeight-v.scrollTop-v.clientHeight)<50;z.current=i},children:t.jsxs("div",{className:"max-w-4xl mx-auto py-6",children:[e.length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-[var(--fg-tertiary)] text-center space-y-4 select-none",children:[t.jsx("div",{className:"text-4xl opacity-20 filter grayscale",children:"ðŸ—¡ï¸"}),t.jsx("h2",{className:"text-sm font-medium text-[var(--fg-secondary)] tracking-wide uppercase",children:"System Ready"}),t.jsx("p",{className:"max-w-xs text-xs font-mono opacity-50",children:"Awaiting input. Surgical precision engaged."})]}),e.map((h,v)=>{const i=v===e.length-1,j=i&&h.role==="Assistant"&&c&&c.length>0,D=v>0?e[v-1]:null,A=h.role==="Assistant",R=D?.role==="Assistant",F=A&&R,U=i&&s,B=h.tool_calls?.map(E=>L.get(E.id)).filter(Boolean)||[];return t.jsxs(we.Fragment,{children:[t.jsx(Ys,{message:h,pendingActions:j?c:void 0,onApproveCommand:j?()=>f("approve_once"):void 0,onSkipCommand:j?()=>f("reject"):void 0,isContinued:F,isActive:U}),B.map(E=>E&&t.jsxs("div",{className:"px-4 py-2 pl-[44px]",children:[" ",t.jsx(er,{commandId:E.commandId,command:E.command,cwd:E.cwd,onComplete:(k,T)=>{x(E.callId,k,T)}})]},E.callId))]},v)}),w.length>0&&t.jsxs("div",{className:"px-4 py-3 bg-purple-900/20 border border-purple-500/30 rounded-md mx-4",children:[t.jsxs("div",{className:"text-xs text-purple-300 font-semibold mb-1",children:["ðŸ“ ",w.length," change",w.length>1?"s":""," pending review"]}),t.jsx("div",{className:"text-xs text-[var(--fg-secondary)]",children:w.map(h=>h.path?.split("/").pop()||"unknown").join(", ")}),t.jsx("div",{className:"text-xs text-[var(--fg-tertiary)] mt-2",children:"Open the file in the editor to review changes, or use the buttons below."})]}),r&&t.jsxs("div",{className:"p-3 mx-4 mb-4 bg-red-500/5 border border-red-500/20 text-red-400 rounded-sm text-xs font-mono",children:["ERR: ",r]}),t.jsx("div",{ref:_,className:"h-4"})]})}),w.length>0&&t.jsx("div",{className:"shrink-0 px-3 py-2 bg-[var(--bg-panel)] border-t border-[var(--border-subtle)]",children:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-400 animate-pulse"}),t.jsxs("span",{className:"text-[10px] text-[var(--fg-secondary)] font-mono uppercase tracking-wide",children:[w.length," ",w.length===1?"change":"changes"," pending review"]})]}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsxs("button",{onClick:()=>{w.forEach(h=>S(h.id))},className:"flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-medium bg-red-600/80 hover:bg-red-500 text-white transition-colors",children:[t.jsx(ue,{className:"w-3 h-3"}),n("diff.rejectAll")]}),t.jsxs("button",{onClick:b,className:"flex items-center gap-1 px-2.5 py-1 rounded text-[11px] font-medium bg-emerald-600/80 hover:bg-emerald-500 text-white transition-colors",children:[t.jsx(Te,{className:"w-3 h-3"}),n("diff.acceptAll")]})]})]})}),t.jsx("div",{className:"shrink-0 z-20",children:t.jsx(Zs,{onSend:o,onStop:l,loading:s})})]})},nr=({isOpen:n,title:e,placeholder:s="",defaultValue:r="",confirmLabel:o="Confirm",confirmVariant:l="primary",onConfirm:a,onCancel:u})=>{const[p,c]=d.useState(r),f=d.useRef(null);if(d.useEffect(()=>{n&&(c(r),setTimeout(()=>f.current?.focus(),50))},[n,r]),d.useEffect(()=>{if(!n)return;const b=S=>{S.key==="Escape"?u():S.key==="Enter"&&p.trim()&&a(p.trim())};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[n,p,a,u]),!n)return null;const w=l==="danger"?"bg-red-600 hover:bg-red-500 text-white":"bg-emerald-600 hover:bg-emerald-500 text-white";return t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:u}),t.jsxs("div",{className:"relative bg-[var(--bg-surface)] border border-[var(--border-focus)] rounded-lg shadow-2xl w-full max-w-md mx-4 animate-in fade-in zoom-in-95 duration-150",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[var(--border-subtle)]",children:[t.jsx("h2",{className:"text-sm font-semibold text-[var(--fg-primary)]",children:e}),t.jsx("button",{onClick:u,className:"p-1 text-[var(--fg-tertiary)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface-hover)] rounded transition-colors",children:t.jsx(ue,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"p-4",children:t.jsx("input",{ref:f,type:"text",value:p,onChange:b=>c(b.target.value),placeholder:s,className:"w-full px-3 py-2 bg-[var(--bg-app)] border border-[var(--border-subtle)] rounded-md text-sm text-[var(--fg-primary)] placeholder-[var(--fg-tertiary)] focus:outline-none focus:border-[var(--border-focus)] focus:ring-1 focus:ring-[var(--border-focus)] transition-colors"})}),t.jsxs("div",{className:"flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--border-subtle)]",children:[t.jsx("button",{onClick:u,className:"px-3 py-1.5 text-xs font-medium text-[var(--fg-secondary)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface-hover)] rounded transition-colors",children:"Cancel"}),t.jsx("button",{onClick:()=>p.trim()&&a(p.trim()),disabled:!p.trim(),className:`px-3 py-1.5 text-xs font-medium rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${w}`,children:o})]})]})]})},sr=({isOpen:n,title:e,message:s,confirmLabel:r="Confirm",confirmVariant:o="primary",onConfirm:l,onCancel:a})=>{if(d.useEffect(()=>{if(!n)return;const p=c=>{c.key==="Escape"?a():c.key==="Enter"&&l()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[n,l,a]),!n)return null;const u=o==="danger"?"bg-red-600 hover:bg-red-500 text-white":"bg-emerald-600 hover:bg-emerald-500 text-white";return t.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[t.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),t.jsxs("div",{className:"relative bg-[var(--bg-surface)] border border-[var(--border-focus)] rounded-lg shadow-2xl w-full max-w-md mx-4 animate-in fade-in zoom-in-95 duration-150",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[var(--border-subtle)]",children:[t.jsx("h2",{className:"text-sm font-semibold text-[var(--fg-primary)]",children:e}),t.jsx("button",{onClick:a,className:"p-1 text-[var(--fg-tertiary)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface-hover)] rounded transition-colors",children:t.jsx(ue,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"text-sm text-[var(--fg-secondary)]",children:s})}),t.jsxs("div",{className:"flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--border-subtle)]",children:[t.jsx("button",{onClick:a,className:"px-3 py-1.5 text-xs font-medium text-[var(--fg-secondary)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface-hover)] rounded transition-colors",children:"Cancel"}),t.jsx("button",{onClick:l,className:`px-3 py-1.5 text-xs font-medium rounded transition-colors ${u}`,children:r})]})]})]})},rr=(n,e,s)=>n?e?s?t.jsx(Ke,{className:"w-3.5 h-3.5 text-[var(--fg-secondary)] fill-[var(--fg-secondary)]/20"}):t.jsx(Ke,{className:"w-3.5 h-3.5 text-[var(--fg-tertiary)]"}):n.endsWith(".rs")?t.jsx($e,{className:"w-3.5 h-3.5 text-orange-600/80"}):n.endsWith(".tsx")||n.endsWith(".ts")?t.jsx($e,{className:"w-3.5 h-3.5 text-blue-500/80"}):n.endsWith(".json")||n.endsWith(".toml")?t.jsx($e,{className:"w-3.5 h-3.5 text-yellow-500/80"}):n.endsWith(".md")?t.jsx(Qe,{className:"w-3.5 h-3.5 text-[var(--fg-secondary)]"}):t.jsx(it,{className:"w-3.5 h-3.5 text-[var(--fg-tertiary)]"}):t.jsx(it,{className:"w-3.5 h-3.5 text-[var(--fg-tertiary)]"}),or=({onFileSelect:n,activeFile:e,roots:s,refreshKey:r})=>{const o=we.useRef(new Map),{showMenu:l}=Me(),[a,u]=d.useState({isOpen:!1,type:"new-file",title:"",defaultValue:"",targetPath:"",isDir:!1}),[p,c]=d.useState({isOpen:!1,title:"",message:"",targetPath:""}),[f,w]=d.useState(null),b=d.useCallback(()=>s.length===0?null:s[0].path,[s]);we.useEffect(()=>{s.forEach(i=>{o.current.has(i.path)||o.current.set(i.path,{id:i.path,name:i.name,is_dir:i.is_dir,data:i})})},[s]);const S=async(i,C,j)=>{const D=`${C}/${i}`;try{await G.file({type:"Create",payload:{path:D,is_dir:j}}),console.log(`[Explorer] Created ${j?"folder":"file"}:`,D)}catch(A){console.error("[Explorer] Failed to create:",A)}},L=async i=>{try{await G.file({type:"Delete",payload:{path:i}}),console.log("[Explorer] Deleted:",i)}catch(C){console.error("[Explorer] Failed to delete:",C)}},x=async(i,C)=>{const D=`${i.substring(0,i.lastIndexOf("/"))}/${C}`;try{await G.file({type:"Rename",payload:{old_path:i,new_path:D}}),console.log("[Explorer] Renamed:",i,"->",D)}catch(A){console.error("[Explorer] Failed to rename:",A)}},_=async i=>{if(!f)return;const C=`${i}/${f.name}`;try{f.operation==="cut"?(await G.file({type:"Rename",payload:{old_path:f.path,new_path:C}}),console.log("[Explorer] Moved:",f.path,"->",C),w(null)):console.log("[Explorer] Copy not yet implemented, path:",f.path)}catch(j){console.error("[Explorer] Failed to paste:",j)}},z=d.useCallback((i,C,j)=>{const D=C?i:i.substring(0,i.lastIndexOf("/")),A=[];return C&&A.push({id:"new-file",label:"New File",icon:t.jsx(ot,{className:"w-4 h-4"}),shortcut:"Ctrl+N",onClick:()=>{u({isOpen:!0,type:"new-file",title:"New File",defaultValue:"",targetPath:i,isDir:!1})}},{id:"new-folder",label:"New Folder",icon:t.jsx(at,{className:"w-4 h-4"}),shortcut:"Ctrl+Shift+N",onClick:()=>{u({isOpen:!0,type:"new-folder",title:"New Folder",defaultValue:"",targetPath:i,isDir:!0})}},{id:"div-1",label:"",divider:!0}),A.push({id:"cut",label:"Cut",icon:t.jsx(zt,{className:"w-4 h-4"}),shortcut:"Ctrl+X",onClick:()=>{w({path:i,name:j,operation:"cut"}),console.log("[Context] Cut:",i)}},{id:"copy",label:"Copy",icon:t.jsx(ze,{className:"w-4 h-4"}),shortcut:"Ctrl+C",onClick:()=>{w({path:i,name:j,operation:"copy"}),console.log("[Context] Copy:",i)}},{id:"paste",label:"Paste",icon:t.jsx(qe,{className:"w-4 h-4"}),shortcut:"Ctrl+V",disabled:!f,onClick:()=>{_(C?i:D)}},{id:"div-2",label:"",divider:!0},{id:"rename",label:"Rename",icon:t.jsx(St,{className:"w-4 h-4"}),shortcut:"F2",onClick:()=>{u({isOpen:!0,type:"rename",title:"Rename",defaultValue:j,targetPath:i,isDir:C})}},{id:"delete",label:"Delete",icon:t.jsx(bn,{className:"w-4 h-4"}),shortcut:"Delete",danger:!0,onClick:()=>{c({isOpen:!0,title:"Delete",message:`Are you sure you want to delete "${j}"? This action cannot be undone.`,targetPath:i})}},{id:"div-3",label:"",divider:!0},{id:"copy-path",label:"Copy Path",icon:t.jsx(ze,{className:"w-4 h-4"}),shortcut:"Ctrl+Shift+C",onClick:async()=>{try{await navigator.clipboard.writeText(i),console.log("[Context] Copied path:",i)}catch(R){console.error("[Context] Failed to copy path:",R)}}},{id:"open-in-terminal",label:"Open in Terminal",icon:t.jsx(ge,{className:"w-4 h-4"}),onClick:async()=>{const R=C?i:D;console.log("[Context] Open terminal at:",R),await Ie("open-terminal",{path:R})}}),A},[f]),N=d.useCallback((i,C,j,D)=>{i.preventDefault(),i.stopPropagation();const A=z(C,j,D);l({x:i.clientX,y:i.clientY},A,{itemId:C,isFolder:j,itemName:D})},[l,z]),h=d.useCallback(i=>{if(i.target.closest("[data-tree-item]"))return;i.preventDefault(),i.stopPropagation();const C=b();if(!C)return;const j=[{id:"new-file",label:"New File",icon:t.jsx(ot,{className:"w-4 h-4"}),shortcut:"Ctrl+N",onClick:()=>{u({isOpen:!0,type:"new-file",title:"New File",defaultValue:"",targetPath:C,isDir:!1})}},{id:"new-folder",label:"New Folder",icon:t.jsx(at,{className:"w-4 h-4"}),shortcut:"Ctrl+Shift+N",onClick:()=>{u({isOpen:!0,type:"new-folder",title:"New Folder",defaultValue:"",targetPath:C,isDir:!0})}},{id:"div-1",label:"",divider:!0},{id:"paste",label:"Paste",icon:t.jsx(qe,{className:"w-4 h-4"}),shortcut:"Ctrl+V",disabled:!f,onClick:()=>{_(C)}}];l({x:i.clientX,y:i.clientY},j)},[l,f,b]),v=Fn({rootItemId:"root",getItemName:i=>i.getItemData()?.name||"Unknown",isItemFolder:i=>i.getItemData()?.is_dir||!1,features:[$n,Bn,Wn,Un,Vn],createLoadingItemData:()=>({id:"loading",name:"Loading...",is_dir:!1}),dataLoader:{getItem:i=>i==="root"?{id:"root",name:"root",is_dir:!0}:o.current.get(i)||{id:i,name:i.split("/").pop()||i,is_dir:!1},getChildren:i=>{const C=i==="root"?null:i;return i==="root"&&s.length>0?(s.forEach(j=>{o.current.set(j.path,{id:j.path,name:j.name,is_dir:j.is_dir,data:j})}),s.map(j=>j.path)):new Promise((j,D)=>{et(()=>Promise.resolve().then(()=>Ts),void 0).then(async({listen:A})=>{let R=!1;const F=await A("sys-event",U=>{let B=U.payload;if(B.event&&B.id&&B.timestamp&&(B=B.event),B.type==="File"&&B.payload.type==="Listing"&&B.payload.payload.path===C){R=!0;const E=B.payload.payload.entries;E.forEach(k=>{o.current.set(k.path,{id:k.path,name:k.name,is_dir:k.is_dir,data:k})}),j(E.map(k=>k.path)),F()}});G.file({type:"List",payload:{path:C}}),setTimeout(()=>{F(),R||j([])},5e3)})})}}});return t.jsxs("div",{className:"flex flex-col h-full w-full",children:[t.jsxs("div",{className:"px-2 py-2 border-b border-[var(--border-subtle)] flex items-center gap-2",children:[t.jsx(Lt,{className:"w-3 h-3 text-[var(--fg-tertiary)]"}),t.jsx("input",{type:"text",placeholder:"Search...",className:"bg-transparent border-none outline-none text-xs w-full text-[var(--fg-primary)] placeholder-[var(--fg-tertiary)]",onChange:i=>v.setSearch(i.target.value)})]}),t.jsxs("div",{...v.getContainerProps(),className:"flex-1 overflow-y-auto text-xs font-mono select-none outline-none",onContextMenu:h,children:[v.getItems().map(i=>d.createElement("div",{...i.getProps(),key:i.getId(),"data-tree-item":!0,className:`group flex items-center gap-1.5 py-1 px-2 cursor-pointer relative
                            ${i.isSelected()?"bg-[var(--bg-selection)] text-[var(--accent-secondary)]":"text-[var(--fg-secondary)] hover:bg-[var(--bg-surface-hover)]"}
                            ${i.isFocused()?"ring-1 ring-inset ring-[var(--border-focus)]":""}
                        `,style:{paddingLeft:`${i.getItemMeta().level*12+8}px`},onClick:C=>{i.isFolder()?i.isExpanded()?i.collapse():i.expand():(i.select(),n(i.getId()))},onContextMenu:C=>N(C,i.getId(),i.isFolder(),i.getItemName()||"")},Array.from({length:i.getItemMeta().level}).map((C,j)=>t.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-[var(--border-subtle)]/20",style:{left:`${j*12+11}px`}},j)),t.jsx("span",{className:`transition-transform duration-200 ${i.isExpanded()?"rotate-90":""}`,children:i.isFolder()?t.jsx(Re,{className:"w-3 h-3 text-[var(--fg-tertiary)] group-hover:text-[var(--fg-secondary)] transition-colors"}):t.jsx("span",{className:"w-3"})}),rr(i.getItemName(),i.isFolder(),i.isExpanded()),t.jsx("span",{className:"truncate opacity-90 group-hover:opacity-100 transition-opacity",children:i.getItemName()}))),v.getItems().length===0&&t.jsx("div",{className:"p-4 text-[var(--fg-tertiary)] italic",children:s.length>0?"Loading tree...":"Waiting for workspace..."})]}),t.jsx(nr,{isOpen:a.isOpen,title:a.title,placeholder:a.type==="rename"?"Enter new name...":a.type==="new-file"?"Enter file name...":"Enter folder name...",defaultValue:a.defaultValue,confirmLabel:a.type==="rename"?"Rename":"Create",onConfirm:i=>{a.type==="rename"?x(a.targetPath,i):S(i,a.targetPath,a.isDir),u(C=>({...C,isOpen:!1}))},onCancel:()=>u(i=>({...i,isOpen:!1}))}),t.jsx(sr,{isOpen:p.isOpen,title:p.title,message:p.message,confirmLabel:"Delete",confirmVariant:"danger",onConfirm:()=>{L(p.targetPath),c(i=>({...i,isOpen:!1}))},onCancel:()=>c(i=>({...i,isOpen:!1}))})]})};class ar extends d.Component{state={hasError:!1,error:null};static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Uncaught error:",e,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error):t.jsxs("div",{className:"p-4 text-red-500 overflow-auto h-full text-xs font-mono bg-zinc-950",children:[t.jsx("h2",{className:"font-bold mb-2",children:"Something went wrong."}),t.jsx("pre",{children:this.state.error?.toString()}),t.jsx("pre",{className:"mt-2 text-zinc-500",children:this.state.error?.stack})]}):this.props.children}}const ir=({onFileSelect:n,activeFile:e})=>{const[s,r]=d.useState([]),[o,l]=d.useState(null),[a,u]=d.useState(0),p=we.useCallback(async()=>{if(!(typeof window>"u"||!("__TAURI_INTERNALS__"in window)))try{await G.file({type:"List",payload:{path:null}}),l(null)}catch(b){console.warn("Failed to load root:",b),l(String(b))}},[]);d.useEffect(()=>{let b;return(async()=>b=await O("sys-event",L=>{const x=L.payload;if(x.type==="File"){const _=x.payload;_.type==="Listing"&&_.payload.path===null&&r(_.payload.entries)}}))(),()=>{b&&b()}},[]),d.useEffect(()=>{p()},[p]),d.useEffect(()=>{let b;return(async()=>b=await O("refresh-explorer",()=>{console.log("[EXPLORER] Refresh event received"),u(L=>L+1),p()}))(),()=>{b&&b()}},[p]);const[c,f]=d.useState(""),w=async()=>{try{const{invoke:b}=await et(async()=>{const{invoke:S}=await Promise.resolve().then(()=>Rs);return{invoke:S}},void 0);await b("open_workspace",{path:c}),p()}catch(b){console.error(b),l(String(b))}};return t.jsxs("div",{className:"h-full bg-[var(--bg-panel)] border-r border-[var(--border-subtle)] flex flex-col text-[var(--fg-secondary)]",children:[t.jsxs("div",{className:"h-9 px-4 flex items-center bg-[var(--bg-panel)] border-b border-[var(--border-subtle)] text-[10px] uppercase tracking-wider font-semibold select-none justify-between text-[var(--fg-tertiary)]",children:[t.jsx("span",{children:"Explorer"}),t.jsx("button",{onClick:p,className:"hover:text-[var(--fg-primary)]",title:"Refresh",children:t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto pt-2 scrollbar-thin scrollbar-thumb-zinc-800",children:s.length===0?t.jsxs("div",{className:"p-4 flex flex-col gap-2",children:[t.jsx("p",{className:"text-xs text-[var(--fg-tertiary)] italic text-center",children:"No workspace open."}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx("input",{className:"bg-[var(--bg-surface)] border border-[var(--border-subtle)] text-xs p-1 w-full rounded-sm text-[var(--fg-primary)]",placeholder:"/path/to/folder",value:c,onChange:b=>f(b.target.value),onKeyDown:b=>b.key==="Enter"&&w()}),t.jsx("button",{onClick:w,className:"p-1.5 bg-[var(--bg-surface)] hover:bg-[var(--bg-surface-hover)] rounded-sm text-[var(--fg-primary)]",children:t.jsx(Re,{className:"w-3 h-3"})})]}),o&&t.jsx("p",{className:"text-[10px] text-[var(--accent-error)] break-all",children:o})]}):t.jsx(ar,{children:t.jsx(or,{onFileSelect:n,activeFile:e,roots:s,refreshKey:a})})})]})},m={bg:"#0f0f12",bgPanel:"#0c0c0e",bgSurface:"#18181b",bgSurfaceHover:"#27272a",fg:"#e4e4e7",fgMuted:"#a1a1aa",fgSubtle:"#71717a",border:"#1f1f22",borderFocus:"#3f3f46",accent:"#60a5fa",keyword:"#c084fc",string:"#4ade80",number:"#fb923c",comment:"#6b7280",function:"#60a5fa",variable:"#e4e4e7",type:"#22d3ee",constant:"#f472b6",operator:"#94a3b8",property:"#a5b4fc",tag:"#f87171",attribute:"#fbbf24",regexp:"#fb7185",macro:"#e879f9",selection:"rgba(96, 165, 250, 0.2)",selectionMatch:"rgba(96, 165, 250, 0.15)",activeLine:"rgba(255, 255, 255, 0.03)",activeLineGutter:"rgba(255, 255, 255, 0.05)",cursor:"#60a5fa",matchingBracket:"rgba(96, 165, 250, 0.3)",gutterBg:"transparent",gutterFg:"#52525b",lineNumber:"#52525b",lineNumberActive:"#e4e4e7"},lr=se.theme({"&":{backgroundColor:m.bg,color:m.fg,fontSize:"14px",fontFamily:'"Fira Code", "Symbols Nerd Font Mono", monospace'},".cm-content":{caretColor:m.cursor,fontFamily:'"Fira Code", "Symbols Nerd Font Mono", monospace',lineHeight:"1.6",padding:"8px 0"},".cm-cursor, .cm-dropCursor":{borderLeftColor:m.cursor,borderLeftWidth:"2px"},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:m.selection},".cm-selectionMatch":{backgroundColor:m.selectionMatch,borderRadius:"2px"},".cm-activeLine":{backgroundColor:m.activeLine},".cm-activeLineGutter":{backgroundColor:m.activeLineGutter},".cm-gutters":{backgroundColor:m.gutterBg,color:m.gutterFg,border:"none",paddingRight:"8px"},".cm-lineNumbers .cm-gutterElement":{color:m.lineNumber,padding:"0 12px 0 8px",minWidth:"40px",fontFamily:'"Fira Code", monospace',fontSize:"12px"},".cm-lineNumbers .cm-gutterElement.cm-activeLineGutter":{color:m.lineNumberActive,fontWeight:"500"},".cm-foldGutter .cm-gutterElement":{color:m.fgSubtle,padding:"0 4px",cursor:"pointer",transition:"color 0.15s ease"},".cm-foldGutter .cm-gutterElement:hover":{color:m.fg},".cm-foldPlaceholder":{backgroundColor:m.bgSurface,color:m.fgMuted,border:`1px solid ${m.border}`,borderRadius:"4px",padding:"0 6px",margin:"0 4px",fontSize:"12px"},"&.cm-focused .cm-matchingBracket":{backgroundColor:m.matchingBracket,outline:`1px solid ${m.accent}`,borderRadius:"2px"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"rgba(239, 68, 68, 0.3)",outline:"1px solid rgba(239, 68, 68, 0.6)"},".cm-searchMatch":{backgroundColor:"rgba(251, 191, 36, 0.3)",outline:"1px solid rgba(251, 191, 36, 0.6)",borderRadius:"2px"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"rgba(251, 191, 36, 0.5)"},".cm-panels":{backgroundColor:m.bgPanel,color:m.fg,borderBottom:`1px solid ${m.border}`},".cm-panels.cm-panels-top":{borderBottom:`1px solid ${m.border}`},".cm-panels.cm-panels-bottom":{borderTop:`1px solid ${m.border}`},".cm-textfield":{backgroundColor:m.bgSurface,color:m.fg,border:`1px solid ${m.border}`,borderRadius:"4px",padding:"4px 8px",fontSize:"13px",outline:"none"},".cm-textfield:focus":{borderColor:m.accent,boxShadow:`0 0 0 2px ${m.selection}`},".cm-button":{backgroundColor:m.bgSurface,color:m.fg,border:`1px solid ${m.border}`,borderRadius:"4px",padding:"4px 12px",fontSize:"13px",cursor:"pointer",transition:"all 0.15s ease"},".cm-button:hover":{backgroundColor:m.bgSurfaceHover,borderColor:m.borderFocus},".cm-tooltip":{backgroundColor:m.bgPanel,color:m.fg,border:`1px solid ${m.border}`,borderRadius:"6px",boxShadow:"0 4px 20px -2px rgba(0, 0, 0, 0.5)"},".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:'"Fira Code", monospace',fontSize:"13px"},"& > ul > li":{padding:"4px 12px"},"& > ul > li[aria-selected]":{backgroundColor:m.bgSurfaceHover,color:m.fg}},".cm-completionIcon":{opacity:"0.8",paddingRight:"8px"},".cm-completionLabel":{color:m.fg},".cm-completionDetail":{color:m.fgMuted,fontStyle:"italic",marginLeft:"8px"},".cm-completionMatchedText":{color:m.accent,fontWeight:"600",textDecoration:"none"},".cm-lintRange-error":{backgroundImage:`url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='6' height='3'><path d='m0 3 l2 -2 l1 0 l2 2 l1 0' stroke='%23ef4444' fill='none' stroke-width='1'/></svg>")`},".cm-lintRange-warning":{backgroundImage:`url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='6' height='3'><path d='m0 3 l2 -2 l1 0 l2 2 l1 0' stroke='%23f59e0b' fill='none' stroke-width='1'/></svg>")`},".cm-lintRange-info":{backgroundImage:`url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='6' height='3'><path d='m0 3 l2 -2 l1 0 l2 2 l1 0' stroke='%2360a5fa' fill='none' stroke-width='1'/></svg>")`},".cm-line":{position:"relative"},".cm-scroller":{overflow:"auto",fontFamily:'"Fira Code", "Symbols Nerd Font Mono", monospace'}},{dark:!0}),cr=Hn.define([{tag:y.comment,color:m.comment,fontStyle:"italic"},{tag:y.lineComment,color:m.comment,fontStyle:"italic"},{tag:y.blockComment,color:m.comment,fontStyle:"italic"},{tag:y.docComment,color:m.comment,fontStyle:"italic"},{tag:y.keyword,color:m.keyword,fontWeight:"500"},{tag:y.controlKeyword,color:m.keyword,fontWeight:"500"},{tag:y.moduleKeyword,color:m.keyword,fontWeight:"500"},{tag:y.operatorKeyword,color:m.keyword},{tag:y.definitionKeyword,color:m.keyword,fontWeight:"500"},{tag:y.operator,color:m.operator},{tag:y.compareOperator,color:m.operator},{tag:y.arithmeticOperator,color:m.operator},{tag:y.logicOperator,color:m.operator},{tag:y.bitwiseOperator,color:m.operator},{tag:y.updateOperator,color:m.operator},{tag:y.derefOperator,color:m.operator},{tag:y.string,color:m.string},{tag:y.special(y.string),color:m.string},{tag:y.docString,color:m.string},{tag:y.character,color:m.string},{tag:y.escape,color:m.regexp},{tag:y.number,color:m.number},{tag:y.integer,color:m.number},{tag:y.float,color:m.number},{tag:y.bool,color:m.constant},{tag:y.null,color:m.constant},{tag:y.variableName,color:m.variable},{tag:y.definition(y.variableName),color:m.variable},{tag:y.local(y.variableName),color:m.variable},{tag:y.special(y.variableName),color:m.constant},{tag:y.function(y.variableName),color:m.function},{tag:y.definition(y.function(y.variableName)),color:m.function},{tag:y.propertyName,color:m.property},{tag:y.definition(y.propertyName),color:m.property},{tag:y.special(y.propertyName),color:m.property},{tag:y.typeName,color:m.type},{tag:y.className,color:m.type},{tag:y.namespace,color:m.type},{tag:y.standard(y.typeName),color:m.type},{tag:y.constant(y.variableName),color:m.constant},{tag:y.labelName,color:m.accent},{tag:y.regexp,color:m.regexp},{tag:y.tagName,color:m.tag},{tag:y.standard(y.tagName),color:m.tag},{tag:y.angleBracket,color:m.fgMuted},{tag:y.attributeName,color:m.attribute},{tag:y.attributeValue,color:m.string},{tag:y.punctuation,color:m.fgMuted},{tag:y.separator,color:m.fgMuted},{tag:y.bracket,color:m.fgMuted},{tag:y.squareBracket,color:m.fgMuted},{tag:y.paren,color:m.fgMuted},{tag:y.brace,color:m.fgMuted},{tag:y.meta,color:m.fgMuted},{tag:y.annotation,color:m.macro},{tag:y.processingInstruction,color:m.macro},{tag:y.macroName,color:m.macro},{tag:y.heading,color:m.accent,fontWeight:"600"},{tag:y.heading1,color:m.accent,fontWeight:"700",fontSize:"1.4em"},{tag:y.heading2,color:m.accent,fontWeight:"600",fontSize:"1.2em"},{tag:y.heading3,color:m.accent,fontWeight:"600"},{tag:y.link,color:m.accent,textDecoration:"underline"},{tag:y.url,color:m.accent},{tag:y.emphasis,fontStyle:"italic"},{tag:y.strong,fontWeight:"bold"},{tag:y.strikethrough,textDecoration:"line-through"},{tag:y.monospace,fontFamily:'"Fira Code", monospace'},{tag:y.invalid,color:"#ef4444",textDecoration:"underline wavy"}]),dr=[lr,Gn(cr)];function xt(n){if(!n)return[];switch(n.split(".").pop()?.toLowerCase()){case"rs":return[es()];case"js":case"mjs":case"cjs":return[Ee()];case"jsx":return[Ee({jsx:!0})];case"ts":case"mts":case"cts":return[Ee({typescript:!0})];case"tsx":return[Ee({jsx:!0,typescript:!0})];case"py":case"pyw":case"pyi":return[Qn()];case"json":case"jsonc":case"json5":return[Zn()];case"css":case"scss":case"less":return[Yn()];case"html":case"htm":case"xhtml":return[Xn()];case"md":case"markdown":case"mdx":return[Jn()];case"yaml":case"yml":return[qn()];case"c":case"h":return[dt()];case"cpp":case"cc":case"cxx":case"hpp":case"hxx":case"hh":return[dt()];case"go":return[Kn()];case"toml":return[];case"sh":case"bash":case"zsh":return[];default:return[]}}const ur=q.mark({class:"cm-indent-guide"}),pr=Tt.fromClass(class{decorations;constructor(n){this.decorations=this.buildDecorations(n)}update(n){(n.docChanged||n.viewportChanged)&&(this.decorations=this.buildDecorations(n.view))}buildDecorations(n){const e=new At,s=n.state.tabSize;for(const{from:r,to:o}of n.visibleRanges)for(let l=r;l<o;){const a=n.state.doc.lineAt(l),u=a.text;let p=0,c=0;for(;c<u.length;){const f=u[c];if(f===" ")p++,c++;else if(f==="	")p+=s-p%s,c++;else break}if(p>=s&&c>0){let f=s,w=0,b=0;for(;w<c&&b<p;){const S=u[w];S===" "?b++:S==="	"&&(b+=s-b%s),b===f&&f<p&&(e.add(a.from+w,a.from+w+1,ur),f+=s),w++}}l=a.to+1}return e.finish()}},{decorations:n=>n.decorations}),hr=se.theme({".cm-indent-guide":{borderLeft:"1px solid rgba(255, 255, 255, 0.06)",marginLeft:"-1px"}}),fr=[pr,hr],Vt=["#fbbf24","#a78bfa","#34d399","#60a5fa","#f472b6","#fb923c"],mr=Vt.map(n=>q.mark({class:"cm-rainbow-bracket",attributes:{style:`color: ${n}`}})),gr=new Set(["(","[","{"]),xr=new Set([")","]","}"]),br={"(":")","[":"]","{":"}"},yr=Tt.fromClass(class{decorations;constructor(n){this.decorations=this.buildDecorations(n)}update(n){(n.docChanged||n.viewportChanged)&&(this.decorations=this.buildDecorations(n.view))}buildDecorations(n){const e=new At,s=n.state.doc,r=ts(n.state),o=[],l=[];for(const{from:a,to:u}of n.visibleRanges){const p=s.sliceString(0,u);let c=0;for(let f=0;f<p.length;f++){const w=p[f],S=r.resolveInner(f,1).type.name.toLowerCase();if(!(S.includes("string")||S.includes("comment")||S.includes("template"))){if(gr.has(w))o.push({char:w,pos:f,depth:c}),f>=a&&l.push({from:f,to:f+1,depth:c}),c++;else if(xr.has(w)){c=Math.max(0,c-1);for(let L=o.length-1;L>=0;L--)if(br[o[L].char]===w){f>=a&&l.push({from:f,to:f+1,depth:o[L].depth}),o.splice(L,1);break}}}}}l.sort((a,u)=>a.from-u.from);for(const a of l){const u=a.depth%Vt.length;e.add(a.from,a.to,mr[u])}return e.finish()}},{decorations:n=>n.decorations}),wr=se.theme({".cm-rainbow-bracket":{fontWeight:"500"}}),vr=[yr,wr],jr=se.theme({".cm-cursor":{transition:"left 50ms ease-out, top 50ms ease-out"},"@keyframes cm-cursor-blink":{"0%, 100%":{opacity:"1"},"50%":{opacity:"0"}},"&.cm-focused .cm-cursor":{animation:"cm-cursor-blink 1s ease-in-out infinite"}}),Nr=se.theme({".cm-content":{paddingBottom:"50vh"}}),Ht=J.define(),Gt=J.define(),Cr=q.line({attributes:{class:"cm-highlighted-line",style:"background-color: rgba(255, 255, 0, 0.15); border-left: 3px solid rgba(255, 255, 0, 0.6);"}}),kr=Ae.define({create(){return q.none},update(n,e){n=n.map(e.changes);for(const s of e.effects)if(s.is(Ht)){const{startLine:r,endLine:o}=s.value,l=[];for(let a=r;a<=o;a++)try{const u=e.state.doc.line(a);l.push(Cr.range(u.from))}catch{console.warn(`Line ${a} out of range`)}n=q.set(l)}else s.is(Gt)&&(n=q.none);return n},provide:n=>se.decorations.from(n)}),_r=({original:n,modified:e,onAccept:s,onReject:r})=>t.jsxs("div",{className:"my-1 rounded-md overflow-hidden border border-zinc-700 font-mono text-sm bg-[#1e1e1e] shadow-lg select-none",children:[t.jsxs("div",{className:"flex items-center justify-between bg-zinc-800 px-2 py-1 border-b border-zinc-700",children:[t.jsx("div",{className:"flex items-center gap-2 text-xs text-zinc-400",children:t.jsx("span",{className:"font-semibold text-purple-400",children:"AI Suggestion"})}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("button",{onClick:s,className:"flex items-center gap-1 px-3 py-1 rounded bg-emerald-600 text-white hover:bg-emerald-500 transition-colors text-xs font-semibold shadow-lg",children:[t.jsx(Te,{className:"w-3 h-3"}),"Accept"]}),t.jsxs("button",{onClick:r,className:"flex items-center gap-1 px-3 py-1 rounded bg-red-600 text-white hover:bg-red-500 transition-colors text-xs font-semibold shadow-lg",children:[t.jsx(ue,{className:"w-3 h-3"}),"Reject"]})]})]}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"bg-red-900/20 border-l-2 border-red-500/50 p-2 opacity-70 relative group",children:[t.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-50 text-[10px] text-red-400",children:"ORIGINAL"}),t.jsx("pre",{className:"m-0 whitespace-pre-wrap text-red-100/70 strike-through",children:n})]}),t.jsxs("div",{className:"bg-emerald-900/20 border-l-2 border-emerald-500/50 p-2 relative group",children:[t.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-50 text-[10px] text-emerald-400",children:"MODIFIED"}),t.jsx("pre",{className:"m-0 whitespace-pre-wrap text-emerald-100",children:e})]})]})]}),Er=J.define(),Je=J.define(),Kt=J.define();J.define();J.define();class bt extends ns{constructor(e){super(),this.diff=e}eq(e){return e.diff.id===this.diff.id}toDOM(e){const s=document.createElement("div"),r=yn.createRoot(s),o=()=>{const a=e.posAtDOM(s),u=this.diff.to-this.diff.from,p=a+u;e.dispatch({changes:{from:a,to:p,insert:this.diff.modified},effects:Je.of(this.diff.id)})},l=()=>{e.dispatch({effects:Je.of(this.diff.id)})};return r.render(t.jsx(_r,{original:this.diff.original,modified:this.diff.modified,onAccept:o,onReject:l})),s}}const Sr=Ae.define({create(){return q.none},update(n,e){n=n.map(e.changes);for(const s of e.effects)if(s.is(Er)){const r=q.replace({widget:new bt(s.value),block:!0});n=n.update({add:[r.range(s.value.from,s.value.to)]})}else s.is(Je)?n=n.update({filter:(r,o,l)=>!(l.spec.widget instanceof bt&&l.spec.widget.diff.id===s.value)}):s.is(Kt)&&(n=q.none);return n},provide:n=>se.decorations.from(n)}),Xe=J.define(),Dr=J.define(),zr=J.define(),Lr=J.define(),Rr=J.define(),Tr=J.define();function qt(n,e){let s=n;for(const r of e)r.accepted&&(s=s.replace(r.old_content,r.new_content));return s}const Jt=Ae.define({create(){return{baseContent:"",pendingDiffs:[],isDirty:!1}},update(n,e){let s=n;for(const r of e.effects)r.is(Xe)?s={baseContent:r.value,pendingDiffs:[],isDirty:!1}:r.is(Dr)?s={...s,pendingDiffs:[...s.pendingDiffs,r.value]}:r.is(zr)?s={...s,pendingDiffs:s.pendingDiffs.map(o=>o.id===r.value?{...o,accepted:!0}:o),isDirty:!0}:r.is(Lr)?s={...s,pendingDiffs:s.pendingDiffs.filter(o=>o.id!==r.value)}:r.is(Rr)?s={baseContent:qt(s.baseContent,s.pendingDiffs),pendingDiffs:[],isDirty:!1}:r.is(Tr)&&(s={...s,pendingDiffs:[],isDirty:!1});return s}});function Ar(n){const e=n.state.field(Jt);return qt(e.baseContent,e.pendingDiffs)}const Xt=J.define(),Yt=J.define(),Ir=q.line({class:"cm-diff-removed-line"});q.line({class:"cm-diff-added-line"});q.line({class:"cm-diff-context-line"});const Mr=Ae.define({create(){return{diff:null,decorations:q.none}},update(n,e){let s=n.diff,r=n.decorations;for(const o of e.effects)if(o.is(Xt))if(s=o.value,s){const l=[];for(const a of s.hunks)for(let u=a.fromLine;u<=a.toLine;u++)try{const p=e.state.doc.line(u);l.push(Ir.range(p.from))}catch{}l.sort((a,u)=>a.from-u.from),r=q.set(l)}else r=q.none;else o.is(Yt)&&(s=null,r=q.none);return e.docChanged&&r!==q.none&&(r=r.map(e.changes)),{diff:s,decorations:r}},provide:n=>se.decorations.from(n,e=>e.decorations)}),Pr=se.theme({".cm-diff-removed-line":{backgroundColor:"rgba(239, 68, 68, 0.15)",borderLeft:"3px solid rgba(239, 68, 68, 0.6)"},".cm-diff-added-line":{backgroundColor:"rgba(34, 197, 94, 0.15)",borderLeft:"3px solid rgba(34, 197, 94, 0.6)"},".cm-diff-context-line":{backgroundColor:"rgba(161, 161, 170, 0.05)"},".cm-diff-ghost-text":{color:"rgba(34, 197, 94, 0.7)",fontStyle:"italic"}});function yt(n,e,s){const r=n.indexOf(e);if(r===-1)return null;const l=(n.substring(0,r).match(/\n/g)||[]).length+1,a=(e.match(/\n/g)||[]).length+1,u=l+a-1,p=[];for(let f=l;f<=u;f++)p.push(f);return{removedLines:p,addedLines:[]}}const Zt=d.forwardRef(({content:n,onChange:e,onSave:s,filename:r,highlightLines:o},l)=>{const a=d.useRef(null),u=d.useRef(null),p=d.useRef(new ss),{setCursorPosition:c,setSelection:f,clearSelection:w}=tt(),{showMenu:b}=Me();d.useImperativeHandle(l,()=>({getView:()=>u.current,clearDiffs:()=>{u.current&&u.current.dispatch({effects:Kt.of(null)})},showInlineDiff:x=>{const _=u.current;if(!_)return;if(!x){_.dispatch({effects:Yt.of(null)});return}const z=_.state.doc.toString(),N=[];if(x.change_type==="patch"){const h=yt(z,x.old_content,x.new_content);h&&N.push({id:`${x.id}-0`,fromLine:h.removedLines[0]||1,toLine:h.removedLines[h.removedLines.length-1]||1,oldText:x.old_content,newText:x.new_content})}else x.change_type==="multi_patch"&&x.patches.forEach((h,v)=>{const i=yt(z,h.old_text,h.new_text);i&&N.push({id:`${x.id}-${v}`,fromLine:h.start_line||i.removedLines[0]||1,toLine:h.end_line||i.removedLines[i.removedLines.length-1]||1,oldText:h.old_text,newText:h.new_text})});N.length>0&&_.dispatch({effects:Xt.of({id:x.id,hunks:N,path:x.path})})}})),d.useEffect(()=>{if(!a.current||u.current)return;const x=rs.create({doc:n,extensions:[os(),as(),is(),ls(),cs(),ds(),us(),ps(),hs(),fs(),ms(),gs(),xs(),bs(),ys(),dr,fr,vr,jr,Nr,Sr,kr,Jt,Mr,Pr,se.theme({"&":{height:"100%"},".cm-scroller":{overflow:"auto"}}),p.current.of(xt(r)),ws.of([vs,{key:"Mod-s",run:z=>{if(s){const N=Ar(z);s(N)}return!0}},...js,...Ns,...Cs,...ks,..._s,...Es]),se.updateListener.of(z=>{if(z.docChanged&&e(z.state.doc.toString()),z.selectionSet){const N=z.state.selection.main,h=z.state.doc.lineAt(N.head),v=h.number,i=N.head-h.from;if(c(v,i),N.from!==N.to){const C=z.state.doc.lineAt(N.from).number,j=z.state.doc.lineAt(N.to).number;f(C,j)}else w()}})]}),_=new se({state:x,parent:a.current});return u.current=_,()=>{_.destroy(),u.current=null}},[]);const S=d.useRef(r);d.useEffect(()=>{const x=u.current;if(!x)return;r!==S.current?(S.current=r,x.dispatch({changes:{from:0,to:x.state.doc.length,insert:n},effects:[p.current.reconfigure(xt(r)),Xe.of(n)]})):x.state.doc.toString()!==n&&x.dispatch({changes:{from:0,to:x.state.doc.length,insert:n},effects:Xe.of(n)})},[r,n]),d.useEffect(()=>{const x=u.current;if(x&&n)if(o)try{setTimeout(()=>{if(!u.current)return;const _=u.current.state.doc.line(o.startLine);u.current.dispatch({effects:[Ht.of({startLine:o.startLine,endLine:o.endLine}),se.scrollIntoView(_.from,{y:"center"})]})},100)}catch(_){console.error("Error applying line highlight:",_)}else x.dispatch({effects:Gt.of(null)})},[o,n]);const L=d.useCallback(x=>{x.preventDefault(),x.stopPropagation();const _=u.current;if(!_)return;const z=_.state.selection.main.from!==_.state.selection.main.to,N=[{id:"cut",label:"Cut",icon:t.jsx(zt,{className:"w-4 h-4"}),shortcut:"Ctrl+X",disabled:!z,onClick:()=>{document.execCommand("cut")}},{id:"copy",label:"Copy",icon:t.jsx(ze,{className:"w-4 h-4"}),shortcut:"Ctrl+C",disabled:!z,onClick:()=>{document.execCommand("copy")}},{id:"paste",label:"Paste",icon:t.jsx(qe,{className:"w-4 h-4"}),shortcut:"Ctrl+V",onClick:()=>{document.execCommand("paste")}},{id:"div-1",label:"",divider:!0},{id:"undo",label:"Undo",icon:t.jsx(wn,{className:"w-4 h-4"}),shortcut:"Ctrl+Z",onClick:()=>{document.execCommand("undo")}},{id:"redo",label:"Redo",icon:t.jsx(vn,{className:"w-4 h-4"}),shortcut:"Ctrl+Shift+Z",onClick:()=>{document.execCommand("redo")}},{id:"div-2",label:"",divider:!0},{id:"find",label:"Find",icon:t.jsx(Lt,{className:"w-4 h-4"}),shortcut:"Ctrl+F",onClick:()=>{const h=new KeyboardEvent("keydown",{key:"f",ctrlKey:!0,bubbles:!0});_.contentDOM.dispatchEvent(h)}}];b({x:x.clientX,y:x.clientY},N)},[b]);return t.jsx("div",{className:"h-full w-full relative",onContextMenu:L,children:t.jsx("div",{ref:a,className:"h-full w-full overflow-hidden text-base"})})});Zt.displayName="CodeEditor";const Or=({currentFileIndex:n,totalFiles:e,currentHunkIndex:s,totalHunks:r,onAccept:o,onReject:l,onNextFile:a,onPrevFile:u,onNextHunk:p,onPrevHunk:c,filename:f})=>(we.useEffect(()=>{const w=b=>{b.ctrlKey&&b.key==="Enter"&&(b.preventDefault(),o()),b.ctrlKey&&b.key==="Backspace"&&(b.preventDefault(),l()),b.altKey&&b.key==="k"&&(b.preventDefault(),c?.()),b.altKey&&b.key==="j"&&(b.preventDefault(),p?.())};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[o,l,p,c]),t.jsx("div",{className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50",children:t.jsxs("div",{className:"flex items-center gap-1 bg-zinc-900/95 border border-zinc-700/60 rounded-lg shadow-2xl px-2 py-1.5 backdrop-blur-sm",children:[t.jsxs("button",{onClick:o,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium bg-emerald-600 hover:bg-emerald-500 text-white transition-colors",title:"Accept Changes (Ctrl+Enter)",children:[t.jsx(Te,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:"Accept Changes"}),t.jsx("kbd",{className:"ml-1 px-1 py-0.5 text-[9px] bg-emerald-700/50 rounded",children:"Ctrl+â†µ"})]}),t.jsxs("button",{onClick:l,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium bg-zinc-700 hover:bg-red-600 text-zinc-300 hover:text-white transition-colors",title:"Reject (Ctrl+Backspace)",children:[t.jsx("span",{children:"Reject"}),t.jsx("kbd",{className:"ml-1 px-1 py-0.5 text-[9px] bg-zinc-600/50 rounded",children:"Ctrl+âŒ«"})]}),t.jsx("div",{className:"w-px h-5 bg-zinc-700 mx-1"}),r&&r>1&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:c,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 transition-colors",title:"Previous hunk (Alt+K)",children:t.jsx(lt,{className:"w-3.5 h-3.5"})}),t.jsx("span",{className:"text-[10px] text-zinc-500 font-mono px-1",children:t.jsx("kbd",{className:"text-zinc-600",children:"Alt+K"})}),t.jsx("button",{onClick:p,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 transition-colors",title:"Next hunk (Alt+J)",children:t.jsx(ke,{className:"w-3.5 h-3.5"})}),t.jsx("span",{className:"text-[10px] text-zinc-500 font-mono px-1",children:t.jsx("kbd",{className:"text-zinc-600",children:"Alt+J"})}),t.jsx("div",{className:"w-px h-5 bg-zinc-700 mx-1"})]}),t.jsx("button",{onClick:u,disabled:n<=1,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Previous file",children:t.jsx(lt,{className:"w-3.5 h-3.5"})}),t.jsxs("span",{className:"text-xs text-zinc-400 font-mono min-w-[80px] text-center",children:["Edited files ",t.jsxs("span",{className:"text-zinc-200",children:[n,"/",e]})]}),t.jsx("button",{onClick:a,disabled:n>=e,className:"p-1.5 rounded hover:bg-zinc-700/50 text-zinc-400 hover:text-zinc-200 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Next file",children:t.jsx(ke,{className:"w-3.5 h-3.5"})})]})})),wt=({activeFile:n,highlightLines:e,pendingEdit:s,onAcceptEdit:r,onRejectEdit:o,totalPendingFiles:l=1,currentFileIndex:a=1,onNextFile:u,onPrevFile:p})=>{const[c,f]=d.useState(""),[w,b]=d.useState(!1),[S,L]=d.useState(null),[x,_]=d.useState(0),{setActiveFile:z}=tt(),N=d.useRef(null);d.useEffect(()=>{z(n)},[n,z]),d.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let v,i;return(async()=>(v=await O(je.CHANGE_APPLIED,j=>{j.payload.file_path===n&&(console.log("[EDITOR] Change applied, reloading:",n),N.current&&N.current.clearDiffs(),_(D=>D+1))}),i=await O(je.ALL_EDITS_APPLIED,j=>{j.payload.file_paths.includes(n||"")&&(console.log("[EDITOR] All edits applied, reloading:",n),N.current&&N.current.clearDiffs(),_(D=>D+1))})))(),()=>{v&&v(),i&&i()}},[n]),d.useEffect(()=>{if(!n)return;let v;return(async()=>v=await O("sys-event",C=>{const j=C.payload;if(j.type==="File"){const D=j.payload;D.type==="Content"&&D.payload.path===n?(console.log("[EDITOR] Received content for:",n),f(D.payload.data),b(!1),L(null)):D.type==="Written"&&D.payload.path===n&&console.log("[EDITOR] Confirmed written:",n)}else if(j.type==="System"){const D=j.payload;if(D.type==="IntentFailed"&&w){const A=D.payload.error;"details"in A&&A.details.id?.includes(n)&&(L(`Failed to load: ${JSON.stringify(A)}`),b(!1))}}}))(),()=>{v&&v()}},[n,w]),d.useEffect(()=>{async function v(){if(!n){f("");return}b(!0),L(null);try{typeof window<"u"&&await G.file({type:"Read",payload:{path:n}})}catch(i){console.error(i),L(String(i))}finally{b(!1)}}v()},[n,x]);const h=async v=>{if(n)try{await G.file({type:"Write",payload:{path:n,content:v}}),console.log("Save intent dispatched:",n)}catch(i){console.error("Save failed:",i)}};return n?t.jsxs("div",{className:"h-full flex flex-col relative bg-[#1e1e1e]",children:[w&&t.jsx("div",{className:"absolute inset-0 bg-black/50 z-10 flex items-center justify-center",children:t.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-emerald-500 border-t-transparent rounded-full"})}),S&&t.jsxs("div",{className:"bg-red-900/50 text-red-200 p-2 text-xs font-mono",children:["ERR_LOAD: ",S]}),t.jsx(Zt,{ref:N,content:c,onChange:f,onSave:h,filename:n,highlightLines:e||void 0}),s&&s.path===n&&r&&o&&t.jsx(Or,{currentFileIndex:a,totalFiles:l,onAccept:async()=>{await r(s.id),setTimeout(()=>_(v=>v+1),100)},onReject:()=>{o(s.id)},onNextFile:u,onPrevFile:p,filename:s.path.split("/").pop()})]}):t.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-zinc-600 select-none bg-zinc-900/50",onContextMenu:v=>v.preventDefault(),children:[t.jsx("div",{className:"text-4xl opacity-20 mb-4 font-thin",children:"âˆ…"}),t.jsx("p",{className:"font-mono text-xs uppercase tracking-widest opacity-50",children:"No Active Buffer"})]})};function Fr({id:n="main-terminal",cwd:e}){const s=d.useRef(null),r=d.useRef(null),o=d.useRef(null),l=d.useRef(null);return d.useEffect(()=>{if(!s.current||r.current)return;const a=new Rt({cursorBlink:!0,fontFamily:'"Fira Code", "Symbols Nerd Font Mono", monospace',fontSize:12,lineHeight:1.2,theme:{background:"#09090b",foreground:"#d4d4d8",cursor:"#e4e4e7",selectionBackground:"rgba(255, 255, 255, 0.2)"},allowTransparency:!0,fontWeight:"normal",fontWeightBold:"bold"}),u=new Pn;a.loadAddon(u),a.loadAddon(new On),a.open(s.current);let p=0;const c=setInterval(()=>{p++;try{const x=u.proposeDimensions();x&&x.cols>0&&x.rows>0&&(u.fit(),clearInterval(c),a.refresh(0,a.rows-1))}catch{}p>20&&clearInterval(c)},100);r.current=a,o.current=u,(async()=>{try{let x=e;x||(x=await g("get_current_workspace")||void 0),await G.terminal({type:"Spawn",payload:{id:n,cwd:x,interactive:!0}}),setTimeout(()=>{const _=u.proposeDimensions();_&&G.terminal({type:"Resize",payload:{id:n,rows:_.rows,cols:_.cols}})},50)}catch(x){console.error("Failed to create terminal:",x),a.write(`\r
\x1B[31mFailed to initialize terminal backend.\x1B[0m\r
`)}})(),l.current||(l.current=new Us((x,_)=>{x===n&&r.current&&r.current.write(_)}));const w=O("terminal-output",x=>{x.payload.id===n&&a.write(x.payload.data)}),b=O("blade-event",x=>{const _=x.payload;if(_.event.type==="Terminal"){const z=_.event.payload;if(z.type==="Output"){const{id:N,seq:h,data:v}=z.payload;l.current&&l.current.addOutput(N,h,v)}else if(z.type==="Spawned"){const{id:N,owner:h}=z.payload;console.log(`[v1.1 Terminal] Spawned: id=${N}, owner=${h.type}`)}else if(z.type==="Exit"){const{id:N,code:h}=z.payload;N===n&&r.current&&r.current.write(`\r
\x1B[33mProcess exited with code ${h}\x1B[0m\r
`)}}});a.onData(x=>{G.terminal({type:"Input",payload:{id:n,data:x}}).catch(console.error)});const S=()=>{if(!(!o.current||!s.current||!r.current))try{o.current.fit(),r.current.refresh(0,r.current.rows-1);const x=o.current.proposeDimensions();x&&x.cols>0&&x.rows>0&&G.terminal({type:"Resize",payload:{id:n,rows:x.rows,cols:x.cols}}).catch(_=>console.error("Resize failed",_))}catch(x){console.error("Resize logic error",x)}},L=new ResizeObserver(()=>{requestAnimationFrame(()=>{s.current?.offsetParent&&S()})});return L.observe(s.current),()=>{L.disconnect(),w.then(x=>x()),b.then(x=>x());try{a.dispose()}catch(x){console.error("Error disposing terminal",x)}r.current=null,l.current=null}},[n]),t.jsx("div",{ref:s,className:"w-full h-full bg-[var(--term-bg)]",style:{overflow:"hidden"}})}const $r=()=>{const[n,e]=d.useState([{id:"term-1",title:"Terminal 1"}]),[s,r]=d.useState("term-1");d.useEffect(()=>{const a=O("open-terminal",u=>{const{path:p}=u.payload,c=p.split("/").pop()||"Terminal",f=`term-${Date.now()}`,w={id:f,title:c,cwd:p};e(b=>[...b,w]),r(f),console.log("[TerminalPane] Opening terminal at:",p)});return()=>{a.then(u=>u())}},[]);const o=()=>{const a=`term-${Date.now()}`,u={id:a,title:"zsh"};e([...n,u]),r(a)},l=(a,u)=>{if(a.stopPropagation(),n.length===1)return;const p=n.filter(c=>c.id!==u);e(p),s===u&&r(p[p.length-1].id)};return t.jsxs("div",{className:"h-full flex flex-row bg-[#1e1e1e]",children:[t.jsx("div",{className:"flex-1 relative overflow-hidden",children:n.map(a=>t.jsx("div",{className:"absolute inset-0 w-full h-full",style:{visibility:a.id===s?"visible":"hidden",zIndex:a.id===s?10:0},children:t.jsx(Fr,{id:a.id,cwd:a.cwd})},a.id))}),t.jsxs("div",{className:"w-48 bg-[#252526] border-l border-[#3c3c3c] flex flex-col",children:[t.jsxs("div",{className:"p-2 text-xs font-semibold text-zinc-400 uppercase tracking-wider flex items-center justify-between",children:[t.jsx("span",{children:"Terminals"}),t.jsx("button",{onClick:o,className:"hover:text-white transition-colors",children:t.jsx(jn,{className:"w-4 h-4"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:n.map(a=>t.jsxs("div",{onClick:()=>r(a.id),className:`
                    group flex items-center justify-between px-3 py-2 cursor-pointer text-sm border-l-2
                    ${s===a.id?"bg-[#37373d] border-blue-500 text-white":"border-transparent text-zinc-400 hover:bg-[#2a2d2e] hover:text-zinc-200"}
                `,children:[t.jsxs("div",{className:"flex items-center gap-2 truncate",children:[t.jsx(ge,{className:"w-3.5 h-3.5 opacity-70"}),t.jsx("span",{className:"truncate",children:a.title})]}),n.length>1&&t.jsx("button",{onClick:u=>l(u,a.id),className:"opacity-0 group-hover:opacity-100 hover:bg-zinc-600 rounded p-0.5",children:t.jsx(ue,{className:"w-3 h-3"})})]},a.id))})]})]})},Br=({tabs:n,activeTabId:e,onTabClick:s,onTabClose:r})=>n.length===0?null:t.jsx("div",{className:"flex items-center bg-[#252526] border-b border-[#3c3c3c] overflow-x-auto",children:n.map(o=>{const l=e===o.id;return t.jsxs("div",{onClick:()=>s(o.id),className:`
              group flex items-center gap-2 px-3 py-2 min-w-[120px] max-w-[200px] cursor-pointer
              border-r border-[#3c3c3c] transition-colors relative
              ${l?"bg-[#1e1e1e] text-white border-t-2 border-t-emerald-500":"bg-[#2d2d2d] text-zinc-400 hover:bg-[#323233]"}
            `,children:[o.isEphemeral?t.jsx(Qe,{className:`w-3.5 h-3.5 shrink-0 ${l?"text-yellow-400":"text-yellow-500"}`}):t.jsx(Nn,{className:`w-3.5 h-3.5 shrink-0 ${l?"text-blue-400":"text-zinc-500"}`}),t.jsx("span",{className:`text-xs truncate flex-1 ${l?"font-semibold":""}`,children:o.title}),o.hasVirtualChanges&&t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-400 shrink-0 animate-pulse",title:"Virtual changes (not saved to disk)"}),o.isDirty&&!o.hasVirtualChanges&&t.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-white shrink-0"}),l&&t.jsx("button",{onClick:a=>{a.stopPropagation(),r(o.id)},className:"hover:bg-zinc-700 rounded p-0.5 transition-colors",children:t.jsx(ue,{className:"w-3 h-3"})})]},o.id)})}),Wr=({documentId:n,title:e,content:s,isEphemeral:r,suggestedName:o,onClose:l,onSave:a,changeId:u,onApprove:p})=>{const[c,f]=d.useState(!1),w=async()=>{if(r){if(console.log("[DocumentViewer] Save clicked:",{changeId:u,hasOnApprove:!!p}),u&&p){console.log("[DocumentViewer] Approving change:",u),f(!0);try{p()}catch(S){console.error("Failed to approve change:",S)}finally{f(!1)}return}f(!0);try{const{save:S}=await et(async()=>{const{save:x}=await import("./index-B7hia_xh.js");return{save:x}},__vite__mapDeps([0,1,2,3,4,5,6])),L=await S({defaultPath:o||"document.md",filters:[{name:"Markdown",extensions:["md"]}]});L&&(await g("save_ephemeral_document",{id:n,path:L}),a&&a(L))}catch(S){console.error("Failed to save document:",S)}finally{f(!1)}}},b=async()=>{if(r)try{await g("close_ephemeral_document",{id:n})}catch(S){console.error("Failed to close ephemeral document:",S)}l()};return t.jsxs("div",{className:"flex flex-col h-full bg-zinc-950",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-zinc-800 bg-zinc-900/50",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Qe,{className:"w-4 h-4 text-emerald-500"}),t.jsx("span",{className:"text-sm font-medium text-zinc-200",children:e}),r&&t.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-yellow-500/10 text-yellow-500 border border-yellow-500/20",children:"Unsaved"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[r&&t.jsxs("button",{onClick:w,disabled:c,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs rounded bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20 border border-emerald-500/20 transition-colors disabled:opacity-50",children:[t.jsx(Cn,{className:"w-3.5 h-3.5"}),c?"Saving...":"Save"]}),t.jsx("button",{onClick:b,className:"p-1.5 rounded hover:bg-zinc-800 text-zinc-400 hover:text-zinc-200 transition-colors",children:t.jsx(ue,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"flex-1 overflow-auto",children:t.jsx("div",{className:"max-w-4xl mx-auto px-6 py-8",children:t.jsx("div",{className:`prose prose-invert prose-lg max-w-none
            prose-headings:text-zinc-100 prose-headings:font-semibold prose-headings:tracking-tight
            prose-h1:text-3xl prose-h1:mb-4 prose-h1:mt-0
            prose-h2:text-2xl prose-h2:mb-3 prose-h2:mt-8
            prose-h3:text-xl prose-h3:mb-2 prose-h3:mt-6
            prose-p:text-zinc-300 prose-p:leading-relaxed prose-p:mb-4
            prose-strong:text-zinc-100 prose-strong:font-semibold
            prose-a:text-emerald-400 prose-a:no-underline hover:prose-a:underline
            prose-code:text-emerald-400 prose-code:bg-zinc-900 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:before:content-[''] prose-code:after:content-['']
            prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800 prose-pre:rounded-lg prose-pre:shadow-xl
            prose-ul:text-zinc-300 prose-ul:my-4
            prose-ol:text-zinc-300 prose-ol:my-4
            prose-li:text-zinc-300 prose-li:leading-relaxed prose-li:my-1
            prose-blockquote:border-l-emerald-500 prose-blockquote:text-zinc-400 prose-blockquote:italic
            prose-hr:border-zinc-800 prose-hr:my-8
            prose-table:border-collapse prose-table:my-6
            prose-thead:border-b-2 prose-thead:border-zinc-700
            prose-th:text-zinc-200 prose-th:font-semibold prose-th:text-left prose-th:px-4 prose-th:py-3 prose-th:bg-zinc-900/50
            prose-td:text-zinc-300 prose-td:px-4 prose-td:py-3 prose-td:border-t prose-td:border-zinc-800
            prose-tr:transition-colors hover:prose-tr:bg-zinc-900/30`,children:t.jsx(ve,{remarkPlugins:[kn],components:{code({node:S,inline:L,className:x,children:_,...z}){const N=/language-(\w+)/.exec(x||"");return!L&&N?t.jsx(Ss,{style:Ds,language:N[1],PreTag:"div",...z,children:String(_).replace(/\n$/,"")}):t.jsx("code",{className:x,...z,children:_})}},children:s})})})})]})};class Qt{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.width=e[0].Logical.width,this.height=e[0].Logical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toPhysical(e){return new Ne(this.width*e,this.height*e)}[re](){return{width:this.width,height:this.height}}toJSON(){return this[re]()}}class Ne{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.width=e[0].Physical.width,this.height=e[0].Physical.height):(this.width=e[0].width,this.height=e[0].height):(this.width=e[0],this.height=e[1])}toLogical(e){return new Qt(this.width/e,this.height/e)}[re](){return{width:this.width,height:this.height}}toJSON(){return this[re]()}}class ye{constructor(e){this.size=e}toLogical(e){return this.size instanceof Qt?this.size:this.size.toLogical(e)}toPhysical(e){return this.size instanceof Ne?this.size:this.size.toPhysical(e)}[re](){return{[`${this.size.type}`]:{width:this.size.width,height:this.size.height}}}toJSON(){return this[re]()}}class en{constructor(...e){this.type="Logical",e.length===1?"Logical"in e[0]?(this.x=e[0].Logical.x,this.y=e[0].Logical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toPhysical(e){return new fe(this.x*e,this.y*e)}[re](){return{x:this.x,y:this.y}}toJSON(){return this[re]()}}class fe{constructor(...e){this.type="Physical",e.length===1?"Physical"in e[0]?(this.x=e[0].Physical.x,this.y=e[0].Physical.y):(this.x=e[0].x,this.y=e[0].y):(this.x=e[0],this.y=e[1])}toLogical(e){return new en(this.x/e,this.y/e)}[re](){return{x:this.x,y:this.y}}toJSON(){return this[re]()}}class Se{constructor(e){this.position=e}toLogical(e){return this.position instanceof en?this.position:this.position.toLogical(e)}toPhysical(e){return this.position instanceof fe?this.position:this.position.toPhysical(e)}[re](){return{[`${this.position.type}`]:{x:this.position.x,y:this.position.y}}}toJSON(){return this[re]()}}class Ce extends Mt{constructor(e){super(e)}static async new(e,s,r){return g("plugin:image|new",{rgba:Le(e),width:s,height:r}).then(o=>new Ce(o))}static async fromBytes(e){return g("plugin:image|from_bytes",{bytes:Le(e)}).then(s=>new Ce(s))}static async fromPath(e){return g("plugin:image|from_path",{path:e}).then(s=>new Ce(s))}async rgba(){return g("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return g("plugin:image|size",{rid:this.rid})}}function Le(n){return n==null?null:typeof n=="string"?n:n instanceof Ce?n.rid:n}var Ye;(function(n){n[n.Critical=1]="Critical",n[n.Informational=2]="Informational"})(Ye||(Ye={}));class Ur{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var vt;(function(n){n.None="none",n.Normal="normal",n.Indeterminate="indeterminate",n.Paused="paused",n.Error="error"})(vt||(vt={}));function tn(){return new nn(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function Ve(){return g("plugin:window|get_all_windows").then(n=>n.map(e=>new nn(e,{skip:!0})))}const He=["tauri://created","tauri://error"];class nn{constructor(e,s={}){var r;this.label=e,this.listeners=Object.create(null),s?.skip||g("plugin:window|create",{options:{...s,parent:typeof s.parent=="string"?s.parent:(r=s.parent)===null||r===void 0?void 0:r.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async o=>this.emit("tauri://error",o))}static async getByLabel(e){var s;return(s=(await Ve()).find(r=>r.label===e))!==null&&s!==void 0?s:null}static getCurrent(){return tn()}static async getAll(){return Ve()}static async getFocusedWindow(){for(const e of await Ve())if(await e.isFocused())return e;return null}async listen(e,s){return this._handleTauriEvent(e,s)?()=>{const r=this.listeners[e];r.splice(r.indexOf(s),1)}:O(e,s,{target:{kind:"Window",label:this.label}})}async once(e,s){return this._handleTauriEvent(e,s)?()=>{const r=this.listeners[e];r.splice(r.indexOf(s),1)}:Ot(e,s,{target:{kind:"Window",label:this.label}})}async emit(e,s){if(He.includes(e)){for(const r of this.listeners[e]||[])r({event:e,id:-1,payload:s});return}return Ie(e,s)}async emitTo(e,s,r){if(He.includes(s)){for(const o of this.listeners[s]||[])o({event:s,id:-1,payload:r});return}return Ft(e,s,r)}_handleTauriEvent(e,s){return He.includes(e)?(e in this.listeners?this.listeners[e].push(s):this.listeners[e]=[s],!0):!1}async scaleFactor(){return g("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return g("plugin:window|inner_position",{label:this.label}).then(e=>new fe(e))}async outerPosition(){return g("plugin:window|outer_position",{label:this.label}).then(e=>new fe(e))}async innerSize(){return g("plugin:window|inner_size",{label:this.label}).then(e=>new Ne(e))}async outerSize(){return g("plugin:window|outer_size",{label:this.label}).then(e=>new Ne(e))}async isFullscreen(){return g("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return g("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return g("plugin:window|is_maximized",{label:this.label})}async isFocused(){return g("plugin:window|is_focused",{label:this.label})}async isDecorated(){return g("plugin:window|is_decorated",{label:this.label})}async isResizable(){return g("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return g("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return g("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return g("plugin:window|is_closable",{label:this.label})}async isVisible(){return g("plugin:window|is_visible",{label:this.label})}async title(){return g("plugin:window|title",{label:this.label})}async theme(){return g("plugin:window|theme",{label:this.label})}async isAlwaysOnTop(){return g("plugin:window|is_always_on_top",{label:this.label})}async center(){return g("plugin:window|center",{label:this.label})}async requestUserAttention(e){let s=null;return e&&(e===Ye.Critical?s={type:"Critical"}:s={type:"Informational"}),g("plugin:window|request_user_attention",{label:this.label,value:s})}async setResizable(e){return g("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return g("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return g("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return g("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return g("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return g("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return g("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return g("plugin:window|maximize",{label:this.label})}async unmaximize(){return g("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return g("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return g("plugin:window|minimize",{label:this.label})}async unminimize(){return g("plugin:window|unminimize",{label:this.label})}async show(){return g("plugin:window|show",{label:this.label})}async hide(){return g("plugin:window|hide",{label:this.label})}async close(){return g("plugin:window|close",{label:this.label})}async destroy(){return g("plugin:window|destroy",{label:this.label})}async setDecorations(e){return g("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return g("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return g("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return g("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return g("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return g("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return g("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){return g("plugin:window|set_size",{label:this.label,value:e instanceof ye?e:new ye(e)})}async setMinSize(e){return g("plugin:window|set_min_size",{label:this.label,value:e instanceof ye?e:e?new ye(e):null})}async setMaxSize(e){return g("plugin:window|set_max_size",{label:this.label,value:e instanceof ye?e:e?new ye(e):null})}async setSizeConstraints(e){function s(r){return r?{Logical:r}:null}return g("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:s(e?.minWidth),minHeight:s(e?.minHeight),maxWidth:s(e?.maxWidth),maxHeight:s(e?.maxHeight)}})}async setPosition(e){return g("plugin:window|set_position",{label:this.label,value:e instanceof Se?e:new Se(e)})}async setFullscreen(e){return g("plugin:window|set_fullscreen",{label:this.label,value:e})}async setSimpleFullscreen(e){return g("plugin:window|set_simple_fullscreen",{label:this.label,value:e})}async setFocus(){return g("plugin:window|set_focus",{label:this.label})}async setFocusable(e){return g("plugin:window|set_focusable",{label:this.label,value:e})}async setIcon(e){return g("plugin:window|set_icon",{label:this.label,value:Le(e)})}async setSkipTaskbar(e){return g("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return g("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return g("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return g("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setBackgroundColor(e){return g("plugin:window|set_background_color",{color:e})}async setCursorPosition(e){return g("plugin:window|set_cursor_position",{label:this.label,value:e instanceof Se?e:new Se(e)})}async setIgnoreCursorEvents(e){return g("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return g("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return g("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setBadgeCount(e){return g("plugin:window|set_badge_count",{label:this.label,value:e})}async setBadgeLabel(e){return g("plugin:window|set_badge_label",{label:this.label,value:e})}async setOverlayIcon(e){return g("plugin:window|set_overlay_icon",{label:this.label,value:e?Le(e):void 0})}async setProgressBar(e){return g("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return g("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return g("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return g("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(Y.WINDOW_RESIZED,s=>{s.payload=new Ne(s.payload),e(s)})}async onMoved(e){return this.listen(Y.WINDOW_MOVED,s=>{s.payload=new fe(s.payload),e(s)})}async onCloseRequested(e){return this.listen(Y.WINDOW_CLOSE_REQUESTED,async s=>{const r=new Ur(s);await e(r),r.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){const s=await this.listen(Y.DRAG_ENTER,a=>{e({...a,payload:{type:"enter",paths:a.payload.paths,position:new fe(a.payload.position)}})}),r=await this.listen(Y.DRAG_OVER,a=>{e({...a,payload:{type:"over",position:new fe(a.payload.position)}})}),o=await this.listen(Y.DRAG_DROP,a=>{e({...a,payload:{type:"drop",paths:a.payload.paths,position:new fe(a.payload.position)}})}),l=await this.listen(Y.DRAG_LEAVE,a=>{e({...a,payload:{type:"leave"}})});return()=>{s(),o(),r(),l()}}async onFocusChanged(e){const s=await this.listen(Y.WINDOW_FOCUS,o=>{e({...o,payload:!0})}),r=await this.listen(Y.WINDOW_BLUR,o=>{e({...o,payload:!1})});return()=>{s(),r()}}async onScaleChanged(e){return this.listen(Y.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(Y.WINDOW_THEME_CHANGED,e)}}var jt;(function(n){n.Disabled="disabled",n.Throttle="throttle",n.Suspend="suspend"})(jt||(jt={}));var Nt;(function(n){n.Default="default",n.FluentOverlay="fluentOverlay"})(Nt||(Nt={}));var Ct;(function(n){n.AppearanceBased="appearanceBased",n.Light="light",n.Dark="dark",n.MediumLight="mediumLight",n.UltraDark="ultraDark",n.Titlebar="titlebar",n.Selection="selection",n.Menu="menu",n.Popover="popover",n.Sidebar="sidebar",n.HeaderView="headerView",n.Sheet="sheet",n.WindowBackground="windowBackground",n.HudWindow="hudWindow",n.FullScreenUI="fullScreenUI",n.Tooltip="tooltip",n.ContentBackground="contentBackground",n.UnderWindowBackground="underWindowBackground",n.UnderPageBackground="underPageBackground",n.Mica="mica",n.Blur="blur",n.Acrylic="acrylic",n.Tabbed="tabbed",n.TabbedDark="tabbedDark",n.TabbedLight="tabbedLight"})(Ct||(Ct={}));var kt;(function(n){n.FollowsWindowActiveState="followsWindowActiveState",n.Active="active",n.Inactive="inactive"})(kt||(kt={}));const Vr=()=>{const[n,e]=d.useState(!1),[s,r]=d.useState(!1),o=tn();d.useEffect(()=>{let p;return(async()=>{const f=await o.isMaximized();e(f);const w=await o.isFullscreen();r(w),p=await o.onResized(async()=>{const b=await o.isMaximized();e(b);const S=await o.isFullscreen();r(S)})})(),()=>{p&&p()}},[o]),d.useEffect(()=>{const p=async c=>{if(c.key==="F11"){c.preventDefault();try{const f=await o.isFullscreen();console.log("[TitleBar] Toggling fullscreen:",!f),await o.setFullscreen(!f),r(!f)}catch(f){console.error("[TitleBar] Failed to toggle fullscreen:",f)}}};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[o]);const l=async p=>{p.stopPropagation(),p.preventDefault();try{console.log("[TitleBar] Minimizing window..."),await o.minimize()}catch(c){console.error("[TitleBar] Failed to minimize:",c)}},a=async p=>{p.stopPropagation(),p.preventDefault();try{console.log("[TitleBar] Toggling maximize..."),await o.toggleMaximize()}catch(c){console.error("[TitleBar] Failed to toggle maximize:",c)}},u=async p=>{p.stopPropagation(),p.preventDefault();try{console.log("[TitleBar] Closing window..."),await o.close()}catch(c){console.error("[TitleBar] Failed to close:",c)}};return s?null:t.jsxs("div",{className:"h-9 bg-[var(--bg-app)] flex items-center justify-between px-1 select-none border-b border-[var(--border-subtle)] relative z-50","data-tauri-drag-region":!0,children:[t.jsxs("div",{className:"flex items-center gap-3 px-3 h-full","data-tauri-drag-region":!0,children:[t.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-[var(--fg-secondary)] to-[var(--fg-tertiary)] opacity-60"}),t.jsx("span",{className:"text-[11px] font-medium text-[var(--fg-tertiary)] tracking-wider uppercase","data-tauri-drag-region":!0,children:"ZaguÃ¡n Blade"})]}),t.jsx("div",{className:"flex-1 h-full","data-tauri-drag-region":!0}),t.jsxs("div",{className:"flex items-center h-full",children:[t.jsx("button",{onClick:l,className:"window-control-btn h-full w-11 flex items-center justify-center text-[var(--fg-tertiary)] hover:bg-[var(--bg-surface)] hover:text-[var(--fg-secondary)] transition-all duration-150",title:"Minimize",children:t.jsx(_n,{className:"w-4 h-4",strokeWidth:1.5})}),t.jsx("button",{onClick:a,className:"window-control-btn h-full w-11 flex items-center justify-center text-[var(--fg-tertiary)] hover:bg-[var(--bg-surface)] hover:text-[var(--fg-secondary)] transition-all duration-150",title:n?"Restore":"Maximize",children:n?t.jsx(En,{className:"w-3.5 h-3.5",strokeWidth:1.5}):t.jsx(Dt,{className:"w-3.5 h-3.5",strokeWidth:1.5})}),t.jsx("button",{onClick:u,className:"window-control-btn h-full w-11 flex items-center justify-center text-[var(--fg-tertiary)] hover:bg-[#c42b1c] hover:text-white transition-all duration-150",title:"Close",children:t.jsx(ue,{className:"w-4 h-4",strokeWidth:1.5})})]})]})},Hr=()=>{const[n,e]=d.useState([]),[s,r]=d.useState(!1),[o,l]=d.useState(!1),a=d.useRef(null);return d.useEffect(()=>{!o&&a.current&&a.current.scrollIntoView({behavior:"smooth"})},[n,o]),d.useEffect(()=>{},[o]),null},Gr=()=>{const{t:n}=Ze(),[e,s]=d.useState(null),[r,o]=d.useState([]),[l,a]=d.useState(300),[u,p]=d.useState(!1),[c,f]=d.useState(new Set),{pendingChanges:w,approveChange:b,rejectChange:S}=Wt(),L=d.useRef(new Set);d.useEffect(()=>{const h=async()=>{try{const i=await g("get_virtual_files");f(new Set(i))}catch(i){console.error("[VIRTUAL BUFFER] Failed to get virtual files:",i)}};h();const v=setInterval(h,1e3);return()=>clearInterval(v)},[]),d.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let h;return(async()=>h=await O("propose-edit",i=>{if(i.payload.length>0){const C=i.payload[0],j=r.find(D=>D.type==="file"&&D.path===C.path);if(j)s(j.id);else{const D=C.path.split("/").pop()||C.path,A={id:`file-${C.path}`,title:D,type:"file",path:C.path};o(R=>[...R,A]),s(A.id)}}}))(),()=>{h&&h()}},[r]);const x=h=>{const v=r.find(i=>i.type==="file"&&i.path===h);if(v)s(v.id);else{const i=h.split("/").pop()||h,C={id:`file-${h}`,title:i,type:"file",path:h};o(j=>[...j,C]),s(C.id)}},_=h=>{o(v=>v.filter(i=>i.id!==h)),e===h&&s(r.length>1?r[0].id:null)},z=(h,v)=>{o(i=>{if(!i.find(A=>A.id===h))return i;const j=v.split("/").pop()||v,D={id:`file-${v}`,title:j,type:"file",path:v};return[...i.filter(A=>A.id!==h),D]}),s(`file-${v}`)},N=h=>{p(!0),h.preventDefault()};return d.useEffect(()=>{const h=i=>{if(!u)return;const C=window.innerHeight-i.clientY-24;C>100&&C<window.innerHeight-100&&a(C)},v=()=>{p(!1)};return u&&(document.addEventListener("mousemove",h),document.addEventListener("mouseup",v)),()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",v)}},[u]),d.useEffect(()=>{if(typeof window>"u"||!("__TAURI_INTERNALS__"in window))return;let h,v,i,C,j;return(async()=>{const A=(R,F)=>{console.log(`Opening file from backend (${F}):`,R);const U=`file-${R}`;if(L.current.has(R)){console.log("[LAYOUT] Ignoring duplicate file open event for:",R);return}L.current.add(R),o(B=>{if(B.find(W=>W.type==="file"&&W.path===R))return L.current.delete(R),B;const k=R.split("/").pop()||R,T={id:U,title:k,type:"file",path:R};return L.current.delete(R),[...B,T]}),s(U)};h=await O("open-file",R=>{A(R.payload,"open-file")}),v=await O("file-opened",R=>{A(R.payload,"file-opened")}),i=await O("open-file-with-highlight",R=>{console.log("Opening file with highlight from backend:",R.payload);const{path:F,start_line:U,end_line:B}=R.payload,E=`file-${F}`;o(k=>{const T=k.find(Z=>Z.type==="file"&&Z.path===F);if(T)return k.map(Z=>Z.id===T.id?{...Z,highlightLines:{startLine:U,endLine:B}}:Z);const W=F.split("/").pop()||F,V={id:E,title:W,type:"file",path:F,highlightLines:{startLine:U,endLine:B}};return[...k,V]}),s(E)}),C=await O("open-ephemeral-document",R=>{console.log("[LAYOUT] ðŸ“¥ Received open-ephemeral-document event:",{id:R.payload.id,title:R.payload.title,contentLength:R.payload.content.length,suggestedName:R.payload.suggestedName});const{id:F,title:U,content:B,suggestedName:E}=R.payload;o(k=>{if(k.find(V=>V.id===F))return console.log("[LAYOUT] âš ï¸ Tab already exists, just activating:",F),k;console.log("[LAYOUT] âœ… Creating new tab with ID:",F);const W={id:F,title:U,type:"ephemeral",content:B,suggestedName:E};return console.log("[LAYOUT] Adding tab to existing tabs:",k.length,"â†’",k.length+1),[...k,W]}),s(F)}),j=await O("change-applied",R=>{console.log("[LAYOUT] Change applied:",R.payload);const{change_id:F,file_path:U}=R.payload,B=`new-file-${F}`;o(E=>{if(!E.find(V=>V.id===B))return E;console.log("[LAYOUT] Converting ephemeral tab to file tab:",B,"â†’",U);const T=U.split("/").pop()||U,W={id:`file-${U}`,title:T,type:"file",path:U};return[...E.filter(V=>V.id!==B),W]}),s(`file-${U}`)})})(),()=>{h&&h(),v&&v(),i&&i(),C&&C(),j&&j()}},[r]),t.jsxs("div",{className:"h-screen w-screen bg-[var(--bg-app)] overflow-hidden flex flex-col font-sans text-[var(--fg-primary)]",children:[t.jsx(Vr,{}),t.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[t.jsxs("div",{className:"w-[50px] bg-[var(--bg-app)] border-r border-[var(--border-subtle)] flex flex-col items-center py-4 gap-6 z-20 shrink-0",children:[t.jsx("div",{className:"p-2 rounded-md bg-[var(--bg-surface)] text-[var(--fg-primary)] shadow-sm border border-[var(--border-subtle)] group cursor-pointer hover:border-[var(--border-focus)] transition-colors",children:t.jsx("svg",{className:"w-5 h-5 opacity-90 group-hover:opacity-100 transition-opacity",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),t.jsx("div",{className:"p-2 rounded-md text-[var(--fg-nav)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface)] transition-all cursor-pointer",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("div",{className:"mt-auto p-2 rounded-md text-[var(--fg-nav)] hover:text-[var(--fg-primary)] hover:bg-[var(--bg-surface)] transition-all cursor-pointer",children:t.jsx(Sn,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"flex-1 flex w-full relative",children:[t.jsx("div",{className:"w-64 min-w-[200px] flex flex-col border-r border-[var(--border-subtle)] bg-[var(--bg-panel)]",children:t.jsx(ir,{onFileSelect:x,activeFile:r.find(h=>h.id===e)?.path||null})}),t.jsxs("div",{className:"flex-1 flex flex-col min-w-[300px] bg-[var(--bg-app)] relative",children:[r.length>0&&t.jsx(Br,{tabs:r.map(h=>({id:h.id,title:h.title,isEphemeral:h.type==="ephemeral",isDirty:!1,hasVirtualChanges:h.path?c.has(h.path):!1})),activeTabId:e,onTabClick:s,onTabClose:_}),t.jsx("div",{className:"flex-1 overflow-hidden relative",children:(()=>{const h=r.find(D=>D.id===e);if(!h)return t.jsx(wt,{activeFile:null,highlightLines:null});if(h.type==="ephemeral"){const A=h.id.startsWith("new-file-")?h.id.replace("new-file-",""):void 0;return t.jsx(Wr,{documentId:h.id,title:h.title,content:h.content||"",isEphemeral:!0,suggestedName:h.suggestedName,onClose:()=>_(h.id),onSave:R=>z(h.id,R),changeId:A,onApprove:A?()=>b(A):void 0})}const v=w.find(D=>D.path===h.path),i=[...new Set(w.map(D=>D.path))],C=h.path?i.indexOf(h.path)+1:0,j=D=>{const A=`file-${D}`,R=r.find(F=>F.type==="file"&&F.path===D);if(R)s(R.id);else{const F=D.split("/").pop()||D;o(U=>[...U,{id:A,title:F,type:"file",path:D}]),s(A)}};return t.jsx(wt,{activeFile:h.path||null,highlightLines:h.highlightLines||null,pendingEdit:v,onAcceptEdit:b,onRejectEdit:S,totalPendingFiles:i.length,currentFileIndex:C||1,onNextFile:i.length>1&&C<i.length?()=>j(i[C]):void 0,onPrevFile:i.length>1&&C>1?()=>j(i[C-2]):void 0})})()}),t.jsx("div",{className:`h-[1px] cursor-row-resize bg-[var(--border-subtle)] hover:bg-[var(--accent-secondary)] hover:h-[2px] transition-all z-20 ${u?"bg-[var(--accent-secondary)] h-[2px]":""}`,onMouseDown:N}),t.jsx("div",{style:{height:l},className:"bg-[var(--term-bg)]",children:t.jsx($r,{})})]}),t.jsx("div",{className:"w-[400px] min-w-[320px] border-l border-[var(--border-subtle)] bg-[var(--bg-panel)] flex flex-col shadow-xl z-30",children:t.jsx(tr,{})})]})]}),t.jsxs("div",{className:"h-6 bg-[var(--bg-app)] border-t border-[var(--border-subtle)] text-[var(--fg-tertiary)] flex items-center px-3 text-[10px] font-mono justify-between select-none z-40",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("span",{className:"flex items-center gap-1.5 hover:text-[var(--fg-secondary)] cursor-pointer transition-colors",children:[t.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("path",{d:"M12 6v6l4 2"})]}),"main*"]}),t.jsx("span",{className:"text-[var(--fg-secondary)]",children:(()=>{const h=r.find(v=>v.id===e);return h?h.title:n("editor.noFileOpen")})()})]}),t.jsxs("div",{className:"flex items-center gap-4 opacity-70",children:[t.jsx("span",{children:n("editor.encoding")}),t.jsx("span",{children:"Rust"}),t.jsx("span",{children:n("app.name")})]})]}),t.jsx(Hr,{})]})},Kr=()=>t.jsx($s,{children:t.jsx(Gr,{})});function qr(){return t.jsxs(Dn,{children:[t.jsx(ct,{path:"/",element:t.jsx(Kr,{})}),t.jsx(ct,{path:"*",element:t.jsx(zn,{to:"/",replace:!0})})]})}Ln.use(Rn).use(Tn).use(An).init({fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},backend:{loadPath:"/locales/{{lng}}/{{ns}}.json"}});In.createRoot(document.getElementById("root")).render(t.jsx(we.StrictMode,{children:t.jsx(Mn,{children:t.jsx(Js,{children:t.jsx(d.Suspense,{fallback:t.jsx("div",{className:"h-screen w-screen bg-[var(--bg-app)]"}),children:t.jsx(qr,{})})})})}));export{g as i};
